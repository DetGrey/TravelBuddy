‹‡
yC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\TripService.cs
	namespace 	
TravelBuddy
 
. 
Trips 
{ 
public 

	interface 
ITripService !
{ 
Task		 
<		 
IEnumerable		 
<		 $
TripDestinationSearchDto		 1
>		1 2
>		2 3
SearchTripsAsync		4 D
(		D E
DateOnly

 
?

 
reqStart

 
,

 
DateOnly 
? 
reqEnd 
, 
string 
? 
country 
, 
string 
? 
state 
, 
string 
? 
name 
, 
int 
? 
	partySize 
, 
string 
? 
q 
) 	
;	 

Task 
< 
IEnumerable 
< 
DestinationDto '
>' (
>( ) 
GetDestinationsAsync* >
(> ?
)? @
;@ A
Task 
< 
IEnumerable 
< 
BuddyTripSummaryDto ,
>, -
>- .
GetBuddyTripsAsync/ A
(A B
intB E
userIdF L
)L M
;M N
Task 
< "
TripDestinationInfoDto #
?# $
>$ %'
GetTripDestinationInfoAsync& A
(A B
intB E
tripDestinationIdF W
)W X
;X Y
Task 
< 
TripOverviewDto 
? 
> $
GetFullTripOverviewAsync 7
(7 8
int8 ;
tripId< B
)B C
;C D
Task 
< 
IEnumerable 
< 
TripOverviewDto (
>( )
>) *&
GetOwnedTripOverviewsAsync+ E
(E F
intF I
userIdJ P
)P Q
;Q R
Task 
< 
bool 
> 
IsTripOwnerAsync #
(# $
int$ '
userId( .
,. /
int0 3
tripDestinationId4 E
)E F
;F G
Task 
< 
( 
bool 
Success 
, 
string "
?" #
ErrorMessage$ 0
)0 1
>1 2+
CreateTripWithDestinationsAsync3 R
(R S)
CreateTripWithDestinationsDtoS p*
createTripWithDestinationsDto	q é
)
é è
;
è ê
Task 
< 
( 
bool 
Success 
, 
string "
?" #
ErrorMessage$ 0
)0 1
>1 2%
LeaveTripDestinationAsync3 L
(L M
intM P
userIdQ W
,W X
intY \
tripDestinationId] n
,n o
intp s
	changedByt }
,} ~
string	 Ö
departureReason
Ü ï
)
ï ñ
;
ñ ó
Task 
< 
IEnumerable 
< "
PendingBuddyRequestDto /
>/ 0
>0 1(
GetPendingBuddyRequestsAsync2 N
(N O
intO R
userIdS Y
)Y Z
;Z [
Task 
< 
( 
bool 
Success 
, 
string "
?" #
ErrorMessage$ 0
)0 1
>1 2#
InsertBuddyRequestAsync3 J
(J K
BuddyDtoK S
buddyDtoT \
)\ ]
;] ^
Task 
< 
( 
bool 
Success 
, 
string "
?" #
ErrorMessage$ 0
)0 1
>1 2#
UpdateBuddyRequestAsync3 J
(J K!
UpdateBuddyRequestDtoK `!
updateBuddyRequestDtoa v
)v w
;w x
Task!! 
<!! 
IEnumerable!! 
<!! 
TripAuditDto!! %
>!!% &
>!!& '
GetTripAuditsAsync!!( :
(!!: ;
)!!; <
;!!< =
Task"" 
<"" 
IEnumerable"" 
<"" 
BuddyAuditDto"" &
>""& '
>""' (
GetBuddyAuditsAsync"") <
(""< =
)""= >
;""> ?
}## 
public&& 

class&& 
TripService&& 
:&& 
ITripService&& +
{'' 
private(( 
readonly(( "
ITripRepositoryFactory(( /"
_tripRepositoryFactory((0 F
;((F G
public** 
TripService** 
(** "
ITripRepositoryFactory** 1!
tripRepositoryFactory**2 G
)**G H
{++ 	"
_tripRepositoryFactory,, "
=,,# $!
tripRepositoryFactory,,% :
;,,: ;
}-- 	
private00 
ITripRepository00 
GetRepo00  '
(00' (
)00( )
=>00* ,"
_tripRepositoryFactory00- C
.00C D
GetTripRepository00D U
(00U V
)00V W
;00W X
public22 
async22 
Task22 
<22 
IEnumerable22 %
<22% &$
TripDestinationSearchDto22& >
>22> ?
>22? @
SearchTripsAsync22A Q
(22Q R
DateOnly33 
?33 
reqStart33 
,33 
DateOnly44 
?44 
reqEnd44 
,44 
string55 
?55 
country55 
,55 
string66 
?66 
state66 
,66 
string77 
?77 
name77 
,77 
int88 
?88 
	partySize88 
,88 
string99 
?99 
q99 
)99 
{:: 	
var;; 
tripRepository;; 
=;;  
GetRepo;;! (
(;;( )
);;) *
;;;* +
var<< 
results<< 
=<< 
await<< 
tripRepository<<  .
.<<. /
SearchTripsAsync<</ ?
(<<? @
reqStart<<@ H
,<<H I
reqEnd<<J P
,<<P Q
country<<R Y
,<<Y Z
state<<[ `
,<<` a
name<<b f
,<<f g
	partySize<<h q
,<<q r
q<<s t
)<<t u
;<<u v
return>> 
results>> 
.>> 
Select>> !
(>>! "
r>>" #
=>>>$ &
new>>' *$
TripDestinationSearchDto>>+ C
(>>C D
r?? 
.?? 
TripDestinationId?? !
,??! "
r@@ 
.@@ 
TripId@@ 
,@@ 
rAA 
.AA 
DestinationIdAA 
,AA 
rBB 
.BB 
DestinationNameBB 
,BB  
rCC 
.CC 
CountryCC 
,CC 
rDD 
.DD 
StateDD 
,DD 
rEE 
.EE 
DestinationStartEE  
,EE  !
rFF 
.FF 
DestinationEndFF 
,FF 
rGG 
.GG 

MaxBuddiesGG 
,GG 
rHH 
.HH 
AcceptedPersonsHH 
,HH  
rII 
.II 
RemainingCapacityII !
)JJ
 
)JJ 
.JJ 
ToListJJ 
(JJ 
)JJ 
;JJ 
}LL 	
publicMM 
asyncMM 
TaskMM 
<MM 
IEnumerableMM %
<MM% &
DestinationDtoMM& 4
>MM4 5
>MM5 6 
GetDestinationsAsyncMM7 K
(MMK L
)MML M
{NN 	
varOO 
tripRepositoryOO 
=OO  
GetRepoOO! (
(OO( )
)OO) *
;OO* +
varPP 
resultsPP 
=PP 
awaitPP 
tripRepositoryPP  .
.PP. / 
GetDestinationsAsyncPP/ C
(PPC D
)PPD E
;PPE F
returnRR 
resultsRR 
.RR 
SelectRR !
(RR! "
rRR" #
=>RR$ &
newRR' *
DestinationDtoRR+ 9
(RR9 :
rSS 
.SS 
DestinationIdSS 
,SS  
rTT 
.TT 
NameTT 
,TT 
rUU 
.UU 
StateUU 
,UU 
rVV 
.VV 
CountryVV 
,VV 
rWW 
.WW 
	LongitudeWW 
,WW 
rXX 
.XX 
LatitudeXX 
)YY 
)YY 
.YY 
ToListYY 
(YY 
)YY 
;YY 
}ZZ 	
public[[ 
async[[ 
Task[[ 
<[[ 
IEnumerable[[ %
<[[% &
BuddyTripSummaryDto[[& 9
>[[9 :
>[[: ;
GetBuddyTripsAsync[[< N
([[N O
int[[O R
userId[[S Y
)[[Y Z
{\\ 	
var]] 
tripRepository]] 
=]]  
GetRepo]]! (
(]]( )
)]]) *
;]]* +
var^^ 
results^^ 
=^^ 
await^^ 
tripRepository^^  .
.^^. /
GetBuddyTripsAsync^^/ A
(^^A B
userId^^B H
)^^H I
;^^I J
return`` 
results`` 
.`` 
Select`` !
(``! "
r``" #
=>``$ &
new``' *
BuddyTripSummaryDto``+ >
(``> ?
raa 
.aa 
TripIdaa 
,aa 
rbb 
.bb 
TripDestinationIdbb #
,bb# $
rcc 
.cc 
DestinationNamecc !
,cc! "
rdd 
.dd 
TripDescriptiondd !
,dd! "
ree 
.ee 
	StartDateee 
,ee 
rff 
.ff 
EndDateff 
,ff 
rgg 
.gg 

IsArchivedgg 
)hh 
)hh 
.hh 
ToListhh 
(hh 
)hh 
;hh 
}ii 	
publicjj 
asyncjj 
Taskjj 
<jj "
TripDestinationInfoDtojj 0
?jj0 1
>jj1 2'
GetTripDestinationInfoAsyncjj3 N
(jjN O
intjjO R
tripDestinationIdjjS d
)jjd e
{kk 	
varll 
tripRepositoryll 
=ll  
GetRepoll! (
(ll( )
)ll) *
;ll* +
varmm 
resultmm 
=mm 
awaitmm 
tripRepositorymm -
.mm- .'
GetTripDestinationInfoAsyncmm. I
(mmI J
tripDestinationIdmmJ [
)mm[ \
;mm\ ]
ifoo 
(oo 
resultoo 
==oo 
nulloo 
)oo 
{pp 
returnqq 
nullqq 
;qq 
}rr 
returntt 
newtt "
TripDestinationInfoDtott -
(tt- .
resultuu 
.uu 
TripDestinationIduu (
,uu( )
resultvv 
.vv  
DestinationStartDatevv +
,vv+ ,
resultww 
.ww 
DestinationEndDateww )
,ww) *
resultxx 
.xx "
DestinationDescriptionxx -
,xx- .
resultyy 
.yy !
DestinationIsArchivedyy ,
,yy, -
resultzz 
.zz 
TripIdzz 
,zz 
result{{ 
.{{ 

MaxBuddies{{ !
,{{! "
result|| 
.|| 
DestinationId|| $
,||$ %
result}} 
.}} 
DestinationName}} &
,}}& '
result~~ 
.~~ 
DestinationState~~ '
,~~' (
result 
. 
DestinationCountry )
,) *
result
ÄÄ 
.
ÄÄ 
	Longitude
ÄÄ  
,
ÄÄ  !
result
ÅÅ 
.
ÅÅ 
Latitude
ÅÅ 
,
ÅÅ  
result
ÇÇ 
.
ÇÇ 
OwnerUserId
ÇÇ "
,
ÇÇ" #
result
ÉÉ 
.
ÉÉ 
	OwnerName
ÉÉ  
,
ÉÉ  !
result
ÑÑ 
.
ÑÑ !
GroupConversationId
ÑÑ *
,
ÑÑ* +
result
ÖÖ 
.
ÖÖ 
AcceptedBuddies
ÖÖ &
.
ÖÖ& '
Select
ÖÖ' -
(
ÖÖ- .
b
ÖÖ. /
=>
ÖÖ0 2
new
ÖÖ3 6
BuddyInfoDto
ÖÖ7 C
(
ÖÖC D
b
ÜÜ 
.
ÜÜ 
BuddyId
ÜÜ 
,
ÜÜ 
b
áá 
.
áá 
PersonCount
áá !
,
áá! "
b
àà 
.
àà 
	BuddyNote
àà 
,
àà  
b
ââ 
.
ââ 
BuddyUserId
ââ !
,
ââ! "
b
ää 
.
ää 
	BuddyName
ää 
)
ãã 
)
ãã 
,
ãã 
result
åå 
.
åå 
PendingRequests
åå &
.
åå& '
Select
åå' -
(
åå- .
r
åå. /
=>
åå0 2
new
åå3 6!
BuddyRequestInfoDto
åå7 J
(
ååJ K
r
çç 
.
çç 
BuddyId
çç 
,
çç 
r
éé 
.
éé 
PersonCount
éé !
,
éé! "
r
èè 
.
èè 
	BuddyNote
èè 
,
èè  
r
êê 
.
êê 
RequesterUserId
êê %
,
êê% &
r
ëë 
.
ëë 
RequesterName
ëë #
)
íí 
)
íí 
)
ìì 
;
ìì 
}
îî 	
public
ïï 
async
ïï 
Task
ïï 
<
ïï 
TripOverviewDto
ïï )
?
ïï) *
>
ïï* +&
GetFullTripOverviewAsync
ïï, D
(
ïïD E
int
ïïE H
tripId
ïïI O
)
ïïO P
{
ññ 	
var
óó 
tripRepository
óó 
=
óó  
GetRepo
óó! (
(
óó( )
)
óó) *
;
óó* +
var
òò 
tripOverview
òò 
=
òò 
await
òò $
tripRepository
òò% 3
.
òò3 4&
GetFullTripOverviewAsync
òò4 L
(
òòL M
tripId
òòM S
)
òòS T
;
òòT U
if
ôô 
(
ôô 
tripOverview
ôô 
==
ôô 
null
ôô  $
)
ôô$ %
{
öö 
return
õõ 
null
õõ 
;
õõ 
}
úú 
return
ùù 
new
ùù 
TripOverviewDto
ùù &
(
ùù& '
tripOverview
ûû 
.
ûû 
TripId
ûû #
,
ûû# $
tripOverview
üü 
.
üü 
TripName
üü %
,
üü% &
tripOverview
†† 
.
†† 
TripStartDate
†† *
,
††* +
tripOverview
°° 
.
°° 
TripEndDate
°° (
,
°°( )
tripOverview
¢¢ 
.
¢¢ 

MaxBuddies
¢¢ '
,
¢¢' (
tripOverview
££ 
.
££ 
TripDescription
££ ,
,
££, -
tripOverview
§§ 
.
§§ 
OwnerUserId
§§ (
,
§§( )
tripOverview
•• 
.
•• 
	OwnerName
•• &
,
••& '
tripOverview
¶¶ 
.
¶¶ 
Destinations
¶¶ )
.
¶¶) *
Select
¶¶* 0
(
¶¶0 1
d
¶¶1 2
=>
¶¶3 5
new
¶¶6 9*
SimplifiedTripDestinationDto
¶¶: V
(
¶¶V W
d
ßß 
.
ßß 
TripDestinationId
ßß '
,
ßß' (
d
®® 
.
®® 
TripId
®® 
,
®® 
d
©© 
.
©© "
DestinationStartDate
©© *
,
©©* +
d
™™ 
.
™™  
DestinationEndDate
™™ (
,
™™( )
d
´´ 
.
´´ 
DestinationName
´´ %
,
´´% &
d
¨¨ 
.
¨¨ 
DestinationState
¨¨ &
,
¨¨& '
d
≠≠ 
.
≠≠  
DestinationCountry
≠≠ (
,
≠≠( )
d
ÆÆ 
.
ÆÆ 

MaxBuddies
ÆÆ  
,
ÆÆ  !
d
ØØ 
.
ØØ "
AcceptedBuddiesCount
ØØ *
)
∞∞ 
)
∞∞ 
.
∞∞ 
ToList
∞∞ 
(
∞∞ 
)
∞∞ 
)
±± 
;
±± 
}
≤≤ 	
public
≥≥ 
async
≥≥ 
Task
≥≥ 
<
≥≥ 
IEnumerable
≥≥ %
<
≥≥% &
TripOverviewDto
≥≥& 5
>
≥≥5 6
>
≥≥6 7(
GetOwnedTripOverviewsAsync
≥≥8 R
(
≥≥R S
int
≥≥S V
userId
≥≥W ]
)
≥≥] ^
{
¥¥ 	
var
µµ 
tripRepository
µµ 
=
µµ  
GetRepo
µµ! (
(
µµ( )
)
µµ) *
;
µµ* +
var
∂∂ 
tripOverviews
∂∂ 
=
∂∂ 
await
∂∂  %
tripRepository
∂∂& 4
.
∂∂4 5(
GetOwnedTripOverviewsAsync
∂∂5 O
(
∂∂O P
userId
∂∂P V
)
∂∂V W
;
∂∂W X
return
∏∏ 
tripOverviews
∏∏  
.
∏∏  !
Select
∏∏! '
(
∏∏' (
tripOverview
∏∏( 4
=>
∏∏5 7
new
∏∏8 ;
TripOverviewDto
∏∏< K
(
∏∏K L
tripOverview
ππ 
.
ππ 
TripId
ππ #
,
ππ# $
tripOverview
∫∫ 
.
∫∫ 
TripName
∫∫ %
,
∫∫% &
tripOverview
ªª 
.
ªª 
TripStartDate
ªª *
,
ªª* +
tripOverview
ºº 
.
ºº 
TripEndDate
ºº (
,
ºº( )
tripOverview
ΩΩ 
.
ΩΩ 

MaxBuddies
ΩΩ '
,
ΩΩ' (
tripOverview
ææ 
.
ææ 
TripDescription
ææ ,
,
ææ, -
tripOverview
øø 
.
øø 
OwnerUserId
øø (
,
øø( )
tripOverview
¿¿ 
.
¿¿ 
	OwnerName
¿¿ &
,
¿¿& '
tripOverview
¡¡ 
.
¡¡ 
Destinations
¡¡ )
.
¡¡) *
Select
¡¡* 0
(
¡¡0 1
d
¡¡1 2
=>
¡¡3 5
new
¡¡6 9*
SimplifiedTripDestinationDto
¡¡: V
(
¡¡V W
d
¬¬ 
.
¬¬ 
TripDestinationId
¬¬ '
,
¬¬' (
d
√√ 
.
√√ 
TripId
√√ 
,
√√ 
d
ƒƒ 
.
ƒƒ "
DestinationStartDate
ƒƒ *
,
ƒƒ* +
d
≈≈ 
.
≈≈  
DestinationEndDate
≈≈ (
,
≈≈( )
d
∆∆ 
.
∆∆ 
DestinationName
∆∆ %
,
∆∆% &
d
«« 
.
«« 
DestinationState
«« &
,
««& '
d
»» 
.
»»  
DestinationCountry
»» (
,
»»( )
d
…… 
.
…… 

MaxBuddies
……  
,
……  !
d
   
.
   "
AcceptedBuddiesCount
   *
)
ÀÀ 
)
ÀÀ 
.
ÀÀ 
ToList
ÀÀ 
(
ÀÀ 
)
ÀÀ 
)
ÃÃ 
)
ÃÃ 
.
ÃÃ 
ToList
ÃÃ 
(
ÃÃ 
)
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
public
ŒŒ 
async
ŒŒ 
Task
ŒŒ 
<
ŒŒ 
bool
ŒŒ 
>
ŒŒ 
IsTripOwnerAsync
ŒŒ  0
(
ŒŒ0 1
int
ŒŒ1 4
userId
ŒŒ5 ;
,
ŒŒ; <
int
ŒŒ= @
tripDestinationId
ŒŒA R
)
ŒŒR S
{
œœ 	
var
–– 
tripRepository
–– 
=
––  
GetRepo
––! (
(
––( )
)
––) *
;
––* +
var
—— 
	tripOwner
—— 
=
—— 
await
—— !
tripRepository
——" 0
.
——0 1
GetTripOwnerAsync
——1 B
(
——B C
tripDestinationId
——C T
)
——T U
;
——U V
return
““ 
	tripOwner
““ 
==
““ 
userId
““  &
;
““& '
}
”” 	
public
’’ 
async
’’ 
Task
’’ 
<
’’ 
(
’’ 
bool
’’ 
Success
’’  '
,
’’' (
string
’’) /
?
’’/ 0
ErrorMessage
’’1 =
)
’’= >
>
’’> ?-
CreateTripWithDestinationsAsync
’’@ _
(
’’_ `+
CreateTripWithDestinationsDto
’’` },
createTripWithDestinationsDto’’~ õ
)’’õ ú
{
÷÷ 	
var
◊◊ 
tripRepository
◊◊ 
=
◊◊  
GetRepo
◊◊! (
(
◊◊( )
)
◊◊) *
;
◊◊* +
return
ÿÿ 
await
ÿÿ 
tripRepository
ÿÿ '
.
ÿÿ' (-
CreateTripWithDestinationsAsync
ÿÿ( G
(
ÿÿG H+
createTripWithDestinationsDto
ÿÿH e
)
ÿÿe f
;
ÿÿf g
}
ŸŸ 	
public
ﬁﬁ 
async
ﬁﬁ 
Task
ﬁﬁ 
<
ﬁﬁ 
(
ﬁﬁ 
bool
ﬁﬁ 
Success
ﬁﬁ  '
,
ﬁﬁ' (
string
ﬁﬁ) /
?
ﬁﬁ/ 0
ErrorMessage
ﬁﬁ1 =
)
ﬁﬁ= >
>
ﬁﬁ> ?'
LeaveTripDestinationAsync
ﬁﬁ@ Y
(
ﬁﬁY Z
int
ﬂﬂ 
userId
ﬂﬂ 
,
ﬂﬂ 
int
‡‡ 
tripDestinationId
‡‡ !
,
‡‡! "
int
·· 
	changedBy
·· 
,
·· 
string
‚‚ 
departureReason
‚‚ "
)
„„ 	
{
„„
 
var
‰‰ 
tripRepository
‰‰ 
=
‰‰  
GetRepo
‰‰! (
(
‰‰( )
)
‰‰) *
;
‰‰* +
return
ÂÂ 
await
ÂÂ 
tripRepository
ÂÂ '
.
ÂÂ' ('
LeaveTripDestinationAsync
ÂÂ( A
(
ÂÂA B
userId
ÂÂB H
,
ÂÂH I
tripDestinationId
ÂÂJ [
,
ÂÂ[ \
	changedBy
ÂÂ] f
,
ÂÂf g
departureReason
ÂÂh w
)
ÂÂw x
;
ÂÂx y
}
ÊÊ 	
public
ÁÁ 
async
ÁÁ 
Task
ÁÁ 
<
ÁÁ 
IEnumerable
ÁÁ %
<
ÁÁ% &$
PendingBuddyRequestDto
ÁÁ& <
>
ÁÁ< =
>
ÁÁ= >*
GetPendingBuddyRequestsAsync
ÁÁ? [
(
ÁÁ[ \
int
ÁÁ\ _
userId
ÁÁ` f
)
ÁÁf g
{
ËË 	
var
ÈÈ 
buddyRepository
ÈÈ 
=
ÈÈ  !
GetRepo
ÈÈ" )
(
ÈÈ) *
)
ÈÈ* +
;
ÈÈ+ ,
var
ÎÎ 
results
ÎÎ 
=
ÎÎ 
await
ÎÎ 
buddyRepository
ÎÎ  /
.
ÎÎ/ 0*
GetPendingBuddyRequestsAsync
ÎÎ0 L
(
ÎÎL M
userId
ÎÎM S
)
ÎÎS T
;
ÎÎT U
return
ÌÌ 
results
ÌÌ 
.
ÌÌ 
Select
ÌÌ !
(
ÌÌ! "
r
ÌÌ" #
=>
ÌÌ$ &
new
ÌÌ' *$
PendingBuddyRequestDto
ÌÌ+ A
(
ÌÌA B
r
ÓÓ 
.
ÓÓ 
TripDestinationId
ÓÓ #
,
ÓÓ# $
r
ÔÔ 
.
ÔÔ 
DestinationName
ÔÔ !
,
ÔÔ! "
r
 
.
 "
DestinationStartDate
 &
,
& '
r
ÒÒ 
.
ÒÒ  
DestinationEndDate
ÒÒ $
,
ÒÒ$ %
r
ÚÚ 
.
ÚÚ 
TripId
ÚÚ 
,
ÚÚ 
r
ÛÛ 
.
ÛÛ 
BuddyId
ÛÛ 
,
ÛÛ 
r
ÙÙ 
.
ÙÙ 
RequesterUserId
ÙÙ !
,
ÙÙ! "
r
ıı 
.
ıı 
RequesterName
ıı 
,
ıı  
r
ˆˆ 
.
ˆˆ 
	BuddyNote
ˆˆ 
,
ˆˆ 
r
˜˜ 
.
˜˜ 
PersonCount
˜˜ 
)
¯¯ 
)
¯¯ 
.
¯¯ 
ToList
¯¯ 
(
¯¯ 
)
¯¯ 
;
¯¯ 
}
˘˘ 	
public
˚˚ 
async
˚˚ 
Task
˚˚ 
<
˚˚ 
(
˚˚ 
bool
˚˚ 
Success
˚˚  '
,
˚˚' (
string
˚˚) /
?
˚˚/ 0
ErrorMessage
˚˚1 =
)
˚˚= >
>
˚˚> ?%
InsertBuddyRequestAsync
˚˚@ W
(
˚˚W X
BuddyDto
˚˚X `
buddyDto
˚˚a i
)
˚˚i j
{
¸¸ 	
var
˝˝ 
buddyRepository
˝˝ 
=
˝˝  !
GetRepo
˝˝" )
(
˝˝) *
)
˝˝* +
;
˝˝+ ,
return
˛˛ 
await
˛˛ 
buddyRepository
˛˛ (
.
˛˛( )%
InsertBuddyRequestAsync
˛˛) @
(
˛˛@ A
buddyDto
˛˛A I
)
˛˛I J
;
˛˛J K
}
ˇˇ 	
public
ÅÅ 
async
ÅÅ 
Task
ÅÅ 
<
ÅÅ 
(
ÅÅ 
bool
ÅÅ 
Success
ÅÅ  '
,
ÅÅ' (
string
ÅÅ) /
?
ÅÅ/ 0
ErrorMessage
ÅÅ1 =
)
ÅÅ= >
>
ÅÅ> ?%
UpdateBuddyRequestAsync
ÅÅ@ W
(
ÅÅW X#
UpdateBuddyRequestDto
ÅÅX m$
updateBuddyRequestDtoÅÅn É
)ÅÅÉ Ñ
{
ÇÇ 	
var
ÉÉ 
buddyRepository
ÉÉ 
=
ÉÉ  !
GetRepo
ÉÉ" )
(
ÉÉ) *
)
ÉÉ* +
;
ÉÉ+ ,
return
ÑÑ 
await
ÑÑ 
buddyRepository
ÑÑ (
.
ÑÑ( )%
UpdateBuddyRequestAsync
ÑÑ) @
(
ÑÑ@ A#
updateBuddyRequestDto
ÑÑA V
)
ÑÑV W
;
ÑÑW X
}
ÖÖ 	
public
àà 
async
àà 
Task
àà 
<
àà 
IEnumerable
àà %
<
àà% &
TripAuditDto
àà& 2
>
àà2 3
>
àà3 4 
GetTripAuditsAsync
àà5 G
(
ààG H
)
ààH I
{
ââ 	
var
ää 
tripRepository
ää 
=
ää  
GetRepo
ää! (
(
ää( )
)
ää) *
;
ää* +
var
ãã 
results
ãã 
=
ãã 
await
ãã 
tripRepository
ãã  .
.
ãã. / 
GetTripAuditsAsync
ãã/ A
(
ããA B
)
ããB C
;
ããC D
return
åå 
results
åå 
.
åå 
Select
åå !
(
åå! "
ta
åå" $
=>
åå% '
new
åå( +
TripAuditDto
åå, 8
(
åå8 9
ta
çç 
.
çç 
AuditId
çç 
,
çç 
ta
éé 
.
éé 
TripId
éé 
,
éé 
ta
èè 
.
èè 
Action
èè 
,
èè 
ta
êê 
.
êê 
FieldChanged
êê 
,
êê  
ta
ëë 
.
ëë 
OldValue
ëë 
,
ëë 
ta
íí 
.
íí 
NewValue
íí 
,
íí 
ta
ìì 
.
ìì 
	ChangedBy
ìì 
,
ìì 
ta
îî 
.
îî 
	Timestamp
îî 
)
ïï 
)
ïï 
.
ïï 
ToList
ïï 
(
ïï 
)
ïï 
;
ïï 
}
ññ 	
public
óó 
async
óó 
Task
óó 
<
óó 
IEnumerable
óó %
<
óó% &
BuddyAuditDto
óó& 3
>
óó3 4
>
óó4 5!
GetBuddyAuditsAsync
óó6 I
(
óóI J
)
óóJ K
{
òò 	
var
ôô 
tripRepository
ôô 
=
ôô  
GetRepo
ôô! (
(
ôô( )
)
ôô) *
;
ôô* +
var
öö 
results
öö 
=
öö 
await
öö 
tripRepository
öö  .
.
öö. /!
GetBuddyAuditsAsync
öö/ B
(
ööB C
)
ööC D
;
ööD E
return
õõ 
results
õõ 
.
õõ 
Select
õõ !
(
õõ! "
ba
õõ" $
=>
õõ% '
new
õõ( +
BuddyAuditDto
õõ, 9
(
õõ9 :
ba
úú 
.
úú 
AuditId
úú 
,
úú 
ba
ùù 
.
ùù 
BuddyId
ùù 
,
ùù 
ba
ûû 
.
ûû 
Action
ûû 
,
ûû 
ba
üü 
.
üü 
Reason
üü 
,
üü 
ba
†† 
.
†† 
	ChangedBy
†† 
,
†† 
ba
°° 
.
°° 
	Timestamp
°° 
)
¢¢ 
)
¢¢ 
.
¢¢ 
ToList
¢¢ 
(
¢¢ 
)
¢¢ 
;
¢¢ 
}
££ 	
}
§§ 
}•• ì
ÅC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\TripOverview.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
class 
TripOverview 
{ 
public 

int 
TripId 
{ 
get 
; 
set  
;  !
}" #
public 

string 
TripName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 

DateOnly 
TripStartDate !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

DateOnly 
TripEndDate 
{  !
get" %
;% &
set' *
;* +
}, -
public		 

int		 

MaxBuddies		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
public

 

string

 
TripDescription

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
=

0 1
null

2 6
!

6 7
;

7 8
public 

int 
OwnerUserId 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
	OwnerName 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
public 

List 
< %
SimplifiedTripDestination )
>) *
Destinations+ 7
{8 9
get: =
;= >
set? B
;B C
}D E
=F G
newH K
ListL P
<P Q%
SimplifiedTripDestinationQ j
>j k
(k l
)l m
;m n
} é
ÉC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\TripHeaderInfo.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
class 
TripHeaderInfo 
{ 
public 

int 
TripId 
{ 
get 
; 
set  
;  !
}" #
public 

string 
TripName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 

DateOnly 
TripStartDate !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

DateOnly 
TripEndDate 
{  !
get" %
;% &
set' *
;* +
}, -
public		 

int		 

MaxBuddies		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
public

 

string

 
TripDescription

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
=

0 1
null

2 6
!

6 7
;

7 8
public 

int 
OwnerUserId 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
	OwnerName 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
} Ó
êC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\TripDestinationSearchResult.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
{ 
public 

class '
TripDestinationSearchResult ,
{ 
public 
int 
TripDestinationId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
int 
TripId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
DestinationId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
DestinationName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public		 
string		 
Country		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
=		, -
string		. 4
.		4 5
Empty		5 :
;		: ;
public

 
string

 
?

 
State

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
=

+ ,
string

- 3
.

3 4
Empty

4 9
;

9 :
public 
DateOnly 
DestinationStart (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DateOnly 
DestinationEnd &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
int 

MaxBuddies 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int 
AcceptedPersons "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 
RemainingCapacity $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} Ç-
àC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\TripDestinationInfo.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
{ 
public 

class 
TripDestinationInfo $
{ 
public 
int 
TripDestinationId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DateOnly  
DestinationStartDate ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
DateOnly 
DestinationEndDate *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
string 
? "
DestinationDescription -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
public		 
bool		 
?		 !
DestinationIsArchived		 *
{		+ ,
get		- 0
;		0 1
set		2 5
;		5 6
}		7 8
public 
int 
TripId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
? 

MaxBuddies 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
DestinationId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
DestinationName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
null6 :
!: ;
;; <
public 
string 
? 
DestinationState '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
string 
DestinationCountry (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
=7 8
null9 =
!= >
;> ?
public 
decimal 
? 
	Longitude !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
decimal 
? 
Latitude  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
OwnerUserId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
	OwnerName 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
null0 4
!4 5
;5 6
public 
int 
? 
GroupConversationId '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
List 
< 
	BuddyInfo 
> 
AcceptedBuddies .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
== >
new? B
(B C
)C D
;D E
public   
List   
<   
BuddyRequestInfo   $
>  $ %
PendingRequests  & 5
{  6 7
get  8 ;
;  ; <
set  = @
;  @ A
}  B C
=  D E
new  F I
(  I J
)  J K
;  K L
}!! 
public## 

class## 
	BuddyInfo## 
{$$ 
public%% 
int%% 
BuddyId%% 
{%% 
get%%  
;%%  !
set%%" %
;%%% &
}%%' (
public&& 
int&& 
PersonCount&& 
{&&  
get&&! $
;&&$ %
set&&& )
;&&) *
}&&+ ,
public'' 
string'' 
?'' 
	BuddyNote''  
{''! "
get''# &
;''& '
set''( +
;''+ ,
}''- .
public** 
int** 
BuddyUserId** 
{**  
get**! $
;**$ %
set**& )
;**) *
}**+ ,
public++ 
string++ 
	BuddyName++ 
{++  !
get++" %
;++% &
set++' *
;++* +
}++, -
=++. /
null++0 4
!++4 5
;++5 6
},, 
public.. 

class.. 
BuddyRequestInfo.. !
{// 
public00 
int00 
BuddyId00 
{00 
get00  
;00  !
set00" %
;00% &
}00' (
public11 
int11 
PersonCount11 
{11  
get11! $
;11$ %
set11& )
;11) *
}11+ ,
public22 
string22 
?22 
	BuddyNote22  
{22! "
get22# &
;22& '
set22( +
;22+ ,
}22- .
public55 
int55 
RequesterUserId55 "
{55# $
get55% (
;55( )
set55* -
;55- .
}55/ 0
public66 
string66 
RequesterName66 #
{66$ %
get66& )
;66) *
set66+ .
;66. /
}660 1
=662 3
null664 8
!668 9
;669 :
}77 
}88 ›
ÑC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\TripDestination.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
partial 
class 
TripDestination $
{ 
public 

int 
TripDestinationId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

int 
DestinationId 
{ 
get "
;" #
set$ '
;' (
}) *
public		 

int		 
TripId		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public 

DateOnly 
	StartDate 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateOnly 
EndDate 
{ 
get !
;! "
set# &
;& '
}( )
public 

int 
SequenceNumber 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
? 
Description 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

bool 
? 

IsArchived 
{ 
get !
;! "
set# &
;& '
}( )
public 

virtual 
ICollection 
< 
Buddy $
>$ %
Buddies& -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
=< =
new> A
ListB F
<F G
BuddyG L
>L M
(M N
)N O
;O P
public 

virtual 
Destination 
Destination *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
=9 :
null; ?
!? @
;@ A
public 

virtual 
Trip 
Trip 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
} Ñ
~C:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\TripAudit.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
partial 
class 
	TripAudit 
{ 
public 

int 
AuditId 
{ 
get 
; 
set !
;! "
}# $
public		 

int		 
TripId		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public 

string 
Action 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
!- .
;. /
public 

string 
? 
FieldChanged 
{  !
get" %
;% &
set' *
;* +
}, -
public 

string 
? 
OldValue 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
? 
NewValue 
{ 
get !
;! "
set# &
;& '
}( )
public 

int 
? 
	ChangedBy 
{ 
get 
;  
set! $
;$ %
}& '
public 

DateTime 
? 
	Timestamp 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

virtual 
User 
? 
ChangedByNavigation ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 

virtual 
Trip 
Trip 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
} ⁄
yC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\Trip.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
partial 
class 
Trip 
{ 
public 

int 
TripId 
{ 
get 
; 
set  
;  !
}" #
public		 

int		 
?		 
OwnerId		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
public 

string 
? 
TripName 
{ 
get !
;! "
set# &
;& '
}( )
public 

int 
? 

MaxBuddies 
{ 
get  
;  !
set" %
;% &
}' (
public 

DateOnly 
	StartDate 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateOnly 
EndDate 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
? 
Description 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

bool 
? 

IsArchived 
{ 
get !
;! "
set# &
;& '
}( )
public 

virtual 
User 
? 
Owner 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

virtual 
ICollection 
< 
	TripAudit (
>( )

TripAudits* 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
newE H
ListI M
<M N
	TripAuditN W
>W X
(X Y
)Y Z
;Z [
public 

virtual 
ICollection 
< 
TripDestination .
>. /
TripDestinations0 @
{A B
getC F
;F G
setH K
;K L
}M N
=O P
newQ T
ListU Y
<Y Z
TripDestinationZ i
>i j
(j k
)k l
;l m
} ˝
éC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\SimplifiedTripDestination.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
class %
SimplifiedTripDestination &
{ 
public 

int 
TripDestinationId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

int 
TripId 
{ 
get 
; 
set  
;  !
}" #
public 

DateOnly  
DestinationStartDate (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

DateOnly 
DestinationEndDate &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public		 

string		 
DestinationName		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
=		0 1
null		2 6
!		6 7
;		7 8
public

 

string

 
?

 
DestinationState

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
=

2 3
null

4 8
!

8 9
;

9 :
public 

string 
DestinationCountry $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
public 

int 

MaxBuddies 
{ 
get 
;  
set! $
;$ %
}& '
public 

int  
AcceptedBuddiesCount #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} ı
àC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\PendingBuddyRequest.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
{ 
public 

class 
PendingBuddyRequest $
{ 
public 
int 
TripDestinationId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
DestinationName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 
DateOnly  
DestinationStartDate ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
DateOnly 
DestinationEndDate *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public		 
int		 
TripId		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
public

 
int

 
BuddyId

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
int 
RequesterUserId "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
RequesterName #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
string4 :
.: ;
Empty; @
;@ A
public 
string 
? 
	BuddyNote  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
PersonCount 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Ô
~C:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\NewTripId.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
class 
	NewTripId 
{ 
public 

int 
TripId 
{ 
get 
; 
set  
;  !
}" #
} ’
ÄC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\Destination.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
partial 
class 
Destination  
{ 
public 

int 
DestinationId 
{ 
get "
;" #
set$ '
;' (
}) *
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
=

% &
null

' +
!

+ ,
;

, -
public 

string 
? 
State 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
Country 
{ 
get 
;  
set! $
;$ %
}& '
=( )
null* .
!. /
;/ 0
public 

decimal 
? 
	Longitude 
{ 
get  #
;# $
set% (
;( )
}* +
public 

decimal 
? 
Latitude 
{ 
get "
;" #
set$ '
;' (
}) *
public 

virtual 
ICollection 
< 
TripDestination .
>. /
TripDestinations0 @
{A B
getC F
;F G
setH K
;K L
}M N
=O P
newQ T
ListU Y
<Y Z
TripDestinationZ i
>i j
(j k
)k l
;l m
} ˜
ÖC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\BuddyTripSummary.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
{ 
public 

class 
BuddyTripSummary !
{ 
public 
int 
TripId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
TripDestinationId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
DestinationName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public 
string 
TripDescription %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
string6 <
.< =
Empty= B
;B C
public		 
DateOnly		 
	StartDate		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
public

 
DateOnly

 
EndDate

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
bool 

IsArchived 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ≠
C:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\BuddyAudit.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
partial 
class 

BuddyAudit 
{ 
public 

int 
AuditId 
{ 
get 
; 
set !
;! "
}# $
public		 

int		 
BuddyId		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
public 

string 
Action 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
!- .
;. /
public 

string 
? 
Reason 
{ 
get 
;  
set! $
;$ %
}& '
public 

int 
? 
	ChangedBy 
{ 
get 
;  
set! $
;$ %
}& '
public 

DateTime 
? 
	Timestamp 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

virtual 
Buddy 
Buddy 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
null/ 3
!3 4
;4 5
public 

virtual 
User 
? 
ChangedByNavigation ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
} ±
zC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Models\Buddy.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Models "
;" #
public 
partial 
class 
Buddy 
{ 
public 

int 
BuddyId 
{ 
get 
; 
set !
;! "
}# $
public		 

int		 
UserId		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public 

int 
TripDestinationId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

int 
? 
PersonCount 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
? 
Note 
{ 
get 
; 
set "
;" #
}$ %
public 

bool 
? 
IsActive 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
? 
DepartureReason "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

string 
RequestStatus 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
null0 4
!4 5
;5 6
public 

virtual 
ICollection 
< 

BuddyAudit )
>) *
BuddyAudits+ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
=E F
newG J
ListK O
<O P

BuddyAuditP Z
>Z [
([ \
)\ ]
;] ^
public 

virtual 
TripDestination "
TripDestination# 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
=A B
nullC G
!G H
;H I
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
} «
ÑC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\ITripRepositoryFactory.cs
	namespace 	
TravelBuddy
 
. 
Trips 
{ 
public 

	interface "
ITripRepositoryFactory +
{ 
ITripRepository 
GetTripRepository )
() *
)* +
;+ ,
} 
} —#
}C:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\ITripRepository.cs
	namespace 	
TravelBuddy
 
. 
Trips 
; 
public 
	interface 
ITripRepository  
{ 
Task		 
<		 	
IEnumerable			 
<		 '
TripDestinationSearchResult		 0
>		0 1
>		1 2
SearchTripsAsync		3 C
(		C D
DateOnly

 
?

 
reqStart

 
,

 
DateOnly 
? 
reqEnd 
, 
string 
? 
country 
, 
string 
? 
state 
, 
string 
? 
name 
, 
int 
? 
	partySize 
, 
string 
? 
q 
) 
; 
Task 
< 	
IEnumerable	 
< 
Destination  
>  !
>! " 
GetDestinationsAsync# 7
(7 8
)8 9
;9 :
Task 
< 	
IEnumerable	 
< 
BuddyTripSummary %
>% &
>& '
GetBuddyTripsAsync( :
(: ;
int; >
userId? E
)E F
;F G
Task 
< 	
TripDestinationInfo	 
? 
> '
GetTripDestinationInfoAsync :
(: ;
int; >
tripDestinationId? P
)P Q
;Q R
Task 
< 	
TripOverview	 
? 
> $
GetFullTripOverviewAsync 0
(0 1
int1 4
tripId5 ;
); <
;< =
Task 
< 	
List	 
< 
TripOverview 
> 
> &
GetOwnedTripOverviewsAsync 7
(7 8
int8 ;
userId< B
)B C
;C D
Task 
< 	
int	 
? 
> 
GetTripOwnerAsync  
(  !
int! $
tripDestinationId% 6
)6 7
;7 8
Task 
< 	
(	 

bool
 
Success 
, 
string 
? 
ErrorMessage  ,
), -
>- .+
CreateTripWithDestinationsAsync/ N
(N O)
CreateTripWithDestinationsDtoO l*
createTripWithDestinationsDto	m ä
)
ä ã
;
ã å
Task 
< 	
(	 

bool
 
Success 
, 
string 
? 
ErrorMessage  ,
), -
>- .%
LeaveTripDestinationAsync/ H
(H I
intI L
userIdM S
,S T
intU X
tripDestinationIdY j
,j k
intl o
	changedByp y
,y z
string	{ Å
departureReason
Ç ë
)
ë í
;
í ì
Task 
< 	
IEnumerable	 
< 
PendingBuddyRequest (
>( )
>) *(
GetPendingBuddyRequestsAsync+ G
(G H
intH K
userIdL R
)R S
;S T
Task 
< 	
(	 

bool
 
Success 
, 
string 
? 
ErrorMessage  ,
), -
>- .#
InsertBuddyRequestAsync/ F
(F G
BuddyDtoG O
buddyDtoP X
)X Y
;Y Z
Task 
< 	
(	 

bool
 
Success 
, 
string 
? 
ErrorMessage  ,
), -
>- .#
UpdateBuddyRequestAsync/ F
(F G!
UpdateBuddyRequestDtoG \!
updateBuddyRequestDto] r
)r s
;s t
Task!! 
<!! 	
IEnumerable!!	 
<!! 
	TripAudit!! 
>!! 
>!!  
GetTripAuditsAsync!!! 3
(!!3 4
)!!4 5
;!!5 6
Task"" 
<"" 	
IEnumerable""	 
<"" 

BuddyAudit"" 
>""  
>""  !
GetBuddyAuditsAsync""" 5
(""5 6
)""6 7
;""7 8
}## ˝¨
ñC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Infrastructure\Neo4j\Neo4jTripRepository.cs
	namespace 	
TravelBuddy
 
. 
Trips 
; 
public		 
class		 
Neo4jTripRepository		  
:		! "
ITripRepository		# 2
{

 
private 
readonly 
IDriver 
_driver $
;$ %
public 

Neo4jTripRepository 
( 
IDriver &
driver' -
)- .
{ 
_driver 
= 
driver 
; 
} 
private 
static 
DateOnly 
ParseIsoDate (
(( )
object) /
value0 5
)5 6
{ 
if 

( 
value 
== 
null 
) 
throw 
new %
InvalidOperationException /
(/ 0
$str0 L
)L M
;M N
switch 
( 
value 
) 
{ 	
case 
	LocalDate 
ld 
: 
return 
new 
DateOnly #
(# $
ld$ &
.& '
Year' +
,+ ,
ld- /
./ 0
Month0 5
,5 6
ld7 9
.9 :
Day: =
)= >
;> ?
case!! 
DateTime!! 
dt!! 
:!! 
return"" 
DateOnly"" 
.""  
FromDateTime""  ,
("", -
dt""- /
)""/ 0
;""0 1
case$$ 
string$$ 
s$$ 
:$$ 
return&& 
DateOnly&& 
.&&  
Parse&&  %
(&&% &
s&&& '
)&&' (
;&&( )
default(( 
:(( 
return)) 
DateOnly)) 
.))  
Parse))  %
())% &
value))& +
.))+ ,
ToString)), 4
())4 5
)))5 6
!))6 7
)))7 8
;))8 9
}** 	
}++ 
private.. 
async.. 
Task.. 
<.. 
int.. 
>.. 
GetNextBuddyIdAsync.. /
(../ 0
)..0 1
{// 
await00 
using00 
var00 
session00 
=00  !
_driver00" )
.00) *
AsyncSession00* 6
(006 7
)007 8
;008 9
var11 
cursor11 
=11 
await11 
session11 "
.11" #
RunAsync11# +
(11+ ,
$str14, 	
)44	 

;44
 
var55 
record55 
=55 
await55 
cursor55 !
.55! "
SingleAsync55" -
(55- .
)55. /
;55/ 0
var66 
maxId66 
=66 
record66 
[66 
$str66 "
]66" #
.66# $
As66$ &
<66& '
int66' *
>66* +
(66+ ,
)66, -
;66- .
return77 
maxId77 
+77 
$num77 
;77 
}88 
public== 

async== 
Task== 
<== 
IEnumerable== !
<==! "'
TripDestinationSearchResult==" =
>=== >
>==> ?
SearchTripsAsync==@ P
(==P Q
DateOnly>> 
?>> 
reqStart>> 
,>> 
DateOnly?? 
??? 
reqEnd?? 
,?? 
string@@ 
?@@ 
country@@ 
,@@ 
stringAA 
?AA 
stateAA 
,AA 
stringBB 
?BB 
nameBB 
,BB 
intCC 
?CC 
	partySizeCC 
,CC 
stringDD 
?DD 
qDD 
)DD 
{EE 
awaitFF 
usingFF 
varFF 
sessionFF 
=FF  !
_driverFF" )
.FF) *
AsyncSessionFF* 6
(FF6 7
)FF7 8
;FF8 9
varHH 
cypherHH 
=HH 
$strHr 
;rr 
vartt 
cursortt 
=tt 
awaittt 
sessiontt "
.tt" #
RunAsynctt# +
(tt+ ,
cyphertt, 2
,tt2 3
newtt4 7
{uu 	
reqStartvv 
=vv 
reqStartvv 
?vv  
.vv  !
ToStringvv! )
(vv) *
$strvv* 6
)vv6 7
,vv7 8
reqEndww 
=ww 
reqEndww 
?ww 
.ww 
ToStringww '
(ww' (
$strww( 4
)ww4 5
,ww5 6
countryxx 
,xx 
stateyy 
,yy 
namezz 
,zz 
	partySize{{ 
,{{ 
q|| 
}}} 	
)}}	 

;}}
 
var 
records 
= 
await 
cursor "
." #
ToListAsync# .
(. /
)/ 0
;0 1
var
ÄÄ 
results
ÄÄ 
=
ÄÄ 
new
ÄÄ 
List
ÄÄ 
<
ÄÄ )
TripDestinationSearchResult
ÄÄ :
>
ÄÄ: ;
(
ÄÄ; <
)
ÄÄ< =
;
ÄÄ= >
foreach
ÇÇ 
(
ÇÇ 
var
ÇÇ 
record
ÇÇ 
in
ÇÇ 
records
ÇÇ &
)
ÇÇ& '
{
ÉÉ 	
results
ÑÑ 
.
ÑÑ 
Add
ÑÑ 
(
ÑÑ 
new
ÑÑ )
TripDestinationSearchResult
ÑÑ 7
{
ÖÖ 
TripDestinationId
ÜÜ !
=
ÜÜ" #
record
ÜÜ$ *
[
ÜÜ* +
$str
ÜÜ+ >
]
ÜÜ> ?
.
ÜÜ? @
As
ÜÜ@ B
<
ÜÜB C
int
ÜÜC F
>
ÜÜF G
(
ÜÜG H
)
ÜÜH I
,
ÜÜI J
TripId
áá 
=
áá" #
record
áá$ *
[
áá* +
$str
áá+ 3
]
áá3 4
.
áá4 5
As
áá5 7
<
áá7 8
int
áá8 ;
>
áá; <
(
áá< =
)
áá= >
,
áá> ?
DestinationId
àà 
=
àà" #
record
àà$ *
[
àà* +
$str
àà+ :
]
àà: ;
.
àà; <
As
àà< >
<
àà> ?
int
àà? B
>
ààB C
(
ààC D
)
ààD E
,
ààE F
DestinationName
ââ 
=
ââ" #
record
ââ$ *
[
ââ* +
$str
ââ+ <
]
ââ< =
.
ââ= >
As
ââ> @
<
ââ@ A
string
ââA G
>
ââG H
(
ââH I
)
ââI J
,
ââJ K
Country
ää 
=
ää" #
record
ää$ *
[
ää* +
$str
ää+ 4
]
ää4 5
.
ää5 6
As
ää6 8
<
ää8 9
string
ää9 ?
>
ää? @
(
ää@ A
)
ääA B
,
ääB C
State
ãã 
=
ãã" #
record
ãã$ *
[
ãã* +
$str
ãã+ 2
]
ãã2 3
.
ãã3 4
As
ãã4 6
<
ãã6 7
string
ãã7 =
>
ãã= >
(
ãã> ?
)
ãã? @
,
ãã@ A
DestinationStart
åå  
=
åå" #
ParseIsoDate
åå$ 0
(
åå0 1
record
åå1 7
[
åå7 8
$str
åå8 J
]
ååJ K
)
ååK L
,
ååL M
DestinationEnd
çç 
=
çç" #
ParseIsoDate
çç$ 0
(
çç0 1
record
çç1 7
[
çç7 8
$str
çç8 H
]
ççH I
)
ççI J
,
ççJ K

MaxBuddies
éé 
=
éé" #
record
éé$ *
[
éé* +
$str
éé+ 7
]
éé7 8
.
éé8 9
As
éé9 ;
<
éé; <
int
éé< ?
>
éé? @
(
éé@ A
)
ééA B
,
ééB C
AcceptedPersons
èè 
=
èè" #
record
èè$ *
[
èè* +
$str
èè+ <
]
èè< =
.
èè= >
As
èè> @
<
èè@ A
int
èèA D
>
èèD E
(
èèE F
)
èèF G
,
èèG H
RemainingCapacity
êê !
=
êê" #
record
êê$ *
[
êê* +
$str
êê+ >
]
êê> ?
.
êê? @
As
êê@ B
<
êêB C
int
êêC F
>
êêF G
(
êêG H
)
êêH I
}
ëë 
)
ëë 
;
ëë 
}
íí 	
return
îî 
results
îî 
;
îî 
}
ïï 
public
öö 

async
öö 
Task
öö 
<
öö 
IEnumerable
öö !
<
öö! "
Destination
öö" -
>
öö- .
>
öö. /"
GetDestinationsAsync
öö0 D
(
ööD E
)
ööE F
{
õõ 
await
úú 
using
úú 
var
úú 
session
úú 
=
úú  !
_driver
úú" )
.
úú) *
AsyncSession
úú* 6
(
úú6 7
)
úú7 8
;
úú8 9
var
ûû 
cypher
ûû 
=
ûû 
$str
û® 
;
®® 
var
™™ 
cursor
™™ 
=
™™ 
await
™™ 
session
™™ "
.
™™" #
RunAsync
™™# +
(
™™+ ,
cypher
™™, 2
)
™™2 3
;
™™3 4
var
´´ 
records
´´ 
=
´´ 
await
´´ 
cursor
´´ "
.
´´" #
ToListAsync
´´# .
(
´´. /
)
´´/ 0
;
´´0 1
var
≠≠ 
list
≠≠ 
=
≠≠ 
new
≠≠ 
List
≠≠ 
<
≠≠ 
Destination
≠≠ '
>
≠≠' (
(
≠≠( )
)
≠≠) *
;
≠≠* +
foreach
ØØ 
(
ØØ 
var
ØØ 
record
ØØ 
in
ØØ 
records
ØØ &
)
ØØ& '
{
∞∞ 	
double
±± 
?
±± 
lon
±± 
=
±± 
record
±±  
[
±±  !
$str
±±! ,
]
±±, -
.
±±- .
As
±±. 0
<
±±0 1
double
±±1 7
?
±±7 8
>
±±8 9
(
±±9 :
)
±±: ;
;
±±; <
double
≤≤ 
?
≤≤ 
lat
≤≤ 
=
≤≤ 
record
≤≤  
[
≤≤  !
$str
≤≤! +
]
≤≤+ ,
.
≤≤, -
As
≤≤- /
<
≤≤/ 0
double
≤≤0 6
?
≤≤6 7
>
≤≤7 8
(
≤≤8 9
)
≤≤9 :
;
≤≤: ;
list
¥¥ 
.
¥¥ 
Add
¥¥ 
(
¥¥ 
new
¥¥ 
Destination
¥¥ $
{
µµ 
DestinationId
∂∂ 
=
∂∂ 
record
∂∂  &
[
∂∂& '
$str
∂∂' 6
]
∂∂6 7
.
∂∂7 8
As
∂∂8 :
<
∂∂: ;
int
∂∂; >
>
∂∂> ?
(
∂∂? @
)
∂∂@ A
,
∂∂A B
Name
∑∑ 
=
∑∑ 
record
∑∑  &
[
∑∑& '
$str
∑∑' -
]
∑∑- .
.
∑∑. /
As
∑∑/ 1
<
∑∑1 2
string
∑∑2 8
>
∑∑8 9
(
∑∑9 :
)
∑∑: ;
,
∑∑; <
State
∏∏ 
=
∏∏ 
record
∏∏  &
[
∏∏& '
$str
∏∏' .
]
∏∏. /
.
∏∏/ 0
As
∏∏0 2
<
∏∏2 3
string
∏∏3 9
?
∏∏9 :
>
∏∏: ;
(
∏∏; <
)
∏∏< =
,
∏∏= >
Country
ππ 
=
ππ 
record
ππ  &
[
ππ& '
$str
ππ' 0
]
ππ0 1
.
ππ1 2
As
ππ2 4
<
ππ4 5
string
ππ5 ;
>
ππ; <
(
ππ< =
)
ππ= >
,
ππ> ?
	Longitude
∫∫ 
=
∫∫ 
lon
∫∫  #
.
∫∫# $
HasValue
∫∫$ ,
?
∫∫- .
(
∫∫/ 0
decimal
∫∫0 7
?
∫∫7 8
)
∫∫8 9
Convert
∫∫9 @
.
∫∫@ A
	ToDecimal
∫∫A J
(
∫∫J K
lon
∫∫K N
.
∫∫N O
Value
∫∫O T
)
∫∫T U
:
∫∫V W
null
∫∫X \
,
∫∫\ ]
Latitude
ªª 
=
ªª 
lat
ªª  #
.
ªª# $
HasValue
ªª$ ,
?
ªª- .
(
ªª/ 0
decimal
ªª0 7
?
ªª7 8
)
ªª8 9
Convert
ªª9 @
.
ªª@ A
	ToDecimal
ªªA J
(
ªªJ K
lat
ªªK N
.
ªªN O
Value
ªªO T
)
ªªT U
:
ªªV W
null
ªªX \
}
ºº 
)
ºº 
;
ºº 
}
ΩΩ 	
return
øø 
list
øø 
;
øø 
}
¿¿ 
public
≈≈ 

async
≈≈ 
Task
≈≈ 
<
≈≈ 
IEnumerable
≈≈ !
<
≈≈! "
BuddyTripSummary
≈≈" 2
>
≈≈2 3
>
≈≈3 4 
GetBuddyTripsAsync
≈≈5 G
(
≈≈G H
int
≈≈H K
userId
≈≈L R
)
≈≈R S
{
∆∆ 
await
«« 
using
«« 
var
«« 
session
«« 
=
««  !
_driver
««" )
.
««) *
AsyncSession
««* 6
(
««6 7
)
««7 8
;
««8 9
var
…… 
cypher
…… 
=
…… 
$str
…’ 
;
’’ 
var
◊◊ 
cursor
◊◊ 
=
◊◊ 
await
◊◊ 
session
◊◊ "
.
◊◊" #
RunAsync
◊◊# +
(
◊◊+ ,
cypher
◊◊, 2
,
◊◊2 3
new
◊◊4 7
{
◊◊8 9
userId
◊◊: @
}
◊◊A B
)
◊◊B C
;
◊◊C D
var
ÿÿ 
records
ÿÿ 
=
ÿÿ 
await
ÿÿ 
cursor
ÿÿ "
.
ÿÿ" #
ToListAsync
ÿÿ# .
(
ÿÿ. /
)
ÿÿ/ 0
;
ÿÿ0 1
var
⁄⁄ 
result
⁄⁄ 
=
⁄⁄ 
new
⁄⁄ 
List
⁄⁄ 
<
⁄⁄ 
BuddyTripSummary
⁄⁄ .
>
⁄⁄. /
(
⁄⁄/ 0
)
⁄⁄0 1
;
⁄⁄1 2
foreach
‹‹ 
(
‹‹ 
var
‹‹ 
record
‹‹ 
in
‹‹ 
records
‹‹ &
)
‹‹& '
{
›› 	
result
ﬁﬁ 
.
ﬁﬁ 
Add
ﬁﬁ 
(
ﬁﬁ 
new
ﬁﬁ 
BuddyTripSummary
ﬁﬁ +
{
ﬂﬂ 
TripId
‡‡ 
=
‡‡" #
record
‡‡$ *
[
‡‡* +
$str
‡‡+ 3
]
‡‡3 4
.
‡‡4 5
As
‡‡5 7
<
‡‡7 8
int
‡‡8 ;
>
‡‡; <
(
‡‡< =
)
‡‡= >
,
‡‡> ?
TripDestinationId
·· !
=
··" #
record
··$ *
[
··* +
$str
··+ >
]
··> ?
.
··? @
As
··@ B
<
··B C
int
··C F
>
··F G
(
··G H
)
··H I
,
··I J
DestinationName
‚‚ 
=
‚‚" #
record
‚‚$ *
[
‚‚* +
$str
‚‚+ <
]
‚‚< =
.
‚‚= >
As
‚‚> @
<
‚‚@ A
string
‚‚A G
>
‚‚G H
(
‚‚H I
)
‚‚I J
,
‚‚J K
TripDescription
„„ 
=
„„" #
record
„„$ *
[
„„* +
$str
„„+ <
]
„„< =
.
„„= >
As
„„> @
<
„„@ A
string
„„A G
>
„„G H
(
„„H I
)
„„I J
,
„„J K
	StartDate
‰‰ 
=
‰‰" #
ParseIsoDate
‰‰$ 0
(
‰‰0 1
record
‰‰1 7
[
‰‰7 8
$str
‰‰8 C
]
‰‰C D
)
‰‰D E
,
‰‰E F
EndDate
ÂÂ 
=
ÂÂ" #
ParseIsoDate
ÂÂ$ 0
(
ÂÂ0 1
record
ÂÂ1 7
[
ÂÂ7 8
$str
ÂÂ8 A
]
ÂÂA B
)
ÂÂB C
,
ÂÂC D

IsArchived
ÊÊ 
=
ÊÊ" #
record
ÊÊ$ *
[
ÊÊ* +
$str
ÊÊ+ 7
]
ÊÊ7 8
.
ÊÊ8 9
As
ÊÊ9 ;
<
ÊÊ; <
bool
ÊÊ< @
>
ÊÊ@ A
(
ÊÊA B
)
ÊÊB C
}
ÁÁ 
)
ÁÁ 
;
ÁÁ 
}
ËË 	
return
ÍÍ 
result
ÍÍ 
;
ÍÍ 
}
ÎÎ 
public
 

async
 
Task
 
<
 !
TripDestinationInfo
 )
?
) *
>
* +)
GetTripDestinationInfoAsync
, G
(
G H
int
H K
tripDestinationId
L ]
)
] ^
{
ÒÒ 
await
ÚÚ 
using
ÚÚ 
var
ÚÚ 
session
ÚÚ 
=
ÚÚ  !
_driver
ÚÚ" )
.
ÚÚ) *
AsyncSession
ÚÚ* 6
(
ÚÚ6 7
)
ÚÚ7 8
;
ÚÚ8 9
var
ıı 
headerCypher
ıı 
=
ıı 
$str
ıà 
;
àà 
var
ää 
headerCursor
ää 
=
ää 
await
ää  
session
ää! (
.
ää( )
RunAsync
ää) 1
(
ää1 2
headerCypher
ää2 >
,
ää> ?
new
ää@ C
{
ääD E
tripDestinationId
ääF W
}
ääX Y
)
ääY Z
;
ääZ [
var
ãã 
headerRecords
ãã 
=
ãã 
await
ãã !
headerCursor
ãã" .
.
ãã. /
ToListAsync
ãã/ :
(
ãã: ;
)
ãã; <
;
ãã< =
var
åå 
headerRecord
åå 
=
åå 
headerRecords
åå (
.
åå( )
SingleOrDefault
åå) 8
(
åå8 9
)
åå9 :
;
åå: ;
if
éé 

(
éé 
headerRecord
éé 
==
éé 
null
éé  
)
éé  !
return
èè 
null
èè 
;
èè 
double
ëë 
?
ëë 
lon
ëë 
=
ëë 
headerRecord
ëë "
[
ëë" #
$str
ëë# .
]
ëë. /
.
ëë/ 0
As
ëë0 2
<
ëë2 3
double
ëë3 9
?
ëë9 :
>
ëë: ;
(
ëë; <
)
ëë< =
;
ëë= >
double
íí 
?
íí 
lat
íí 
=
íí 
headerRecord
íí "
[
íí" #
$str
íí# -
]
íí- .
.
íí. /
As
íí/ 1
<
íí1 2
double
íí2 8
?
íí8 9
>
íí9 :
(
íí: ;
)
íí; <
;
íí< =
var
îî 
info
îî 
=
îî 
new
îî !
TripDestinationInfo
îî *
{
ïï 	
TripDestinationId
ññ 
=
ññ# $
headerRecord
ññ% 1
[
ññ1 2
$str
ññ2 E
]
ññE F
.
ññF G
As
ññG I
<
ññI J
int
ññJ M
>
ññM N
(
ññN O
)
ññO P
,
ññP Q"
DestinationStartDate
óó  
=
óó# $
ParseIsoDate
óó% 1
(
óó1 2
headerRecord
óó2 >
[
óó> ?
$str
óó? U
]
óóU V
)
óóV W
,
óóW X 
DestinationEndDate
òò 
=
òò# $
ParseIsoDate
òò% 1
(
òò1 2
headerRecord
òò2 >
[
òò> ?
$str
òò? S
]
òòS T
)
òòT U
,
òòU V$
DestinationDescription
ôô "
=
ôô# $
headerRecord
ôô% 1
[
ôô1 2
$str
ôô2 J
]
ôôJ K
.
ôôK L
As
ôôL N
<
ôôN O
string
ôôO U
?
ôôU V
>
ôôV W
(
ôôW X
)
ôôX Y
,
ôôY Z#
DestinationIsArchived
öö !
=
öö# $
headerRecord
öö% 1
[
öö1 2
$str
öö2 I
]
ööI J
.
ööJ K
As
ööK M
<
ööM N
bool
ööN R
?
ööR S
>
ööS T
(
ööT U
)
ööU V
,
ööV W
TripId
úú 
=
úú 
headerRecord
úú %
[
úú% &
$str
úú& .
]
úú. /
.
úú/ 0
As
úú0 2
<
úú2 3
int
úú3 6
>
úú6 7
(
úú7 8
)
úú8 9
,
úú9 :

MaxBuddies
ùù 
=
ùù 
headerRecord
ùù %
[
ùù% &
$str
ùù& 2
]
ùù2 3
.
ùù3 4
As
ùù4 6
<
ùù6 7
int
ùù7 :
?
ùù: ;
>
ùù; <
(
ùù< =
)
ùù= >
,
ùù> ?
DestinationId
üü 
=
üü  
headerRecord
üü! -
[
üü- .
$str
üü. =
]
üü= >
.
üü> ?
As
üü? A
<
üüA B
int
üüB E
>
üüE F
(
üüF G
)
üüG H
,
üüH I
DestinationName
†† 
=
††  
headerRecord
††! -
[
††- .
$str
††. ?
]
††? @
.
††@ A
As
††A C
<
††C D
string
††D J
>
††J K
(
††K L
)
††L M
,
††M N
DestinationState
°° 
=
°°  
headerRecord
°°! -
[
°°- .
$str
°°. @
]
°°@ A
.
°°A B
As
°°B D
<
°°D E
string
°°E K
?
°°K L
>
°°L M
(
°°M N
)
°°N O
,
°°O P 
DestinationCountry
¢¢ 
=
¢¢  
headerRecord
¢¢! -
[
¢¢- .
$str
¢¢. B
]
¢¢B C
.
¢¢C D
As
¢¢D F
<
¢¢F G
string
¢¢G M
>
¢¢M N
(
¢¢N O
)
¢¢O P
,
¢¢P Q
	Longitude
££ 
=
££  
lon
££! $
.
££$ %
HasValue
££% -
?
££. /
(
££0 1
decimal
££1 8
?
££8 9
)
££9 :
Convert
££: A
.
££A B
	ToDecimal
££B K
(
££K L
lon
££L O
.
££O P
Value
££P U
)
££U V
:
££W X
null
££Y ]
,
££] ^
Latitude
§§ 
=
§§  
lat
§§! $
.
§§$ %
HasValue
§§% -
?
§§. /
(
§§0 1
decimal
§§1 8
?
§§8 9
)
§§9 :
Convert
§§: A
.
§§A B
	ToDecimal
§§B K
(
§§K L
lat
§§L O
.
§§O P
Value
§§P U
)
§§U V
:
§§W X
null
§§Y ]
,
§§] ^
OwnerUserId
¶¶ 
=
¶¶  
headerRecord
¶¶! -
[
¶¶- .
$str
¶¶. ;
]
¶¶; <
.
¶¶< =
As
¶¶= ?
<
¶¶? @
int
¶¶@ C
?
¶¶C D
>
¶¶D E
(
¶¶E F
)
¶¶F G
??
¶¶H J
$num
¶¶K L
,
¶¶L M
	OwnerName
ßß 
=
ßß  
headerRecord
ßß! -
[
ßß- .
$str
ßß. 9
]
ßß9 :
.
ßß: ;
As
ßß; =
<
ßß= >
string
ßß> D
?
ßßD E
>
ßßE F
(
ßßF G
)
ßßG H
??
ßßI K
string
ßßL R
.
ßßR S
Empty
ßßS X
,
ßßX Y!
GroupConversationId
©© 
=
©©  !
null
©©" &
,
©©& '
AcceptedBuddies
™™ 
=
™™  !
new
™™" %
List
™™& *
<
™™* +
	BuddyInfo
™™+ 4
>
™™4 5
(
™™5 6
)
™™6 7
,
™™7 8
PendingRequests
´´ 
=
´´  !
new
´´" %
List
´´& *
<
´´* +
BuddyRequestInfo
´´+ ;
>
´´; <
(
´´< =
)
´´= >
}
¨¨ 	
;
¨¨	 

var
ØØ 
acceptedCypher
ØØ 
=
ØØ 
$str
Øπ 
;
ππ 
var
ªª 
acceptedCursor
ªª 
=
ªª 
await
ªª "
session
ªª# *
.
ªª* +
RunAsync
ªª+ 3
(
ªª3 4
acceptedCypher
ªª4 B
,
ªªB C
new
ªªD G
{
ªªH I
tripDestinationId
ªªJ [
}
ªª\ ]
)
ªª] ^
;
ªª^ _
var
ºº 
acceptedRecords
ºº 
=
ºº 
await
ºº #
acceptedCursor
ºº$ 2
.
ºº2 3
ToListAsync
ºº3 >
(
ºº> ?
)
ºº? @
;
ºº@ A
foreach
ææ 
(
ææ 
var
ææ 
r
ææ 
in
ææ 
acceptedRecords
ææ )
)
ææ) *
{
øø 	
int
¿¿ 
?
¿¿ 
buddyIdNullable
¿¿  
=
¿¿! "
r
¿¿# $
[
¿¿$ %
$str
¿¿% .
]
¿¿. /
.
¿¿/ 0
As
¿¿0 2
<
¿¿2 3
int
¿¿3 6
?
¿¿6 7
>
¿¿7 8
(
¿¿8 9
)
¿¿9 :
;
¿¿: ;
int
¡¡ 
buddyId
¡¡ 
=
¡¡ 
buddyIdNullable
¡¡ )
??
¡¡* ,
$num
¡¡- .
;
¡¡. /
info
√√ 
.
√√ 
AcceptedBuddies
√√  
.
√√  !
Add
√√! $
(
√√$ %
new
√√% (
	BuddyInfo
√√) 2
{
ƒƒ 
BuddyId
≈≈ 
=
≈≈ 
buddyId
≈≈ %
,
≈≈% &
PersonCount
∆∆ 
=
∆∆ 
r
∆∆ 
[
∆∆  
$str
∆∆  -
]
∆∆- .
.
∆∆. /
As
∆∆/ 1
<
∆∆1 2
int
∆∆2 5
>
∆∆5 6
(
∆∆6 7
)
∆∆7 8
,
∆∆8 9
	BuddyNote
«« 
=
«« 
r
«« 
[
««  
$str
««  +
]
««+ ,
.
««, -
As
««- /
<
««/ 0
string
««0 6
?
««6 7
>
««7 8
(
««8 9
)
««9 :
,
««: ;
BuddyUserId
»» 
=
»» 
r
»» 
[
»»  
$str
»»  -
]
»»- .
.
»». /
As
»»/ 1
<
»»1 2
int
»»2 5
>
»»5 6
(
»»6 7
)
»»7 8
,
»»8 9
	BuddyName
…… 
=
…… 
r
…… 
[
……  
$str
……  +
]
……+ ,
.
……, -
As
……- /
<
……/ 0
string
……0 6
>
……6 7
(
……7 8
)
……8 9
}
   
)
   
;
   
}
ÀÀ 	
var
ŒŒ 
pendingCypher
ŒŒ 
=
ŒŒ 
$str
Œ◊ 
;
◊◊ 
var
ŸŸ 
pendingCursor
ŸŸ 
=
ŸŸ 
await
ŸŸ !
session
ŸŸ" )
.
ŸŸ) *
RunAsync
ŸŸ* 2
(
ŸŸ2 3
pendingCypher
ŸŸ3 @
,
ŸŸ@ A
new
ŸŸB E
{
ŸŸF G
tripDestinationId
ŸŸH Y
}
ŸŸZ [
)
ŸŸ[ \
;
ŸŸ\ ]
var
⁄⁄ 
pendingRecords
⁄⁄ 
=
⁄⁄ 
await
⁄⁄ "
pendingCursor
⁄⁄# 0
.
⁄⁄0 1
ToListAsync
⁄⁄1 <
(
⁄⁄< =
)
⁄⁄= >
;
⁄⁄> ?
foreach
‹‹ 
(
‹‹ 
var
‹‹ 
r
‹‹ 
in
‹‹ 
pendingRecords
‹‹ (
)
‹‹( )
{
›› 	
int
ﬁﬁ 
?
ﬁﬁ 
buddyIdNullable
ﬁﬁ  
=
ﬁﬁ! "
r
ﬁﬁ# $
[
ﬁﬁ$ %
$str
ﬁﬁ% .
]
ﬁﬁ. /
.
ﬁﬁ/ 0
As
ﬁﬁ0 2
<
ﬁﬁ2 3
int
ﬁﬁ3 6
?
ﬁﬁ6 7
>
ﬁﬁ7 8
(
ﬁﬁ8 9
)
ﬁﬁ9 :
;
ﬁﬁ: ;
int
ﬂﬂ 
buddyId
ﬂﬂ 
=
ﬂﬂ 
buddyIdNullable
ﬂﬂ )
??
ﬂﬂ* ,
$num
ﬂﬂ- .
;
ﬂﬂ. /
info
·· 
.
·· 
PendingRequests
··  
.
··  !
Add
··! $
(
··$ %
new
··% (
BuddyRequestInfo
··) 9
{
‚‚ 
BuddyId
„„ 
=
„„  !
buddyId
„„" )
,
„„) *
PersonCount
‰‰ 
=
‰‰  !
r
‰‰" #
[
‰‰# $
$str
‰‰$ 1
]
‰‰1 2
.
‰‰2 3
As
‰‰3 5
<
‰‰5 6
int
‰‰6 9
>
‰‰9 :
(
‰‰: ;
)
‰‰; <
,
‰‰< =
	BuddyNote
ÂÂ 
=
ÂÂ  !
r
ÂÂ" #
[
ÂÂ# $
$str
ÂÂ$ /
]
ÂÂ/ 0
.
ÂÂ0 1
As
ÂÂ1 3
<
ÂÂ3 4
string
ÂÂ4 :
?
ÂÂ: ;
>
ÂÂ; <
(
ÂÂ< =
)
ÂÂ= >
,
ÂÂ> ?
RequesterUserId
ÊÊ 
=
ÊÊ  !
r
ÊÊ" #
[
ÊÊ# $
$str
ÊÊ$ 5
]
ÊÊ5 6
.
ÊÊ6 7
As
ÊÊ7 9
<
ÊÊ9 :
int
ÊÊ: =
>
ÊÊ= >
(
ÊÊ> ?
)
ÊÊ? @
,
ÊÊ@ A
RequesterName
ÁÁ 
=
ÁÁ  !
r
ÁÁ" #
[
ÁÁ# $
$str
ÁÁ$ 3
]
ÁÁ3 4
.
ÁÁ4 5
As
ÁÁ5 7
<
ÁÁ7 8
string
ÁÁ8 >
>
ÁÁ> ?
(
ÁÁ? @
)
ÁÁ@ A
}
ËË 
)
ËË 
;
ËË 
}
ÈÈ 	
return
ÎÎ 
info
ÎÎ 
;
ÎÎ 
}
ÏÏ 
public
ÒÒ 

async
ÒÒ 
Task
ÒÒ 
<
ÒÒ 
TripOverview
ÒÒ "
?
ÒÒ" #
>
ÒÒ# $&
GetFullTripOverviewAsync
ÒÒ% =
(
ÒÒ= >
int
ÒÒ> A
tripId
ÒÒB H
)
ÒÒH I
{
ÚÚ 
await
ÛÛ 
using
ÛÛ 
var
ÛÛ 
session
ÛÛ 
=
ÛÛ  !
_driver
ÛÛ" )
.
ÛÛ) *
AsyncSession
ÛÛ* 6
(
ÛÛ6 7
)
ÛÛ7 8
;
ÛÛ8 9
var
ˆˆ 
headerCypher
ˆˆ 
=
ˆˆ 
$str
ˆÜ 
;
ÜÜ 
var
àà 
headerCursor
àà 
=
àà 
await
àà  
session
àà! (
.
àà( )
RunAsync
àà) 1
(
àà1 2
headerCypher
àà2 >
,
àà> ?
new
àà@ C
{
ààD E
tripId
ààF L
}
ààM N
)
ààN O
;
ààO P
var
ââ 
headerRecords
ââ 
=
ââ 
await
ââ !
headerCursor
ââ" .
.
ââ. /
ToListAsync
ââ/ :
(
ââ: ;
)
ââ; <
;
ââ< =
var
ää 
header
ää 
=
ää 
headerRecords
ää "
.
ää" #
SingleOrDefault
ää# 2
(
ää2 3
)
ää3 4
;
ää4 5
if
åå 

(
åå 
header
åå 
==
åå 
null
åå 
)
åå 
return
çç 
null
çç 
;
çç 
var
èè 
overview
èè 
=
èè 
new
èè 
TripOverview
èè '
{
êê 	
TripId
ëë 
=
ëë 
header
ëë $
[
ëë$ %
$str
ëë% -
]
ëë- .
.
ëë. /
As
ëë/ 1
<
ëë1 2
int
ëë2 5
>
ëë5 6
(
ëë6 7
)
ëë7 8
,
ëë8 9
TripName
íí 
=
íí 
header
íí $
[
íí$ %
$str
íí% /
]
íí/ 0
.
íí0 1
As
íí1 3
<
íí3 4
string
íí4 :
>
íí: ;
(
íí; <
)
íí< =
,
íí= >
TripStartDate
ìì 
=
ìì 
ParseIsoDate
ìì *
(
ìì* +
header
ìì+ 1
[
ìì1 2
$str
ìì2 A
]
ììA B
)
ììB C
,
ììC D
TripEndDate
îî 
=
îî 
ParseIsoDate
îî *
(
îî* +
header
îî+ 1
[
îî1 2
$str
îî2 ?
]
îî? @
)
îî@ A
,
îîA B

MaxBuddies
ïï 
=
ïï 
header
ïï $
[
ïï$ %
$str
ïï% 1
]
ïï1 2
.
ïï2 3
As
ïï3 5
<
ïï5 6
int
ïï6 9
>
ïï9 :
(
ïï: ;
)
ïï; <
,
ïï< =
TripDescription
ññ 
=
ññ 
header
ññ $
[
ññ$ %
$str
ññ% 6
]
ññ6 7
.
ññ7 8
As
ññ8 :
<
ññ: ;
string
ññ; A
>
ññA B
(
ññB C
)
ññC D
,
ññD E
OwnerUserId
óó 
=
óó 
header
óó $
[
óó$ %
$str
óó% 2
]
óó2 3
.
óó3 4
As
óó4 6
<
óó6 7
int
óó7 :
>
óó: ;
(
óó; <
)
óó< =
,
óó= >
	OwnerName
òò 
=
òò 
header
òò $
[
òò$ %
$str
òò% 0
]
òò0 1
.
òò1 2
As
òò2 4
<
òò4 5
string
òò5 ;
>
òò; <
(
òò< =
)
òò= >
,
òò> ?
Destinations
ôô 
=
ôô 
new
ôô !
List
ôô" &
<
ôô& ''
SimplifiedTripDestination
ôô' @
>
ôô@ A
(
ôôA B
)
ôôB C
}
öö 	
;
öö	 

var
ùù 

destCypher
ùù 
=
ùù 
$str
ùÆ 
;
ÆÆ 
var
∞∞ 

destCursor
∞∞ 
=
∞∞ 
await
∞∞ 
session
∞∞ &
.
∞∞& '
RunAsync
∞∞' /
(
∞∞/ 0

destCypher
∞∞0 :
,
∞∞: ;
new
∞∞< ?
{
∞∞@ A
tripId
∞∞B H
}
∞∞I J
)
∞∞J K
;
∞∞K L
var
±± 
destRecords
±± 
=
±± 
await
±± 

destCursor
±±  *
.
±±* +
ToListAsync
±±+ 6
(
±±6 7
)
±±7 8
;
±±8 9
var
≥≥ 
dests
≥≥ 
=
≥≥ 
new
≥≥ 
List
≥≥ 
<
≥≥ '
SimplifiedTripDestination
≥≥ 6
>
≥≥6 7
(
≥≥7 8
)
≥≥8 9
;
≥≥9 :
foreach
µµ 
(
µµ 
var
µµ 
r
µµ 
in
µµ 
destRecords
µµ %
)
µµ% &
{
∂∂ 	
dests
∑∑ 
.
∑∑ 
Add
∑∑ 
(
∑∑ 
new
∑∑ '
SimplifiedTripDestination
∑∑ 3
{
∏∏ 
TripDestinationId
ππ !
=
ππ% &
r
ππ' (
[
ππ( )
$str
ππ) <
]
ππ< =
.
ππ= >
As
ππ> @
<
ππ@ A
int
ππA D
>
ππD E
(
ππE F
)
ππF G
,
ππG H
TripId
∫∫ 
=
∫∫% &
r
∫∫' (
[
∫∫( )
$str
∫∫) 1
]
∫∫1 2
.
∫∫2 3
As
∫∫3 5
<
∫∫5 6
int
∫∫6 9
>
∫∫9 :
(
∫∫: ;
)
∫∫; <
,
∫∫< ="
DestinationStartDate
ªª $
=
ªª% &
ParseIsoDate
ªª' 3
(
ªª3 4
r
ªª4 5
[
ªª5 6
$str
ªª6 L
]
ªªL M
)
ªªM N
,
ªªN O 
DestinationEndDate
ºº "
=
ºº% &
ParseIsoDate
ºº' 3
(
ºº3 4
r
ºº4 5
[
ºº5 6
$str
ºº6 J
]
ººJ K
)
ººK L
,
ººL M
DestinationName
ΩΩ 
=
ΩΩ% &
r
ΩΩ' (
[
ΩΩ( )
$str
ΩΩ) :
]
ΩΩ: ;
.
ΩΩ; <
As
ΩΩ< >
<
ΩΩ> ?
string
ΩΩ? E
>
ΩΩE F
(
ΩΩF G
)
ΩΩG H
,
ΩΩH I
DestinationState
ææ  
=
ææ% &
r
ææ' (
[
ææ( )
$str
ææ) ;
]
ææ; <
.
ææ< =
As
ææ= ?
<
ææ? @
string
ææ@ F
?
ææF G
>
ææG H
(
ææH I
)
ææI J
,
ææJ K 
DestinationCountry
øø "
=
øø% &
r
øø' (
[
øø( )
$str
øø) =
]
øø= >
.
øø> ?
As
øø? A
<
øøA B
string
øøB H
>
øøH I
(
øøI J
)
øøJ K
,
øøK L

MaxBuddies
¿¿ 
=
¿¿% &
r
¿¿' (
[
¿¿( )
$str
¿¿) 5
]
¿¿5 6
.
¿¿6 7
As
¿¿7 9
<
¿¿9 :
int
¿¿: =
>
¿¿= >
(
¿¿> ?
)
¿¿? @
,
¿¿@ A"
AcceptedBuddiesCount
¡¡ $
=
¡¡% &
r
¡¡' (
[
¡¡( )
$str
¡¡) :
]
¡¡: ;
.
¡¡; <
As
¡¡< >
<
¡¡> ?
int
¡¡? B
>
¡¡B C
(
¡¡C D
)
¡¡D E
}
¬¬ 
)
¬¬ 
;
¬¬ 
}
√√ 	
overview
≈≈ 
.
≈≈ 
Destinations
≈≈ 
=
≈≈ 
dests
≈≈  %
;
≈≈% &
return
∆∆ 
overview
∆∆ 
;
∆∆ 
}
«« 
public
ÃÃ 

async
ÃÃ 
Task
ÃÃ 
<
ÃÃ 
List
ÃÃ 
<
ÃÃ 
TripOverview
ÃÃ '
>
ÃÃ' (
>
ÃÃ( )(
GetOwnedTripOverviewsAsync
ÃÃ* D
(
ÃÃD E
int
ÃÃE H
userId
ÃÃI O
)
ÃÃO P
{
ÕÕ 
await
ŒŒ 
using
ŒŒ 
var
ŒŒ 
session
ŒŒ 
=
ŒŒ  !
_driver
ŒŒ" )
.
ŒŒ) *
AsyncSession
ŒŒ* 6
(
ŒŒ6 7
)
ŒŒ7 8
;
ŒŒ8 9
var
—— 
headerCypher
—— 
=
—— 
$str
—· 
;
·· 
var
„„ 
headerCursor
„„ 
=
„„ 
await
„„  
session
„„! (
.
„„( )
RunAsync
„„) 1
(
„„1 2
headerCypher
„„2 >
,
„„> ?
new
„„@ C
{
„„D E
userId
„„F L
}
„„M N
)
„„N O
;
„„O P
var
‰‰ 
headerRecords
‰‰ 
=
‰‰ 
await
‰‰ !
headerCursor
‰‰" .
.
‰‰. /
ToListAsync
‰‰/ :
(
‰‰: ;
)
‰‰; <
;
‰‰< =
if
ÊÊ 

(
ÊÊ 
!
ÊÊ 
headerRecords
ÊÊ 
.
ÊÊ 
Any
ÊÊ 
(
ÊÊ 
)
ÊÊ  
)
ÊÊ  !
return
ÁÁ 
new
ÁÁ 
List
ÁÁ 
<
ÁÁ 
TripOverview
ÁÁ (
>
ÁÁ( )
(
ÁÁ) *
)
ÁÁ* +
;
ÁÁ+ ,
var
ÈÈ 
tripIds
ÈÈ 
=
ÈÈ 
headerRecords
ÈÈ #
.
ÍÍ 
Select
ÍÍ 
(
ÍÍ 
r
ÍÍ 
=>
ÍÍ 
r
ÍÍ 
[
ÍÍ 
$str
ÍÍ #
]
ÍÍ# $
.
ÍÍ$ %
As
ÍÍ% '
<
ÍÍ' (
int
ÍÍ( +
>
ÍÍ+ ,
(
ÍÍ, -
)
ÍÍ- .
)
ÍÍ. /
.
ÎÎ 
Distinct
ÎÎ 
(
ÎÎ 
)
ÎÎ 
.
ÏÏ 
ToList
ÏÏ 
(
ÏÏ 
)
ÏÏ 
;
ÏÏ 
var
ÔÔ 

destCypher
ÔÔ 
=
ÔÔ 
$str
ÔÅ 
;
ÅÅ 
var
ÉÉ 

destCursor
ÉÉ 
=
ÉÉ 
await
ÉÉ 
session
ÉÉ &
.
ÉÉ& '
RunAsync
ÉÉ' /
(
ÉÉ/ 0

destCypher
ÉÉ0 :
,
ÉÉ: ;
new
ÉÉ< ?
{
ÉÉ@ A
tripIds
ÉÉB I
}
ÉÉJ K
)
ÉÉK L
;
ÉÉL M
var
ÑÑ 
destRecords
ÑÑ 
=
ÑÑ 
await
ÑÑ 

destCursor
ÑÑ  *
.
ÑÑ* +
ToListAsync
ÑÑ+ 6
(
ÑÑ6 7
)
ÑÑ7 8
;
ÑÑ8 9
var
áá 

destLookup
áá 
=
áá 
destRecords
áá $
.
àà 
GroupBy
àà 
(
àà 
r
àà 
=>
àà 
r
àà 
[
àà 
$str
àà $
]
àà$ %
.
àà% &
As
àà& (
<
àà( )
int
àà) ,
>
àà, -
(
àà- .
)
àà. /
)
àà/ 0
.
ââ 
ToDictionary
ââ 
(
ââ 
g
ää 
=>
ää 
g
ää 
.
ää 
Key
ää 
,
ää 
g
ãã 
=>
ãã 
g
ãã 
.
ãã 
Select
ãã 
(
ãã 
r
ãã 
=>
ãã  "
new
ãã# &'
SimplifiedTripDestination
ãã' @
{
åå 
TripDestinationId
çç %
=
çç) *
r
çç+ ,
[
çç, -
$str
çç- @
]
çç@ A
.
ççA B
As
ççB D
<
ççD E
int
ççE H
>
ççH I
(
ççI J
)
ççJ K
,
ççK L
TripId
éé 
=
éé) *
r
éé+ ,
[
éé, -
$str
éé- 5
]
éé5 6
.
éé6 7
As
éé7 9
<
éé9 :
int
éé: =
>
éé= >
(
éé> ?
)
éé? @
,
éé@ A"
DestinationStartDate
èè (
=
èè) *
ParseIsoDate
èè+ 7
(
èè7 8
r
èè8 9
[
èè9 :
$str
èè: P
]
èèP Q
)
èèQ R
,
èèR S 
DestinationEndDate
êê &
=
êê) *
ParseIsoDate
êê+ 7
(
êê7 8
r
êê8 9
[
êê9 :
$str
êê: N
]
êêN O
)
êêO P
,
êêP Q
DestinationName
ëë #
=
ëë) *
r
ëë+ ,
[
ëë, -
$str
ëë- >
]
ëë> ?
.
ëë? @
As
ëë@ B
<
ëëB C
string
ëëC I
>
ëëI J
(
ëëJ K
)
ëëK L
,
ëëL M
DestinationState
íí $
=
íí) *
r
íí+ ,
[
íí, -
$str
íí- ?
]
íí? @
.
íí@ A
As
ííA C
<
ííC D
string
ííD J
?
ííJ K
>
ííK L
(
ííL M
)
ííM N
,
ííN O 
DestinationCountry
ìì &
=
ìì) *
r
ìì+ ,
[
ìì, -
$str
ìì- A
]
ììA B
.
ììB C
As
ììC E
<
ììE F
string
ììF L
>
ììL M
(
ììM N
)
ììN O
,
ììO P

MaxBuddies
îî 
=
îî) *
r
îî+ ,
[
îî, -
$str
îî- 9
]
îî9 :
.
îî: ;
As
îî; =
<
îî= >
int
îî> A
>
îîA B
(
îîB C
)
îîC D
,
îîD E"
AcceptedBuddiesCount
ïï (
=
ïï) *
r
ïï+ ,
[
ïï, -
$str
ïï- >
]
ïï> ?
.
ïï? @
As
ïï@ B
<
ïïB C
int
ïïC F
>
ïïF G
(
ïïG H
)
ïïH I
}
ññ 
)
ññ 
.
ññ 
ToList
ññ 
(
ññ 
)
ññ 
)
óó 
;
óó 
var
ôô 
	overviews
ôô 
=
ôô 
new
ôô 
List
ôô  
<
ôô  !
TripOverview
ôô! -
>
ôô- .
(
ôô. /
)
ôô/ 0
;
ôô0 1
foreach
õõ 
(
õõ 
var
õõ 
h
õõ 
in
õõ 
headerRecords
õõ '
)
õõ' (
{
úú 	
var
ùù 
id
ùù 
=
ùù 
h
ùù 
[
ùù 
$str
ùù 
]
ùù  
.
ùù  !
As
ùù! #
<
ùù# $
int
ùù$ '
>
ùù' (
(
ùù( )
)
ùù) *
;
ùù* +
	overviews
üü 
.
üü 
Add
üü 
(
üü 
new
üü 
TripOverview
üü *
{
†† 
TripId
°° 
=
°°  !
id
°°" $
,
°°$ %
TripName
¢¢ 
=
¢¢  !
h
¢¢" #
[
¢¢# $
$str
¢¢$ .
]
¢¢. /
.
¢¢/ 0
As
¢¢0 2
<
¢¢2 3
string
¢¢3 9
>
¢¢9 :
(
¢¢: ;
)
¢¢; <
,
¢¢< =
TripStartDate
££ 
=
££  !
ParseIsoDate
££" .
(
££. /
h
££/ 0
[
££0 1
$str
££1 @
]
££@ A
)
££A B
,
££B C
TripEndDate
§§ 
=
§§  !
ParseIsoDate
§§" .
(
§§. /
h
§§/ 0
[
§§0 1
$str
§§1 >
]
§§> ?
)
§§? @
,
§§@ A

MaxBuddies
•• 
=
••  !
h
••" #
[
••# $
$str
••$ 0
]
••0 1
.
••1 2
As
••2 4
<
••4 5
int
••5 8
>
••8 9
(
••9 :
)
••: ;
,
••; <
TripDescription
¶¶ 
=
¶¶  !
h
¶¶" #
[
¶¶# $
$str
¶¶$ 5
]
¶¶5 6
.
¶¶6 7
As
¶¶7 9
<
¶¶9 :
string
¶¶: @
>
¶¶@ A
(
¶¶A B
)
¶¶B C
,
¶¶C D
OwnerUserId
ßß 
=
ßß  !
h
ßß" #
[
ßß# $
$str
ßß$ 1
]
ßß1 2
.
ßß2 3
As
ßß3 5
<
ßß5 6
int
ßß6 9
>
ßß9 :
(
ßß: ;
)
ßß; <
,
ßß< =
	OwnerName
®® 
=
®®  !
h
®®" #
[
®®# $
$str
®®$ /
]
®®/ 0
.
®®0 1
As
®®1 3
<
®®3 4
string
®®4 :
>
®®: ;
(
®®; <
)
®®< =
,
®®= >
Destinations
©© 
=
©©  !

destLookup
©©" ,
.
©©, -
TryGetValue
©©- 8
(
©©8 9
id
©©9 ;
,
©©; <
out
©©= @
var
©©A D
dests
©©E J
)
©©J K
?
™™ 
dests
™™ 
:
´´ 
new
´´ 
List
´´ 
<
´´ '
SimplifiedTripDestination
´´ 8
>
´´8 9
(
´´9 :
)
´´: ;
}
¨¨ 
)
¨¨ 
;
¨¨ 
}
≠≠ 	
return
ØØ 
	overviews
ØØ 
;
ØØ 
}
∞∞ 
public
µµ 

async
µµ 
Task
µµ 
<
µµ 
int
µµ 
?
µµ 
>
µµ 
GetTripOwnerAsync
µµ -
(
µµ- .
int
µµ. 1
tripDestinationId
µµ2 C
)
µµC D
{
∂∂ 
await
∑∑ 
using
∑∑ 
var
∑∑ 
session
∑∑ 
=
∑∑  !
_driver
∑∑" )
.
∑∑) *
AsyncSession
∑∑* 6
(
∑∑6 7
)
∑∑7 8
;
∑∑8 9
var
ππ 
cypher
ππ 
=
ππ 
$str
πΩ 
;
ΩΩ 
var
øø 
cursor
øø 
=
øø 
await
øø 
session
øø "
.
øø" #
RunAsync
øø# +
(
øø+ ,
cypher
øø, 2
,
øø2 3
new
øø4 7
{
øø8 9
tripDestinationId
øø: K
}
øøL M
)
øøM N
;
øøN O
var
¿¿ 
records
¿¿ 
=
¿¿ 
await
¿¿ 
cursor
¿¿ "
.
¿¿" #
ToListAsync
¿¿# .
(
¿¿. /
)
¿¿/ 0
;
¿¿0 1
var
¡¡ 
record
¡¡ 
=
¡¡ 
records
¡¡ 
.
¡¡ 
SingleOrDefault
¡¡ ,
(
¡¡, -
)
¡¡- .
;
¡¡. /
if
√√ 

(
√√ 
record
√√ 
==
√√ 
null
√√ 
)
√√ 
return
ƒƒ 
null
ƒƒ 
;
ƒƒ 
var
∆∆ 

ownerValue
∆∆ 
=
∆∆ 
record
∆∆ 
[
∆∆  
$str
∆∆  )
]
∆∆) *
;
∆∆* +
if
«« 

(
«« 

ownerValue
«« 
==
«« 
null
«« 
)
«« 
return
»» 
null
»» 
;
»» 
return
   
record
   
[
   
$str
   
]
    
.
    !
As
  ! #
<
  # $
int
  $ '
>
  ' (
(
  ( )
)
  ) *
;
  * +
}
ÀÀ 
public
–– 

async
–– 
Task
–– 
<
–– 
(
–– 
bool
–– 
Success
–– #
,
––# $
string
––% +
?
––+ ,
ErrorMessage
––- 9
)
––9 :
>
––: ;-
CreateTripWithDestinationsAsync
––< [
(
––[ \+
CreateTripWithDestinationsDto
—— !
dto
——" %
)
——% &
{
““ 
await
”” 
using
”” 
var
”” 
session
”” 
=
””  !
_driver
””" )
.
””) *
AsyncSession
””* 6
(
””6 7
)
””7 8
;
””8 9
try
’’ 
{
÷÷ 	
var
ÿÿ 
tripIdCursor
ÿÿ 
=
ÿÿ 
await
ÿÿ $
session
ÿÿ% ,
.
ÿÿ, -
RunAsync
ÿÿ- 5
(
ÿÿ5 6
$str
ÿ€6 
)
€€ 
;
€€ 
var
‹‹ 
tripIdRecord
‹‹ 
=
‹‹ 
await
‹‹  %
tripIdCursor
‹‹& 2
.
‹‹2 3
SingleAsync
‹‹3 >
(
‹‹> ?
)
‹‹? @
;
‹‹@ A
var
›› 

nextTripId
›› 
=
›› 
tripIdRecord
››  ,
[
››, -
$str
››- 4
]
››4 5
.
››5 6
As
››6 8
<
››8 9
int
››9 <
>
››< =
(
››= >
)
››> ?
+
››@ A
$num
››B C
;
››C D
var
ﬂﬂ 
tripDestIdCursor
ﬂﬂ  
=
ﬂﬂ! "
await
ﬂﬂ# (
session
ﬂﬂ) 0
.
ﬂﬂ0 1
RunAsync
ﬂﬂ1 9
(
ﬂﬂ9 :
$str
ﬂ‚: 
)
‚‚ 
;
‚‚ 
var
„„ 
tripDestIdRecord
„„  
=
„„# $
await
„„% *
tripDestIdCursor
„„+ ;
.
„„; <
SingleAsync
„„< G
(
„„G H
)
„„H I
;
„„I J
var
‰‰ 
nextTripDestId
‰‰ 
=
‰‰# $
tripDestIdRecord
‰‰% 5
[
‰‰5 6
$str
‰‰6 =
]
‰‰= >
.
‰‰> ?
As
‰‰? A
<
‰‰A B
int
‰‰B E
>
‰‰E F
(
‰‰F G
)
‰‰G H
+
‰‰I J
$num
‰‰K L
;
‰‰L M
var
ÊÊ 
destIdCursor
ÊÊ 
=
ÊÊ 
await
ÊÊ $
session
ÊÊ% ,
.
ÊÊ, -
RunAsync
ÊÊ- 5
(
ÊÊ5 6
$str
ÊÈ6 
)
ÈÈ 
;
ÈÈ 
var
ÍÍ 
destIdRecord
ÍÍ 
=
ÍÍ" #
await
ÍÍ$ )
destIdCursor
ÍÍ* 6
.
ÍÍ6 7
SingleAsync
ÍÍ7 B
(
ÍÍB C
)
ÍÍC D
;
ÍÍD E
var
ÎÎ 
nextDestinationId
ÎÎ !
=
ÎÎ" #
destIdRecord
ÎÎ$ 0
[
ÎÎ0 1
$str
ÎÎ1 8
]
ÎÎ8 9
.
ÎÎ9 :
As
ÎÎ: <
<
ÎÎ< =
int
ÎÎ= @
>
ÎÎ@ A
(
ÎÎA B
)
ÎÎB C
+
ÎÎD E
$num
ÎÎF G
;
ÎÎG H
if
ÓÓ 
(
ÓÓ 
dto
ÓÓ 
.
ÓÓ 
TripDestinations
ÓÓ $
==
ÓÓ% '
null
ÓÓ( ,
||
ÓÓ- /
!
ÓÓ0 1
dto
ÓÓ1 4
.
ÓÓ4 5
TripDestinations
ÓÓ5 E
.
ÓÓE F
Any
ÓÓF I
(
ÓÓI J
)
ÓÓJ K
)
ÓÓK L
{
ÔÔ 
return
 
(
 
false
 
,
 
$str
 K
)
K L
;
L M
}
ÒÒ 
var
ÛÛ 
t
ÛÛ 
=
ÛÛ 
dto
ÛÛ 
.
ÛÛ 

CreateTrip
ÛÛ "
;
ÛÛ" #
var
ˆˆ 
tx
ˆˆ 
=
ˆˆ 
await
ˆˆ 
session
ˆˆ "
.
ˆˆ" ##
BeginTransactionAsync
ˆˆ# 8
(
ˆˆ8 9
)
ˆˆ9 :
;
ˆˆ: ;
try
˜˜ 
{
¯¯ 
await
˙˙ 
tx
˙˙ 
.
˙˙ 
RunAsync
˙˙ !
(
˙˙! "
$str
˙Ü" 
,
ÜÜ 
new
áá 
{
àà 
ownerId
ââ 
=
ââ# $
t
ââ% &
.
ââ& '
OwnerId
ââ' .
,
ââ. /
tripId
ää 
=
ää# $

nextTripId
ää% /
,
ää/ 0
tripName
ãã  
=
ãã# $
t
ãã% &
.
ãã& '
TripName
ãã' /
,
ãã/ 0

maxBuddies
åå "
=
åå# $
t
åå% &
.
åå& '

MaxBuddies
åå' 1
,
åå1 2
	startDate
çç !
=
çç# $
t
çç% &
.
çç& '
	StartDate
çç' 0
.
çç0 1
ToString
çç1 9
(
çç9 :
$str
çç: F
)
ççF G
,
ççG H
endDate
éé 
=
éé# $
t
éé% &
.
éé& '
EndDate
éé' .
.
éé. /
ToString
éé/ 7
(
éé7 8
$str
éé8 D
)
ééD E
,
ééE F
description
èè #
=
èè# $
t
èè% &
.
èè& '
Description
èè' 2
??
èè3 5
string
èè6 <
.
èè< =
Empty
èè= B
}
êê 
)
êê 
;
êê 
int
ìì 
sequence
ìì 
=
ìì 
$num
ìì  
;
ìì  !
int
îî 
currentTripDestId
îî %
=
îî& '
nextTripDestId
îî( 6
;
îî6 7
int
ïï 
currentDestId
ïï !
=
ïï& '
nextDestinationId
ïï( 9
;
ïï9 :
foreach
óó 
(
óó 
var
óó 
d
óó 
in
óó !
dto
óó" %
.
óó% &
TripDestinations
óó& 6
)
óó6 7
{
òò 
int
öö 
destinationId
öö %
;
öö% &
if
õõ 
(
õõ 
d
õõ 
.
õõ 
DestinationId
õõ '
.
õõ' (
HasValue
õõ( 0
&&
õõ1 3
d
õõ4 5
.
õõ5 6
DestinationId
õõ6 C
.
õõC D
Value
õõD I
>
õõJ K
$num
õõL M
)
õõM N
{
úú 
destinationId
ùù %
=
ùù& '
d
ùù( )
.
ùù) *
DestinationId
ùù* 7
.
ùù7 8
Value
ùù8 =
;
ùù= >
await
†† 
tx
††  
.
††  !
RunAsync
††! )
(
††) *
$str
†®* 
,
®® 
new
©© 
{
™™ 
destinationId
´´  -
,
´´- .
name
¨¨  $
=
¨¨* +
d
¨¨, -
.
¨¨- .
Name
¨¨. 2
??
¨¨3 5
$str
¨¨6 ?
,
¨¨? @
state
≠≠  %
=
≠≠* +
d
≠≠, -
.
≠≠- .
State
≠≠. 3
,
≠≠3 4
country
ÆÆ  '
=
ÆÆ* +
d
ÆÆ, -
.
ÆÆ- .
Country
ÆÆ. 5
??
ÆÆ6 8
string
ÆÆ9 ?
.
ÆÆ? @
Empty
ÆÆ@ E
,
ÆÆE F
	longitude
ØØ  )
=
ØØ* +
d
ØØ, -
.
ØØ- .
	Longitude
ØØ. 7
,
ØØ7 8
latitude
∞∞  (
=
∞∞* +
d
∞∞, -
.
∞∞- .
Latitude
∞∞. 6
}
±± 
)
±± 
;
±± 
}
≤≤ 
else
≥≥ 
{
¥¥ 
destinationId
µµ %
=
µµ& '
currentDestId
µµ( 5
++
µµ5 7
;
µµ7 8
await
∑∑ 
tx
∑∑  
.
∑∑  !
RunAsync
∑∑! )
(
∑∑) *
$str
∑¿* 
,
¿¿ 
new
¡¡ 
{
¬¬ 
destinationId
√√  -
,
√√- .
name
ƒƒ  $
=
ƒƒ* +
d
ƒƒ, -
.
ƒƒ- .
Name
ƒƒ. 2
??
ƒƒ3 5
$str
ƒƒ6 ?
,
ƒƒ? @
state
≈≈  %
=
≈≈* +
d
≈≈, -
.
≈≈- .
State
≈≈. 3
,
≈≈3 4
country
∆∆  '
=
∆∆* +
d
∆∆, -
.
∆∆- .
Country
∆∆. 5
??
∆∆6 8
string
∆∆9 ?
.
∆∆? @
Empty
∆∆@ E
,
∆∆E F
	longitude
««  )
=
««* +
d
««, -
.
««- .
	Longitude
««. 7
,
««7 8
latitude
»»  (
=
»»* +
d
»», -
.
»»- .
Latitude
»». 6
}
…… 
)
…… 
;
…… 
}
   
var
ÕÕ 
	seqNumber
ÕÕ !
=
ÕÕ" #
d
ÕÕ$ %
.
ÕÕ% &
SequenceNumber
ÕÕ& 4
==
ÕÕ5 7
$num
ÕÕ8 9
?
ÕÕ: ;
sequence
ÕÕ< D
:
ÕÕE F
d
ÕÕG H
.
ÕÕH I
SequenceNumber
ÕÕI W
;
ÕÕW X
await
œœ 
tx
œœ 
.
œœ 
RunAsync
œœ %
(
œœ% &
$str
œŸ& 
,
ŸŸ 
new
⁄⁄ 
{
€€ 
tripId
‹‹ "
=
‹‹. /

nextTripId
‹‹0 :
,
‹‹: ;
destinationId
›› )
,
››) *
tripDestinationId
ﬁﬁ -
=
ﬁﬁ. /
currentTripDestId
ﬁﬁ0 A
++
ﬁﬁA C
,
ﬁﬁC D
	startDate
ﬂﬂ %
=
ﬂﬂ. /
d
ﬂﬂ0 1
.
ﬂﬂ1 2"
DestinationStartDate
ﬂﬂ2 F
.
ﬂﬂF G
ToString
ﬂﬂG O
(
ﬂﬂO P
$str
ﬂﬂP \
)
ﬂﬂ\ ]
,
ﬂﬂ] ^
endDate
‡‡ #
=
‡‡. /
d
‡‡0 1
.
‡‡1 2 
DestinationEndDate
‡‡2 D
.
‡‡D E
ToString
‡‡E M
(
‡‡M N
$str
‡‡N Z
)
‡‡Z [
,
‡‡[ \
sequenceNumber
·· *
=
··. /
	seqNumber
··0 9
,
··9 :
description
‚‚ '
=
‚‚. /
d
‚‚0 1
.
‚‚1 2
Description
‚‚2 =
??
‚‚> @
string
‚‚A G
.
‚‚G H
Empty
‚‚H M
}
„„ 
)
„„ 
;
„„ 
sequence
ÂÂ 
++
ÂÂ 
;
ÂÂ 
}
ÊÊ 
await
ËË 
tx
ËË 
.
ËË 
CommitAsync
ËË $
(
ËË$ %
)
ËË% &
;
ËË& '
return
ÈÈ 
(
ÈÈ 
true
ÈÈ 
,
ÈÈ 
null
ÈÈ "
)
ÈÈ" #
;
ÈÈ# $
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
ex
ÎÎ 
)
ÎÎ  
{
ÏÏ 
await
ÌÌ 
tx
ÌÌ 
.
ÌÌ 
RollbackAsync
ÌÌ &
(
ÌÌ& '
)
ÌÌ' (
;
ÌÌ( )
return
ÓÓ 
(
ÓÓ 
false
ÓÓ 
,
ÓÓ 
$str
ÓÓ Q
+
ÓÓR S
ex
ÓÓT V
.
ÓÓV W
Message
ÓÓW ^
)
ÓÓ^ _
;
ÓÓ_ `
}
ÔÔ 
}
 	
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
exOuter
ÒÒ  
)
ÒÒ  !
{
ÚÚ 	
return
ÛÛ 
(
ÛÛ 
false
ÛÛ 
,
ÛÛ 
$str
ÛÛ U
+
ÛÛV W
exOuter
ÛÛX _
.
ÛÛ_ `
Message
ÛÛ` g
)
ÛÛg h
;
ÛÛh i
}
ÙÙ 	
}
ıı 
public
˙˙ 

async
˙˙ 
Task
˙˙ 
<
˙˙ 
(
˙˙ 
bool
˙˙ 
Success
˙˙ #
,
˙˙# $
string
˙˙% +
?
˙˙+ ,
ErrorMessage
˙˙- 9
)
˙˙9 :
>
˙˙: ;'
LeaveTripDestinationAsync
˙˙< U
(
˙˙U V
int
˚˚ 
userId
˚˚ 
,
˚˚ 
int
¸¸ 
tripDestinationId
¸¸ 
,
¸¸ 
int
˝˝ 
	changedBy
˝˝ 
,
˝˝ 
string
˛˛ 
departureReason
˛˛ 
)
˛˛ 
{
ˇˇ 
await
ÄÄ 
using
ÄÄ 
var
ÄÄ 
session
ÄÄ 
=
ÄÄ  !
_driver
ÄÄ" )
.
ÄÄ) *
AsyncSession
ÄÄ* 6
(
ÄÄ6 7
)
ÄÄ7 8
;
ÄÄ8 9
var
ÇÇ 
cypher
ÇÇ 
=
ÇÇ 
$str
Çà 
;
àà 
var
ää 
cursor
ää 
=
ää 
await
ää 
session
ää "
.
ää" #
RunAsync
ää# +
(
ää+ ,
cypher
ää, 2
,
ää2 3
new
ää4 7
{
ãã 	
userId
åå 
,
åå 
tripDestinationId
çç 
,
çç 
departureReason
éé 
}
èè 	
)
èè	 

;
èè
 
var
ëë 
record
ëë 
=
ëë 
await
ëë 
cursor
ëë !
.
ëë! "
SingleAsync
ëë" -
(
ëë- .
)
ëë. /
;
ëë/ 0
var
íí 
updatedCount
íí 
=
íí 
record
íí !
[
íí! "
$str
íí" 0
]
íí0 1
.
íí1 2
As
íí2 4
<
íí4 5
long
íí5 9
>
íí9 :
(
íí: ;
)
íí; <
;
íí< =
if
îî 

(
îî 
updatedCount
îî 
==
îî 
$num
îî 
)
îî 
{
ïï 	
return
ññ 
(
ññ 
false
ññ 
,
ññ 
$str
ññ G
)
ññG H
;
ññH I
}
óó 	
return
ôô 
(
ôô 
true
ôô 
,
ôô 
null
ôô 
)
ôô 
;
ôô 
}
öö 
public
üü 

async
üü 
Task
üü 
<
üü 
IEnumerable
üü !
<
üü! "!
PendingBuddyRequest
üü" 5
>
üü5 6
>
üü6 7*
GetPendingBuddyRequestsAsync
üü8 T
(
üüT U
int
üüU X
userId
üüY _
)
üü_ `
{†† 
await
°° 	
using
°°
 
var
°° 
session
°° 
=
°° 
_driver
°° %
.
°°% &
AsyncSession
°°& 2
(
°°2 3
)
°°3 4
;
°°4 5
var
££ 
cypher
££ 
=
££ 
$str
£≥ 
;
≥≥ 
var
µµ 
cursor
µµ 
=
µµ 
await
µµ 
session
µµ 
.
µµ 
RunAsync
µµ '
(
µµ' (
cypher
µµ( .
,
µµ. /
new
µµ0 3
{
µµ4 5
userId
µµ6 <
}
µµ= >
)
µµ> ?
;
µµ? @
var
∂∂ 
records
∂∂ 
=
∂∂ 
await
∂∂ 
cursor
∂∂ 
.
∂∂ 
ToListAsync
∂∂ *
(
∂∂* +
)
∂∂+ ,
;
∂∂, -
var
∏∏ 
list
∏∏ 
=
∏∏ 
new
∏∏ 
List
∏∏ 
<
∏∏ !
PendingBuddyRequest
∏∏ +
>
∏∏+ ,
(
∏∏, -
)
∏∏- .
;
∏∏. /
foreach
∫∫ 
(
∫∫ 
var
∫∫ 
r
∫∫ 
in
∫∫ 
records
∫∫ 
)
∫∫ 
{
ªª 
int
ºº 
?
ºº 
buddyIdNullable
ºº 
=
ºº 
r
ºº  
[
ºº  !
$str
ºº! *
]
ºº* +
.
ºº+ ,
As
ºº, .
<
ºº. /
int
ºº/ 2
?
ºº2 3
>
ºº3 4
(
ºº4 5
)
ºº5 6
;
ºº6 7
int
ΩΩ 
buddyId
ΩΩ 
=
ΩΩ 
buddyIdNullable
ΩΩ %
??
ΩΩ& (
$num
ΩΩ) *
;
ΩΩ* +
list
øø 
.
øø 
Add
øø 
(
øø 
new
øø !
PendingBuddyRequest
øø (
{
¿¿ 	
TripDestinationId
¡¡ 
=
¡¡! "
r
¡¡# $
[
¡¡$ %
$str
¡¡% 8
]
¡¡8 9
.
¡¡9 :
As
¡¡: <
<
¡¡< =
int
¡¡= @
>
¡¡@ A
(
¡¡A B
)
¡¡B C
,
¡¡C D
DestinationName
¬¬ 
=
¬¬! "
r
¬¬# $
[
¬¬$ %
$str
¬¬% 6
]
¬¬6 7
.
¬¬7 8
As
¬¬8 :
<
¬¬: ;
string
¬¬; A
>
¬¬A B
(
¬¬B C
)
¬¬C D
,
¬¬D E"
DestinationStartDate
√√  
=
√√! "
ParseIsoDate
√√# /
(
√√/ 0
r
√√0 1
[
√√1 2
$str
√√2 H
]
√√H I
)
√√I J
,
√√J K 
DestinationEndDate
ƒƒ 
=
ƒƒ! "
ParseIsoDate
ƒƒ# /
(
ƒƒ/ 0
r
ƒƒ0 1
[
ƒƒ1 2
$str
ƒƒ2 F
]
ƒƒF G
)
ƒƒG H
,
ƒƒH I
TripId
≈≈ 
=
≈≈! "
r
≈≈# $
[
≈≈$ %
$str
≈≈% -
]
≈≈- .
.
≈≈. /
As
≈≈/ 1
<
≈≈1 2
int
≈≈2 5
>
≈≈5 6
(
≈≈6 7
)
≈≈7 8
,
≈≈8 9
BuddyId
∆∆ 
=
∆∆! "
buddyId
∆∆# *
,
∆∆* +
RequesterUserId
«« 
=
««! "
r
««# $
[
««$ %
$str
««% 6
]
««6 7
.
««7 8
As
««8 :
<
««: ;
int
««; >
>
««> ?
(
««? @
)
««@ A
,
««A B
RequesterName
»» 
=
»»! "
r
»»# $
[
»»$ %
$str
»»% 4
]
»»4 5
.
»»5 6
As
»»6 8
<
»»8 9
string
»»9 ?
>
»»? @
(
»»@ A
)
»»A B
,
»»B C
	BuddyNote
…… 
=
……! "
r
……# $
[
……$ %
$str
……% 0
]
……0 1
.
……1 2
As
……2 4
<
……4 5
string
……5 ;
?
……; <
>
……< =
(
……= >
)
……> ?
,
……? @
PersonCount
   
=
  ! "
r
  # $
[
  $ %
$str
  % 2
]
  2 3
.
  3 4
As
  4 6
<
  6 7
int
  7 :
>
  : ;
(
  ; <
)
  < =
}
ÀÀ 	
)
ÀÀ	 

;
ÀÀ
 
}
ÃÃ 
return
ŒŒ 

list
ŒŒ 
;
ŒŒ 
}œœ 
public
‘‘ 

async
‘‘ 
Task
‘‘ 
<
‘‘ 
(
‘‘ 
bool
‘‘ 
Success
‘‘ #
,
‘‘# $
string
‘‘% +
?
‘‘+ ,
ErrorMessage
‘‘- 9
)
‘‘9 :
>
‘‘: ;%
InsertBuddyRequestAsync
‘‘< S
(
‘‘S T
BuddyDto
‘‘T \
buddyDto
‘‘] e
)
‘‘e f
{
’’ 
await
÷÷ 
using
÷÷ 
var
÷÷ 
session
÷÷ 
=
÷÷  !
_driver
÷÷" )
.
÷÷) *
AsyncSession
÷÷* 6
(
÷÷6 7
)
÷÷7 8
;
÷÷8 9
var
ÿÿ 

newBuddyId
ÿÿ 
=
ÿÿ 
await
ÿÿ !
GetNextBuddyIdAsync
ÿÿ 2
(
ÿÿ2 3
)
ÿÿ3 4
;
ÿÿ4 5
var
⁄⁄ 
cypher
⁄⁄ 
=
⁄⁄ 
$str
⁄Í 
;
ÍÍ 
var
ÏÏ 
createCursor
ÏÏ 
=
ÏÏ 
await
ÏÏ  
session
ÏÏ! (
.
ÏÏ( )
RunAsync
ÏÏ) 1
(
ÏÏ1 2
cypher
ÏÏ2 8
,
ÏÏ8 9
new
ÏÏ: =
{
ÌÌ 	
tripDestinationId
ÓÓ 
=
ÓÓ 
buddyDto
ÓÓ  (
.
ÓÓ( )
TripDestinationId
ÓÓ) :
,
ÓÓ: ;
userId
ÔÔ 
=
ÔÔ 
buddyDto
ÔÔ  (
.
ÔÔ( )
UserId
ÔÔ) /
,
ÔÔ/ 0
buddyId
 
=
 

newBuddyId
  *
,
* +
personCount
ÒÒ 
=
ÒÒ 
buddyDto
ÒÒ  (
.
ÒÒ( )
PersonCount
ÒÒ) 4
,
ÒÒ4 5
note
ÚÚ 
=
ÚÚ 
buddyDto
ÚÚ  (
.
ÚÚ( )
Note
ÚÚ) -
}
ÛÛ 	
)
ÛÛ	 

;
ÛÛ
 
var
ıı 
created
ıı 
=
ıı 
await
ıı 
createCursor
ıı (
.
ıı( )
SingleAsync
ıı) 4
(
ıı4 5
)
ıı5 6
;
ıı6 7
if
˜˜ 

(
˜˜ 
created
˜˜ 
==
˜˜ 
null
˜˜ 
)
˜˜ 
{
¯¯ 	
return
˘˘ 
(
˘˘ 
false
˘˘ 
,
˘˘ 
$str
˘˘ E
)
˘˘E F
;
˘˘F G
}
˙˙ 	
return
¸¸ 
(
¸¸ 
true
¸¸ 
,
¸¸ 
null
¸¸ 
)
¸¸ 
;
¸¸ 
}
˝˝ 
public
ÇÇ 

async
ÇÇ 
Task
ÇÇ 
<
ÇÇ 
(
ÇÇ 
bool
ÇÇ 
Success
ÇÇ #
,
ÇÇ# $
string
ÇÇ% +
?
ÇÇ+ ,
ErrorMessage
ÇÇ- 9
)
ÇÇ9 :
>
ÇÇ: ;%
UpdateBuddyRequestAsync
ÇÇ< S
(
ÇÇS T#
UpdateBuddyRequestDto
ÉÉ #
updateBuddyRequestDto
ÉÉ 3
)
ÉÉ3 4
{
ÑÑ 
var
ÖÖ 
	newStatus
ÖÖ 
=
ÖÖ #
updateBuddyRequestDto
ÖÖ -
.
ÖÖ- .
	NewStatus
ÖÖ. 7
switch
ÖÖ8 >
{
ÜÜ 	&
BuddyRequestUpdateStatus
áá $
.
áá$ %
Accepted
áá% -
=>
áá. 0
$str
áá1 ;
,
áá; <&
BuddyRequestUpdateStatus
àà $
.
àà$ %
Rejected
àà% -
=>
àà. 0
$str
àà1 ;
,
àà; <
_
ââ 
=>
ââ 
$str
ââ 
}
ää 	
;
ää	 

await
åå 
using
åå 
var
åå 
session
åå 
=
åå  !
_driver
åå" )
.
åå) *
AsyncSession
åå* 6
(
åå6 7
)
åå7 8
;
åå8 9
var
éé 
cypher
éé 
=
éé 
$str
éî 
;
îî 
var
ññ 
cursor
ññ 
=
ññ 
await
ññ 
session
ññ "
.
ññ" #
RunAsync
ññ# +
(
ññ+ ,
cypher
ññ, 2
,
ññ2 3
new
ññ4 7
{
óó 	
buddyId
òò 
=
òò #
updateBuddyRequestDto
òò +
.
òò+ ,
BuddyId
òò, 3
,
òò3 4
status
ôô 
=
ôô 
	newStatus
ôô 
}
öö 	
)
öö	 

;
öö
 
var
úú 
record
úú 
=
úú 
await
úú 
cursor
úú !
.
úú! "
SingleAsync
úú" -
(
úú- .
)
úú. /
;
úú/ 0
var
ùù 
updatedCount
ùù 
=
ùù 
record
ùù !
[
ùù! "
$str
ùù" 0
]
ùù0 1
.
ùù1 2
As
ùù2 4
<
ùù4 5
long
ùù5 9
>
ùù9 :
(
ùù: ;
)
ùù; <
;
ùù< =
if
üü 

(
üü 
updatedCount
üü 
==
üü 
$num
üü 
)
üü 
{
†† 	
return
°° 
(
°° 
false
°° 
,
°° 
$str
°° 4
)
°°4 5
;
°°5 6
}
¢¢ 	
return
§§ 
(
§§ 
true
§§ 
,
§§ 
null
§§ 
)
§§ 
;
§§ 
}
•• 
public
™™ 

async
™™ 
Task
™™ 
<
™™ 
IEnumerable
™™ !
<
™™! "
	TripAudit
™™" +
>
™™+ ,
>
™™, - 
GetTripAuditsAsync
™™. @
(
™™@ A
)
™™A B
{
´´ 
return
¨¨ 
await
¨¨ 
Task
¨¨ 
.
¨¨ 

FromResult
¨¨ $
<
¨¨$ %
IEnumerable
¨¨% 0
<
¨¨0 1
	TripAudit
¨¨1 :
>
¨¨: ;
>
¨¨; <
(
¨¨< =
new
¨¨= @
List
¨¨A E
<
¨¨E F
	TripAudit
¨¨F O
>
¨¨O P
(
¨¨P Q
)
¨¨Q R
)
¨¨R S
;
¨¨S T
}
≠≠ 
public
ØØ 

async
ØØ 
Task
ØØ 
<
ØØ 
IEnumerable
ØØ !
<
ØØ! "

BuddyAudit
ØØ" ,
>
ØØ, -
>
ØØ- .!
GetBuddyAuditsAsync
ØØ/ B
(
ØØB C
)
ØØC D
{
∞∞ 
return
±± 
await
±± 
Task
±± 
.
±± 

FromResult
±± $
<
±±$ %
IEnumerable
±±% 0
<
±±0 1

BuddyAudit
±±1 ;
>
±±; <
>
±±< =
(
±±= >
new
±±> A
List
±±B F
<
±±F G

BuddyAudit
±±G Q
>
±±Q R
(
±±R S
)
±±S T
)
±±T U
;
±±U V
}
≤≤ 
}≥≥ Êæ
ëC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Infrastructure\MySql\TripsDbContext.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
Infrastructure *
;* +
public 
partial 
class 
TripsDbContext #
:$ %
	DbContext& /
{		 
public

 

TripsDbContext

 
(

 
DbContextOptions

 *
<

* +
TripsDbContext

+ 9
>

9 :
options

; B
)

B C
: 	
base
 
( 
options 
) 
{ 
} 
public 

virtual 
DbSet 
< 
Buddy 
> 
Buddies  '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 

virtual 
DbSet 
< 

BuddyAudit #
># $
BuddyAudits% 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 

virtual 
DbSet 
< 
Destination $
>$ %
Destinations& 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 

virtual 
DbSet 
< 
Trip 
> 
Trips $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 

virtual 
DbSet 
< 
	TripAudit "
>" #

TripAudits$ .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 

virtual 
DbSet 
< 
TripDestination (
>( )
TripDestinations* :
{; <
get= @
;@ A
setB E
;E F
}G H
public 

virtual 
DbSet 
< 
User 
> 
Users $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 

DbSet 
< '
TripDestinationSearchResult ,
>, -(
TripDestinationSearchResults. J
{K L
getM P
;P Q
setR U
;U V
}W X
public 

DbSet 
< 
BuddyTripSummary !
>! "
BuddyTripSummaries# 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public!! 

DbSet!! 
<!! 
PendingBuddyRequest!! $
>!!$ % 
PendingBuddyRequests!!& :
{!!; <
get!!= @
;!!@ A
set!!B E
;!!E F
}!!G H
public## 

DbSet## 
<## 
TripDestinationInfo## $
>##$ %
TripDestinationInfo##& 9
{##: ;
get##< ?
;##? @
set##A D
;##D E
}##F G
public%% 

DbSet%% 
<%% 
	BuddyInfo%% 
>%% 
	BuddyInfo%% %
{%%& '
get%%( +
;%%+ ,
set%%- 0
;%%0 1
}%%2 3
public'' 

DbSet'' 
<'' 
BuddyRequestInfo'' !
>''! "
BuddyRequestInfo''# 3
{''4 5
get''6 9
;''9 :
set''; >
;''> ?
}''@ A
public)) 

DbSet)) 
<)) %
SimplifiedTripDestination)) *
>))* +%
SimplifiedTripDestination)), E
{))F G
get))H K
;))K L
set))M P
;))P Q
}))R S
public** 

DbSet** 
<** 
TripHeaderInfo** 
>**  
TripHeaderInfo**! /
{**0 1
get**2 5
;**5 6
set**7 :
;**: ;
}**< =
public++ 

DbSet++ 
<++ 
TripOverview++ 
>++ 
TripOverview++ +
{++, -
get++. 1
;++1 2
set++3 6
;++6 7
}++8 9
public,, 

DbSet,, 
<,, 
	NewTripId,, 
>,, 

NewTripIds,, &
{,,' (
get,,) ,
;,,, -
set,,. 1
;,,1 2
},,3 4
	protected// 
override// 
void// 
OnModelCreating// +
(//+ ,
ModelBuilder//, 8
modelBuilder//9 E
)//E F
{00 
modelBuilder11 
.22 
UseCollation22 
(22 
$str22 .
)22. /
.33 

HasCharSet33 
(33 
$str33 !
)33! "
;33" #
modelBuilder55 
.55 
Entity55 
<55 
Buddy55 !
>55! "
(55" #
entity55# )
=>55* ,
{66 	
entity77 
.77 
HasKey77 
(77 
e77 
=>77 
e77  
.77  !
BuddyId77! (
)77( )
.77) *
HasName77* 1
(771 2
$str772 ;
)77; <
;77< =
entity99 
.99 
ToTable99 
(99 
$str99 "
)99" #
;99# $
entity;; 
.;; 
HasIndex;; 
(;; 
e;; 
=>;;  
e;;! "
.;;" #
UserId;;# )
,;;) *
$str;;+ :
);;: ;
;;;; <
entity== 
.== 
HasIndex== 
(== 
e== 
=>==  
new==! $
{==% &
e==' (
.==( )
TripDestinationId==) :
,==: ;
e==< =
.=== >
RequestStatus==> K
}==L M
,==M N
$str==O e
)==e f
;==f g
entity?? 
.?? 
Property?? 
(?? 
e?? 
=>??  
e??! "
.??" #
BuddyId??# *
)??* +
.??+ ,
HasColumnName??, 9
(??9 :
$str??: D
)??D E
;??E F
entity@@ 
.@@ 
Property@@ 
(@@ 
e@@ 
=>@@  
e@@! "
.@@" #
DepartureReason@@# 2
)@@2 3
.AA 
HasMaxLengthAA 
(AA 
$numAA !
)AA! "
.BB 
HasColumnNameBB 
(BB 
$strBB 1
)BB1 2
;BB2 3
entityCC 
.CC 
PropertyCC 
(CC 
eCC 
=>CC  
eCC! "
.CC" #
IsActiveCC# +
)CC+ ,
.DD 
HasDefaultValueSqlDD #
(DD# $
$strDD$ )
)DD) *
.EE 
HasColumnNameEE 
(EE 
$strEE *
)EE* +
;EE+ ,
entityFF 
.FF 
PropertyFF 
(FF 
eFF 
=>FF  
eFF! "
.FF" #
NoteFF# '
)FF' (
.GG 
HasMaxLengthGG 
(GG 
$numGG !
)GG! "
.HH 
HasColumnNameHH 
(HH 
$strHH %
)HH% &
;HH& '
entityII 
.II 
PropertyII 
(II 
eII 
=>II  
eII! "
.II" #
PersonCountII# .
)II. /
.JJ 
HasDefaultValueSqlJJ #
(JJ# $
$strJJ$ )
)JJ) *
.KK 
HasColumnNameKK 
(KK 
$strKK -
)KK- .
;KK. /
entityLL 
.LL 
PropertyLL 
(LL 
eLL 
=>LL  
eLL! "
.LL" #
RequestStatusLL# 0
)LL0 1
.MM 
HasDefaultValueSqlMM #
(MM# $
$strMM$ /
)MM/ 0
.NN 
HasColumnTypeNN 
(NN 
$strNN F
)NNF G
.OO 
HasColumnNameOO 
(OO 
$strOO /
)OO/ 0
;OO0 1
entityPP 
.PP 
PropertyPP 
(PP 
ePP 
=>PP  
ePP! "
.PP" #
TripDestinationIdPP# 4
)PP4 5
.PP5 6
HasColumnNamePP6 C
(PPC D
$strPPD Y
)PPY Z
;PPZ [
entityQQ 
.QQ 
PropertyQQ 
(QQ 
eQQ 
=>QQ  
eQQ! "
.QQ" #
UserIdQQ# )
)QQ) *
.QQ* +
HasColumnNameQQ+ 8
(QQ8 9
$strQQ9 B
)QQB C
;QQC D
entitySS 
.SS 
HasOneSS 
(SS 
dSS 
=>SS 
dSS  
.SS  !
TripDestinationSS! 0
)SS0 1
.SS1 2
WithManySS2 :
(SS: ;
pSS; <
=>SS= ?
pSS@ A
.SSA B
BuddiesSSB I
)SSI J
.TT 
HasForeignKeyTT 
(TT 
dTT  
=>TT! #
dTT$ %
.TT% &
TripDestinationIdTT& 7
)TT7 8
.UU 
HasConstraintNameUU "
(UU" #
$strUU# =
)UU= >
;UU> ?
entityWW 
.WW 
HasOneWW 
(WW 
dWW 
=>WW 
dWW  
.WW  !
UserWW! %
)WW% &
.WW& '
WithManyWW' /
(WW/ 0
)WW0 1
.XX 
HasForeignKeyXX 
(XX 
dXX  
=>XX! #
dXX$ %
.XX% &
UserIdXX& ,
)XX, -
.YY 
HasConstraintNameYY "
(YY" #
$strYY# 2
)YY2 3
;YY3 4
}ZZ 	
)ZZ	 

;ZZ
 
modelBuilder\\ 
.\\ 
Entity\\ 
<\\ 

BuddyAudit\\ &
>\\& '
(\\' (
entity\\( .
=>\\/ 1
{]] 	
entity^^ 
.^^ 
HasKey^^ 
(^^ 
e^^ 
=>^^ 
e^^  
.^^  !
AuditId^^! (
)^^( )
.^^) *
HasName^^* 1
(^^1 2
$str^^2 ;
)^^; <
;^^< =
entity`` 
.`` 
ToTable`` 
(`` 
$str`` (
)``( )
;``) *
entitybb 
.bb 
HasIndexbb 
(bb 
ebb 
=>bb  
ebb! "
.bb" #
BuddyIdbb# *
,bb* +
$strbb, B
)bbB C
;bbC D
entitydd 
.dd 
HasIndexdd 
(dd 
edd 
=>dd  
edd! "
.dd" #
	ChangedBydd# ,
,dd, -
$strdd. C
)ddC D
;ddD E
entityff 
.ff 
Propertyff 
(ff 
eff 
=>ff  
eff! "
.ff" #
AuditIdff# *
)ff* +
.ff+ ,
HasColumnNameff, 9
(ff9 :
$strff: D
)ffD E
;ffE F
entitygg 
.gg 
Propertygg 
(gg 
egg 
=>gg  
egg! "
.gg" #
Actiongg# )
)gg) *
.hh 
HasColumnTypehh 
(hh 
$strhh Y
)hhY Z
.ii 
HasColumnNameii 
(ii 
$strii '
)ii' (
;ii( )
entityjj 
.jj 
Propertyjj 
(jj 
ejj 
=>jj  
ejj! "
.jj" #
BuddyIdjj# *
)jj* +
.jj+ ,
HasColumnNamejj, 9
(jj9 :
$strjj: D
)jjD E
;jjE F
entitykk 
.kk 
Propertykk 
(kk 
ekk 
=>kk  
ekk! "
.kk" #
	ChangedBykk# ,
)kk, -
.kk- .
HasColumnNamekk. ;
(kk; <
$strkk< H
)kkH I
;kkI J
entityll 
.ll 
Propertyll 
(ll 
ell 
=>ll  
ell! "
.ll" #
Reasonll# )
)ll) *
.mm 
HasMaxLengthmm 
(mm 
$nummm !
)mm! "
.nn 
HasColumnNamenn 
(nn 
$strnn '
)nn' (
;nn( )
entityoo 
.oo 
Propertyoo 
(oo 
eoo 
=>oo  
eoo! "
.oo" #
	Timestampoo# ,
)oo, -
.pp 
HasDefaultValueSqlpp #
(pp# $
$strpp$ 7
)pp7 8
.qq 
HasColumnTypeqq 
(qq 
$strqq )
)qq) *
.rr 
HasColumnNamerr 
(rr 
$strrr *
)rr* +
;rr+ ,
entitytt 
.tt 
HasOnett 
(tt 
dtt 
=>tt 
dtt  
.tt  !
Buddytt! &
)tt& '
.tt' (
WithManytt( 0
(tt0 1
ptt1 2
=>tt3 5
ptt6 7
.tt7 8
BuddyAuditstt8 C
)ttC D
.uu 
HasForeignKeyuu 
(uu 
duu  
=>uu! #
duu$ %
.uu% &
BuddyIduu& -
)uu- .
.vv 
HasConstraintNamevv "
(vv" #
$strvv# 9
)vv9 :
;vv: ;
entityxx 
.xx 
HasOnexx 
(xx 
dxx 
=>xx 
dxx  
.xx  !
ChangedByNavigationxx! 4
)xx4 5
.xx5 6
WithManyxx6 >
(xx> ?
)xx? @
.yy 
HasForeignKeyyy 
(yy 
dyy  
=>yy! #
dyy$ %
.yy% &
	ChangedByyy& /
)yy/ 0
.zz 
OnDeletezz 
(zz 
DeleteBehaviorzz (
.zz( )
SetNullzz) 0
)zz0 1
.{{ 
HasConstraintName{{ "
({{" #
$str{{# 8
){{8 9
;{{9 :
}|| 	
)||	 

;||
 
modelBuilder~~ 
.~~ 
Entity~~ 
<~~ 
Destination~~ '
>~~' (
(~~( )
entity~~) /
=>~~0 2
{ 	
entity
ÄÄ 
.
ÄÄ 
HasKey
ÄÄ 
(
ÄÄ 
e
ÄÄ 
=>
ÄÄ 
e
ÄÄ  
.
ÄÄ  !
DestinationId
ÄÄ! .
)
ÄÄ. /
.
ÄÄ/ 0
HasName
ÄÄ0 7
(
ÄÄ7 8
$str
ÄÄ8 A
)
ÄÄA B
;
ÄÄB C
entity
ÇÇ 
.
ÇÇ 
ToTable
ÇÇ 
(
ÇÇ 
$str
ÇÇ (
)
ÇÇ( )
;
ÇÇ) *
entity
ÑÑ 
.
ÑÑ 
HasIndex
ÑÑ 
(
ÑÑ 
e
ÑÑ 
=>
ÑÑ  
new
ÑÑ! $
{
ÑÑ% &
e
ÑÑ' (
.
ÑÑ( )
Country
ÑÑ) 0
,
ÑÑ0 1
e
ÑÑ2 3
.
ÑÑ3 4
State
ÑÑ4 9
}
ÑÑ: ;
,
ÑÑ; <
$str
ÑÑ= T
)
ÑÑT U
;
ÑÑU V
entity
ÜÜ 
.
ÜÜ 
Property
ÜÜ 
(
ÜÜ 
e
ÜÜ 
=>
ÜÜ  
e
ÜÜ! "
.
ÜÜ" #
DestinationId
ÜÜ# 0
)
ÜÜ0 1
.
ÜÜ1 2
HasColumnName
ÜÜ2 ?
(
ÜÜ? @
$str
ÜÜ@ P
)
ÜÜP Q
;
ÜÜQ R
entity
áá 
.
áá 
Property
áá 
(
áá 
e
áá 
=>
áá  
e
áá! "
.
áá" #
Country
áá# *
)
áá* +
.
àà 
HasMaxLength
àà 
(
àà 
$num
àà !
)
àà! "
.
ââ 
HasColumnName
ââ 
(
ââ 
$str
ââ (
)
ââ( )
;
ââ) *
entity
ää 
.
ää 
Property
ää 
(
ää 
e
ää 
=>
ää  
e
ää! "
.
ää" #
Latitude
ää# +
)
ää+ ,
.
ãã 
HasPrecision
ãã 
(
ãã 
$num
ãã  
,
ãã  !
$num
ãã" #
)
ãã# $
.
åå 
HasColumnName
åå 
(
åå 
$str
åå )
)
åå) *
;
åå* +
entity
çç 
.
çç 
Property
çç 
(
çç 
e
çç 
=>
çç  
e
çç! "
.
çç" #
	Longitude
çç# ,
)
çç, -
.
éé 
HasPrecision
éé 
(
éé 
$num
éé  
,
éé  !
$num
éé" #
)
éé# $
.
èè 
HasColumnName
èè 
(
èè 
$str
èè *
)
èè* +
;
èè+ ,
entity
êê 
.
êê 
Property
êê 
(
êê 
e
êê 
=>
êê  
e
êê! "
.
êê" #
Name
êê# '
)
êê' (
.
ëë 
HasMaxLength
ëë 
(
ëë 
$num
ëë !
)
ëë! "
.
íí 
HasColumnName
íí 
(
íí 
$str
íí %
)
íí% &
;
íí& '
entity
ìì 
.
ìì 
Property
ìì 
(
ìì 
e
ìì 
=>
ìì  
e
ìì! "
.
ìì" #
State
ìì# (
)
ìì( )
.
îî 
HasMaxLength
îî 
(
îî 
$num
îî !
)
îî! "
.
ïï 
HasColumnName
ïï 
(
ïï 
$str
ïï &
)
ïï& '
;
ïï' (
}
ññ 	
)
ññ	 

;
ññ
 
modelBuilder
òò 
.
òò 
Entity
òò 
<
òò 
Trip
òò  
>
òò  !
(
òò! "
entity
òò" (
=>
òò) +
{
ôô 	
entity
öö 
.
öö 
HasKey
öö 
(
öö 
e
öö 
=>
öö 
e
öö  
.
öö  !
TripId
öö! '
)
öö' (
.
öö( )
HasName
öö) 0
(
öö0 1
$str
öö1 :
)
öö: ;
;
öö; <
entity
úú 
.
úú 
ToTable
úú 
(
úú 
$str
úú !
)
úú! "
;
úú" #
entity
ûû 
.
ûû 
HasIndex
ûû 
(
ûû 
e
ûû 
=>
ûû  
e
ûû! "
.
ûû" #
OwnerId
ûû# *
,
ûû* +
$str
ûû, ;
)
ûû; <
;
ûû< =
entity
†† 
.
†† 
Property
†† 
(
†† 
e
†† 
=>
††  
e
††! "
.
††" #
TripId
††# )
)
††) *
.
††* +
HasColumnName
††+ 8
(
††8 9
$str
††9 B
)
††B C
;
††C D
entity
°° 
.
°° 
Property
°° 
(
°° 
e
°° 
=>
°°  
e
°°! "
.
°°" #
Description
°°# .
)
°°. /
.
¢¢ 
HasMaxLength
¢¢ 
(
¢¢ 
$num
¢¢ !
)
¢¢! "
.
££ 
HasColumnName
££ 
(
££ 
$str
££ ,
)
££, -
;
££- .
entity
§§ 
.
§§ 
Property
§§ 
(
§§ 
e
§§ 
=>
§§  
e
§§! "
.
§§" #
TripName
§§# +
)
§§+ ,
.
•• 
HasMaxLength
•• 
(
•• 
$num
•• !
)
••! "
.
¶¶ 
HasColumnName
¶¶ 
(
¶¶ 
$str
¶¶ *
)
¶¶* +
;
¶¶+ ,
entity
ßß 
.
ßß 
Property
ßß 
(
ßß 
e
ßß 
=>
ßß  
e
ßß! "
.
ßß" #
EndDate
ßß# *
)
ßß* +
.
ßß+ ,
HasColumnName
ßß, 9
(
ßß9 :
$str
ßß: D
)
ßßD E
;
ßßE F
entity
®® 
.
®® 
Property
®® 
(
®® 
e
®® 
=>
®®  
e
®®! "
.
®®" #

IsArchived
®®# -
)
®®- .
.
©©  
HasDefaultValueSql
©© #
(
©©# $
$str
©©$ )
)
©©) *
.
™™ 
HasColumnName
™™ 
(
™™ 
$str
™™ ,
)
™™, -
;
™™- .
entity
´´ 
.
´´ 
Property
´´ 
(
´´ 
e
´´ 
=>
´´  
e
´´! "
.
´´" #

MaxBuddies
´´# -
)
´´- .
.
´´. /
HasColumnName
´´/ <
(
´´< =
$str
´´= J
)
´´J K
;
´´K L
entity
¨¨ 
.
¨¨ 
Property
¨¨ 
(
¨¨ 
e
¨¨ 
=>
¨¨  
e
¨¨! "
.
¨¨" #
OwnerId
¨¨# *
)
¨¨* +
.
¨¨+ ,
HasColumnName
¨¨, 9
(
¨¨9 :
$str
¨¨: D
)
¨¨D E
;
¨¨E F
entity
≠≠ 
.
≠≠ 
Property
≠≠ 
(
≠≠ 
e
≠≠ 
=>
≠≠  
e
≠≠! "
.
≠≠" #
	StartDate
≠≠# ,
)
≠≠, -
.
≠≠- .
HasColumnName
≠≠. ;
(
≠≠; <
$str
≠≠< H
)
≠≠H I
;
≠≠I J
entity
ØØ 
.
ØØ 
HasOne
ØØ 
(
ØØ 
d
ØØ 
=>
ØØ 
d
ØØ  
.
ØØ  !
Owner
ØØ! &
)
ØØ& '
.
ØØ' (
WithMany
ØØ( 0
(
ØØ0 1
)
ØØ1 2
.
∞∞ 
HasForeignKey
∞∞ 
(
∞∞ 
d
∞∞  
=>
∞∞! #
d
∞∞$ %
.
∞∞% &
OwnerId
∞∞& -
)
∞∞- .
.
±± 
OnDelete
±± 
(
±± 
DeleteBehavior
±± (
.
±±( )
Cascade
±±) 0
)
±±0 1
.
≤≤ 
HasConstraintName
≤≤ "
(
≤≤" #
$str
≤≤# 2
)
≤≤2 3
;
≤≤3 4
}
≥≥ 	
)
≥≥	 

;
≥≥
 
modelBuilder
µµ 
.
µµ 
Entity
µµ 
<
µµ 
	TripAudit
µµ %
>
µµ% &
(
µµ& '
entity
µµ' -
=>
µµ. 0
{
∂∂ 	
entity
∑∑ 
.
∑∑ 
HasKey
∑∑ 
(
∑∑ 
e
∑∑ 
=>
∑∑ 
e
∑∑  
.
∑∑  !
AuditId
∑∑! (
)
∑∑( )
.
∑∑) *
HasName
∑∑* 1
(
∑∑1 2
$str
∑∑2 ;
)
∑∑; <
;
∑∑< =
entity
ππ 
.
ππ 
ToTable
ππ 
(
ππ 
$str
ππ '
)
ππ' (
;
ππ( )
entity
ªª 
.
ªª 
HasIndex
ªª 
(
ªª 
e
ªª 
=>
ªª  
e
ªª! "
.
ªª" #
TripId
ªª# )
,
ªª) *
$str
ªª+ ?
)
ªª? @
;
ªª@ A
entity
ΩΩ 
.
ΩΩ 
HasIndex
ΩΩ 
(
ΩΩ 
e
ΩΩ 
=>
ΩΩ  
e
ΩΩ! "
.
ΩΩ" #
	ChangedBy
ΩΩ# ,
,
ΩΩ, -
$str
ΩΩ. B
)
ΩΩB C
;
ΩΩC D
entity
øø 
.
øø 
Property
øø 
(
øø 
e
øø 
=>
øø  
e
øø! "
.
øø" #
AuditId
øø# *
)
øø* +
.
øø+ ,
HasColumnName
øø, 9
(
øø9 :
$str
øø: D
)
øøD E
;
øøE F
entity
¿¿ 
.
¿¿ 
Property
¿¿ 
(
¿¿ 
e
¿¿ 
=>
¿¿  
e
¿¿! "
.
¿¿" #
Action
¿¿# )
)
¿¿) *
.
¡¡ 
HasColumnType
¡¡ 
(
¡¡ 
$str
¡¡ D
)
¡¡D E
.
¬¬ 
HasColumnName
¬¬ 
(
¬¬ 
$str
¬¬ '
)
¬¬' (
;
¬¬( )
entity
√√ 
.
√√ 
Property
√√ 
(
√√ 
e
√√ 
=>
√√  
e
√√! "
.
√√" #
	ChangedBy
√√# ,
)
√√, -
.
√√- .
HasColumnName
√√. ;
(
√√; <
$str
√√< H
)
√√H I
;
√√I J
entity
ƒƒ 
.
ƒƒ 
Property
ƒƒ 
(
ƒƒ 
e
ƒƒ 
=>
ƒƒ  
e
ƒƒ! "
.
ƒƒ" #
FieldChanged
ƒƒ# /
)
ƒƒ/ 0
.
≈≈ 
HasMaxLength
≈≈ 
(
≈≈ 
$num
≈≈ !
)
≈≈! "
.
∆∆ 
HasColumnName
∆∆ 
(
∆∆ 
$str
∆∆ .
)
∆∆. /
;
∆∆/ 0
entity
«« 
.
«« 
Property
«« 
(
«« 
e
«« 
=>
««  
e
««! "
.
««" #
NewValue
««# +
)
««+ ,
.
»» 
HasMaxLength
»» 
(
»» 
$num
»» !
)
»»! "
.
…… 
HasColumnName
…… 
(
…… 
$str
…… *
)
……* +
;
……+ ,
entity
   
.
   
Property
   
(
   
e
   
=>
    
e
  ! "
.
  " #
OldValue
  # +
)
  + ,
.
ÀÀ 
HasMaxLength
ÀÀ 
(
ÀÀ 
$num
ÀÀ !
)
ÀÀ! "
.
ÃÃ 
HasColumnName
ÃÃ 
(
ÃÃ 
$str
ÃÃ *
)
ÃÃ* +
;
ÃÃ+ ,
entity
ÕÕ 
.
ÕÕ 
Property
ÕÕ 
(
ÕÕ 
e
ÕÕ 
=>
ÕÕ  
e
ÕÕ! "
.
ÕÕ" #
	Timestamp
ÕÕ# ,
)
ÕÕ, -
.
ŒŒ  
HasDefaultValueSql
ŒŒ #
(
ŒŒ# $
$str
ŒŒ$ 7
)
ŒŒ7 8
.
œœ 
HasColumnType
œœ 
(
œœ 
$str
œœ )
)
œœ) *
.
–– 
HasColumnName
–– 
(
–– 
$str
–– *
)
––* +
;
––+ ,
entity
—— 
.
—— 
Property
—— 
(
—— 
e
—— 
=>
——  
e
——! "
.
——" #
TripId
——# )
)
——) *
.
——* +
HasColumnName
——+ 8
(
——8 9
$str
——9 B
)
——B C
;
——C D
entity
”” 
.
”” 
HasOne
”” 
(
”” 
d
”” 
=>
”” 
d
””  
.
””  !!
ChangedByNavigation
””! 4
)
””4 5
.
””5 6
WithMany
””6 >
(
””> ?
)
””? @
.
‘‘ 
HasForeignKey
‘‘ 
(
‘‘ 
d
‘‘  
=>
‘‘! #
d
‘‘$ %
.
‘‘% &
	ChangedBy
‘‘& /
)
‘‘/ 0
.
’’ 
OnDelete
’’ 
(
’’ 
DeleteBehavior
’’ (
.
’’( )
SetNull
’’) 0
)
’’0 1
.
÷÷ 
HasConstraintName
÷÷ "
(
÷÷" #
$str
÷÷# 7
)
÷÷7 8
;
÷÷8 9
entity
ÿÿ 
.
ÿÿ 
HasOne
ÿÿ 
(
ÿÿ 
d
ÿÿ 
=>
ÿÿ 
d
ÿÿ  
.
ÿÿ  !
Trip
ÿÿ! %
)
ÿÿ% &
.
ÿÿ& '
WithMany
ÿÿ' /
(
ÿÿ/ 0
p
ÿÿ0 1
=>
ÿÿ2 4
p
ÿÿ5 6
.
ÿÿ6 7

TripAudits
ÿÿ7 A
)
ÿÿA B
.
ŸŸ 
HasForeignKey
ŸŸ 
(
ŸŸ 
d
ŸŸ  
=>
ŸŸ! #
d
ŸŸ$ %
.
ŸŸ% &
TripId
ŸŸ& ,
)
ŸŸ, -
.
⁄⁄ 
HasConstraintName
⁄⁄ "
(
⁄⁄" #
$str
⁄⁄# 7
)
⁄⁄7 8
;
⁄⁄8 9
}
€€ 	
)
€€	 

;
€€
 
modelBuilder
›› 
.
›› 
Entity
›› 
<
›› 
TripDestination
›› +
>
››+ ,
(
››, -
entity
››- 3
=>
››4 6
{
ﬁﬁ 	
entity
ﬂﬂ 
.
ﬂﬂ 
HasKey
ﬂﬂ 
(
ﬂﬂ 
e
ﬂﬂ 
=>
ﬂﬂ 
e
ﬂﬂ  
.
ﬂﬂ  !
TripDestinationId
ﬂﬂ! 2
)
ﬂﬂ2 3
.
ﬂﬂ3 4
HasName
ﬂﬂ4 ;
(
ﬂﬂ; <
$str
ﬂﬂ< E
)
ﬂﬂE F
;
ﬂﬂF G
entity
·· 
.
·· 
ToTable
·· 
(
·· 
$str
·· -
)
··- .
;
··. /
entity
„„ 
.
„„ 
HasIndex
„„ 
(
„„ 
e
„„ 
=>
„„  
new
„„! $
{
„„% &
e
„„' (
.
„„( )
	StartDate
„„) 2
,
„„2 3
e
„„4 5
.
„„5 6
EndDate
„„6 =
}
„„> ?
,
„„? @
$str
„„A O
)
„„O P
;
„„P Q
entity
ÂÂ 
.
ÂÂ 
HasIndex
ÂÂ 
(
ÂÂ 
e
ÂÂ 
=>
ÂÂ  
e
ÂÂ! "
.
ÂÂ" #
DestinationId
ÂÂ# 0
,
ÂÂ0 1
$str
ÂÂ2 F
)
ÂÂF G
;
ÂÂG H
entity
ÁÁ 
.
ÁÁ 
HasIndex
ÁÁ 
(
ÁÁ 
e
ÁÁ 
=>
ÁÁ  
e
ÁÁ! "
.
ÁÁ" #
TripId
ÁÁ# )
,
ÁÁ) *
$str
ÁÁ+ 8
)
ÁÁ8 9
;
ÁÁ9 :
entity
ÈÈ 
.
ÈÈ 
Property
ÈÈ 
(
ÈÈ 
e
ÈÈ 
=>
ÈÈ  
e
ÈÈ! "
.
ÈÈ" #
TripDestinationId
ÈÈ# 4
)
ÈÈ4 5
.
ÈÈ5 6
HasColumnName
ÈÈ6 C
(
ÈÈC D
$str
ÈÈD Y
)
ÈÈY Z
;
ÈÈZ [
entity
ÍÍ 
.
ÍÍ 
Property
ÍÍ 
(
ÍÍ 
e
ÍÍ 
=>
ÍÍ  
e
ÍÍ! "
.
ÍÍ" #
Description
ÍÍ# .
)
ÍÍ. /
.
ÎÎ 
HasMaxLength
ÎÎ 
(
ÎÎ 
$num
ÎÎ !
)
ÎÎ! "
.
ÏÏ 
HasColumnName
ÏÏ 
(
ÏÏ 
$str
ÏÏ ,
)
ÏÏ, -
;
ÏÏ- .
entity
ÌÌ 
.
ÌÌ 
Property
ÌÌ 
(
ÌÌ 
e
ÌÌ 
=>
ÌÌ  
e
ÌÌ! "
.
ÌÌ" #
DestinationId
ÌÌ# 0
)
ÌÌ0 1
.
ÌÌ1 2
HasColumnName
ÌÌ2 ?
(
ÌÌ? @
$str
ÌÌ@ P
)
ÌÌP Q
;
ÌÌQ R
entity
ÓÓ 
.
ÓÓ 
Property
ÓÓ 
(
ÓÓ 
e
ÓÓ 
=>
ÓÓ  
e
ÓÓ! "
.
ÓÓ" #
EndDate
ÓÓ# *
)
ÓÓ* +
.
ÓÓ+ ,
HasColumnName
ÓÓ, 9
(
ÓÓ9 :
$str
ÓÓ: D
)
ÓÓD E
;
ÓÓE F
entity
ÔÔ 
.
ÔÔ 
Property
ÔÔ 
(
ÔÔ 
e
ÔÔ 
=>
ÔÔ  
e
ÔÔ! "
.
ÔÔ" #

IsArchived
ÔÔ# -
)
ÔÔ- .
.
  
HasDefaultValueSql
 #
(
# $
$str
$ )
)
) *
.
ÒÒ 
HasColumnName
ÒÒ 
(
ÒÒ 
$str
ÒÒ ,
)
ÒÒ, -
;
ÒÒ- .
entity
ÚÚ 
.
ÚÚ 
Property
ÚÚ 
(
ÚÚ 
e
ÚÚ 
=>
ÚÚ  
e
ÚÚ! "
.
ÚÚ" #
SequenceNumber
ÚÚ# 1
)
ÚÚ1 2
.
ÚÚ2 3
HasColumnName
ÚÚ3 @
(
ÚÚ@ A
$str
ÚÚA R
)
ÚÚR S
;
ÚÚS T
entity
ÛÛ 
.
ÛÛ 
Property
ÛÛ 
(
ÛÛ 
e
ÛÛ 
=>
ÛÛ  
e
ÛÛ! "
.
ÛÛ" #
	StartDate
ÛÛ# ,
)
ÛÛ, -
.
ÛÛ- .
HasColumnName
ÛÛ. ;
(
ÛÛ; <
$str
ÛÛ< H
)
ÛÛH I
;
ÛÛI J
entity
ÙÙ 
.
ÙÙ 
Property
ÙÙ 
(
ÙÙ 
e
ÙÙ 
=>
ÙÙ  
e
ÙÙ! "
.
ÙÙ" #
TripId
ÙÙ# )
)
ÙÙ) *
.
ÙÙ* +
HasColumnName
ÙÙ+ 8
(
ÙÙ8 9
$str
ÙÙ9 B
)
ÙÙB C
;
ÙÙC D
entity
ˆˆ 
.
ˆˆ 
HasOne
ˆˆ 
(
ˆˆ 
d
ˆˆ 
=>
ˆˆ 
d
ˆˆ  
.
ˆˆ  !
Destination
ˆˆ! ,
)
ˆˆ, -
.
ˆˆ- .
WithMany
ˆˆ. 6
(
ˆˆ6 7
p
ˆˆ7 8
=>
ˆˆ9 ;
p
ˆˆ< =
.
ˆˆ= >
TripDestinations
ˆˆ> N
)
ˆˆN O
.
˜˜ 
HasForeignKey
˜˜ 
(
˜˜ 
d
˜˜  
=>
˜˜! #
d
˜˜$ %
.
˜˜% &
DestinationId
˜˜& 3
)
˜˜3 4
.
¯¯ 
HasConstraintName
¯¯ "
(
¯¯" #
$str
¯¯# =
)
¯¯= >
;
¯¯> ?
entity
˙˙ 
.
˙˙ 
HasOne
˙˙ 
(
˙˙ 
d
˙˙ 
=>
˙˙ 
d
˙˙  
.
˙˙  !
Trip
˙˙! %
)
˙˙% &
.
˙˙& '
WithMany
˙˙' /
(
˙˙/ 0
p
˙˙0 1
=>
˙˙2 4
p
˙˙5 6
.
˙˙6 7
TripDestinations
˙˙7 G
)
˙˙G H
.
˚˚ 
HasForeignKey
˚˚ 
(
˚˚ 
d
˚˚  
=>
˚˚! #
d
˚˚$ %
.
˚˚% &
TripId
˚˚& ,
)
˚˚, -
.
¸¸ 
HasConstraintName
¸¸ "
(
¸¸" #
$str
¸¸# 6
)
¸¸6 7
;
¸¸7 8
}
˝˝ 	
)
˝˝	 

;
˝˝
 
modelBuilder
ˇˇ 
.
ˇˇ 
Entity
ˇˇ 
<
ˇˇ 
User
ˇˇ  
>
ˇˇ  !
(
ˇˇ! "
entity
ˇˇ" (
=>
ˇˇ) +
{
ÄÄ 	
entity
ÅÅ 
.
ÅÅ 
HasKey
ÅÅ 
(
ÅÅ 
e
ÅÅ 
=>
ÅÅ 
e
ÅÅ  
.
ÅÅ  !
UserId
ÅÅ! '
)
ÅÅ' (
.
ÅÅ( )
HasName
ÅÅ) 0
(
ÅÅ0 1
$str
ÅÅ1 :
)
ÅÅ: ;
;
ÅÅ; <
entity
ÉÉ 
.
ÉÉ 
ToTable
ÉÉ 
(
ÉÉ 
$str
ÉÉ !
)
ÉÉ! "
;
ÉÉ" #
entity
ÖÖ 
.
ÖÖ 
HasIndex
ÖÖ 
(
ÖÖ 
e
ÖÖ 
=>
ÖÖ  
e
ÖÖ! "
.
ÖÖ" #
Email
ÖÖ# (
,
ÖÖ( )
$str
ÖÖ* 1
)
ÖÖ1 2
.
ÖÖ2 3
IsUnique
ÖÖ3 ;
(
ÖÖ; <
)
ÖÖ< =
;
ÖÖ= >
entity
áá 
.
áá 
Property
áá 
(
áá 
e
áá 
=>
áá  
e
áá! "
.
áá" #
UserId
áá# )
)
áá) *
.
áá* +
HasColumnName
áá+ 8
(
áá8 9
$str
áá9 B
)
ááB C
;
ááC D
entity
àà 
.
àà 
Property
àà 
(
àà 
e
àà 
=>
àà  
e
àà! "
.
àà" #
	Birthdate
àà# ,
)
àà, -
.
àà- .
HasColumnName
àà. ;
(
àà; <
$str
àà< G
)
ààG H
;
ààH I
entity
ââ 
.
ââ 
Property
ââ 
(
ââ 
e
ââ 
=>
ââ  
e
ââ! "
.
ââ" #
Email
ââ# (
)
ââ( )
.
ää 
HasMaxLength
ää 
(
ää 
$num
ää !
)
ää! "
.
ãã 
HasColumnName
ãã 
(
ãã 
$str
ãã &
)
ãã& '
;
ãã' (
entity
åå 
.
åå 
Property
åå 
(
åå 
e
åå 
=>
åå  
e
åå! "
.
åå" #
	IsDeleted
åå# ,
)
åå, -
.
çç  
HasDefaultValueSql
çç #
(
çç# $
$str
çç$ )
)
çç) *
.
éé 
HasColumnName
éé 
(
éé 
$str
éé +
)
éé+ ,
;
éé, -
entity
èè 
.
èè 
Property
èè 
(
èè 
e
èè 
=>
èè  
e
èè! "
.
èè" #
Name
èè# '
)
èè' (
.
êê 
HasMaxLength
êê 
(
êê 
$num
êê !
)
êê! "
.
ëë 
HasColumnName
ëë 
(
ëë 
$str
ëë %
)
ëë% &
;
ëë& '
entity
íí 
.
íí 
Property
íí 
(
íí 
e
íí 
=>
íí  
e
íí! "
.
íí" #
PasswordHash
íí# /
)
íí/ 0
.
ìì 
HasMaxLength
ìì 
(
ìì 
$num
ìì !
)
ìì! "
.
îî 
HasColumnName
îî 
(
îî 
$str
îî .
)
îî. /
;
îî/ 0
entity
ïï 
.
ïï 
Property
ïï 
(
ïï 
e
ïï 
=>
ïï  
e
ïï! "
.
ïï" #
Role
ïï# '
)
ïï' (
.
ññ  
HasDefaultValueSql
ññ #
(
ññ# $
$str
ññ$ ,
)
ññ, -
.
óó 
HasColumnType
óó 
(
óó 
$str
óó 5
)
óó5 6
.
òò 
HasColumnName
òò 
(
òò 
$str
òò %
)
òò% &
;
òò& '
}
ôô 	
)
ôô	 

;
ôô
 
modelBuilder
õõ 
.
õõ 
Entity
õõ 
<
õõ 
	UserAudit
õõ %
>
õõ% &
(
õõ& '
)
õõ' (
.
õõ( )
HasNoKey
õõ) 1
(
õõ1 2
)
õõ2 3
.
õõ3 4
Ignore
õõ4 :
(
õõ: ;
e
õõ; <
=>
õõ= ?
e
õõ@ A
.
õõA B!
ChangedByNavigation
õõB U
)
õõU V
;
õõV W
modelBuilder
úú 
.
úú 
Entity
úú 
<
úú 
User
úú  
>
úú  !
(
úú! "
)
úú" #
.
úú# $
Ignore
úú$ *
(
úú* +
t
úú+ ,
=>
úú- /
t
úú0 1
.
úú1 2

UserAudits
úú2 <
)
úú< =
;
úú= >
modelBuilder
ûû 
.
ûû 
Entity
ûû 
<
ûû )
TripDestinationSearchResult
ûû 7
>
ûû7 8
(
ûû8 9
)
ûû9 :
.
ûû: ;
HasNoKey
ûû; C
(
ûûC D
)
ûûD E
;
ûûE F
modelBuilder
†† 
.
†† 
Entity
†† 
<
†† 
BuddyTripSummary
†† ,
>
††, -
(
††- .
)
††. /
.
††/ 0
HasNoKey
††0 8
(
††8 9
)
††9 :
;
††: ;
modelBuilder
¢¢ 
.
¢¢ 
Entity
¢¢ 
<
¢¢ !
PendingBuddyRequest
¢¢ /
>
¢¢/ 0
(
¢¢0 1
)
¢¢1 2
.
¢¢2 3
HasNoKey
¢¢3 ;
(
¢¢; <
)
¢¢< =
;
¢¢= >
modelBuilder
§§ 
.
§§ 
Entity
§§ 
<
§§ !
TripDestinationInfo
§§ /
>
§§/ 0
(
§§0 1
)
§§1 2
.
§§2 3
HasNoKey
§§3 ;
(
§§; <
)
§§< =
;
§§= >
modelBuilder
•• 
.
•• 
Entity
•• 
<
•• 
	BuddyInfo
•• %
>
••% &
(
••& '
)
••' (
.
••( )
HasNoKey
••) 1
(
••1 2
)
••2 3
;
••3 4
modelBuilder
¶¶ 
.
¶¶ 
Entity
¶¶ 
<
¶¶ 
BuddyRequestInfo
¶¶ ,
>
¶¶, -
(
¶¶- .
)
¶¶. /
.
¶¶/ 0
HasNoKey
¶¶0 8
(
¶¶8 9
)
¶¶9 :
;
¶¶: ;
modelBuilder
ßß 
.
ßß 
Entity
ßß 
<
ßß '
SimplifiedTripDestination
ßß 5
>
ßß5 6
(
ßß6 7
)
ßß7 8
.
®® 
HasNoKey
®® 
(
®® 
)
®® 
.
©© 
ToView
©© 
(
©© 
$str
©© *
)
©©* +
;
©©+ ,
modelBuilder
™™ 
.
™™ 
Entity
™™ 
<
™™ 
TripOverview
™™ (
>
™™( )
(
™™) *
)
™™* +
.
™™+ ,
HasNoKey
™™, 4
(
™™4 5
)
™™5 6
;
™™6 7
modelBuilder
´´ 
.
´´ 
Entity
´´ 
<
´´ 
TripHeaderInfo
´´ *
>
´´* +
(
´´+ ,
)
´´, -
.
´´- .
HasNoKey
´´. 6
(
´´6 7
)
´´7 8
;
´´8 9
modelBuilder
≠≠ 
.
≠≠ 
Entity
≠≠ 
<
≠≠ 
	NewTripId
≠≠ %
>
≠≠% &
(
≠≠& '
)
≠≠' (
.
≠≠( )
HasNoKey
≠≠) 1
(
≠≠1 2
)
≠≠2 3
;
≠≠3 4$
OnModelCreatingPartial
ØØ 
(
ØØ 
modelBuilder
ØØ +
)
ØØ+ ,
;
ØØ, -
}
∞∞ 
partial
≤≤ 
void
≤≤ $
OnModelCreatingPartial
≤≤ '
(
≤≤' (
ModelBuilder
≤≤( 4
modelBuilder
≤≤5 A
)
≤≤A B
;
≤≤B C
}≥≥ ß»
ñC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Infrastructure\MySql\MySqlTripRepository.cs
	namespace 	
TravelBuddy
 
. 
Trips 
; 
public		 
class		 
MySqlTripRepository		  
:		! "
ITripRepository		# 2
{

 
private 
readonly 
TripsDbContext #
_context$ ,
;, -
public 

MySqlTripRepository 
( 
TripsDbContext -
context. 5
)5 6
{ 
_context 
= 
context 
; 
} 
public 

async 
Task 
< 
IEnumerable !
<! "'
TripDestinationSearchResult" =
>= >
>> ?
SearchTripsAsync@ P
(P Q
DateOnly 
? 
reqStart 
, 
DateOnly 
? 
reqEnd 
, 
string 
? 
country 
, 
string 
? 
state 
, 
string 
? 
name 
, 
int 
? 
	partySize 
, 
string 
? 
q 
) 
{ 
var 
start 
= 
reqStart 
. 
HasValue %
?& '
reqStart( 0
.0 1
Value1 6
:7 8
(9 :
DateOnly: B
?B C
)C D
nullD H
;H I
var 
end 
= 
reqEnd 
. 
HasValue !
?" #
reqEnd$ *
.* +
Value+ 0
:1 2
(3 4
DateOnly4 <
?< =
)= >
null> B
;B C
var 
countryParam 
= 
country "
??# %
string& ,
., -
Empty- 2
;2 3
var 

stateParam 
= 
state 
?? !
string" (
.( )
Empty) .
;. /
var 
	nameParam 
= 
name 
?? 
string  &
.& '
Empty' ,
;, -
var   
partySizeParam   
=   
	partySize   &
??  ' )
$num  * +
;  + ,
var!! 
qParam!! 
=!! 
q!! 
??!! 
string!!  
.!!  !
Empty!!! &
;!!& '
return## 
await## 
_context## 
.## 
Set## !
<##! "'
TripDestinationSearchResult##" =
>##= >
(##> ?
)##? @
.$$ 
FromSqlInterpolated$$  
($$  !
$@"$$! $
$str$&$ 
{&& 
start&& 
}&& 
$str&' 
{'' 
end'' 
}'' 
$str'( 
{(( 
countryParam(( !
}((! "
$str()" 
{)) 

stateParam)) 
}))  
$str)*  
{** 
	nameParam** 
}** 
$str*+ 
{++ 
partySizeParam++ #
}++# $
$str+,$ 
{,, 
qParam,, 
},, 
$str,- 
"-- 
)-- 
... 
AsNoTracking.. 
(.. 
).. 
.// 
ToListAsync// 
(// 
)// 
;// 
}00 
public11 

async11 
Task11 
<11 
IEnumerable11 !
<11! "
Destination11" -
>11- .
>11. / 
GetDestinationsAsync110 D
(11D E
)11E F
{22 
return33 
await33 
_context33 
.33 
Destinations33 *
.44 
AsNoTracking44 
(44 
)44 
.55 
ToListAsync55 
(55 
)55 
;55 
}66 
public77 

async77 
Task77 
<77 
IEnumerable77 !
<77! "
BuddyTripSummary77" 2
>772 3
>773 4
GetBuddyTripsAsync775 G
(77G H
int77H K
userId77L R
)77R S
{88 
return99 
await99 
_context99 
.99 
BuddyTripSummaries99 0
.:: 
FromSqlInterpolated::  
(::  !
$@"::! $
$str:;$ %
{;;% &
userId;;& ,
};;, -
$str;;- .
";;. /
);;/ 0
.<< 
AsNoTracking<< 
(<< 
)<< 
.== 
ToListAsync== 
(== 
)== 
;== 
}>> 
public@@ 

async@@ 
Task@@ 
<@@ 
TripDestinationInfo@@ )
?@@) *
>@@* +'
GetTripDestinationInfoAsync@@, G
(@@G H
int@@H K
tripDestinationId@@L ]
)@@] ^
{AA 
varDD 
tripDestinationDD 
=DD 
awaitDD #
_contextDD$ ,
.DD, -
TripDestinationInfoDD- @
.EE 
FromSqlInterpolatedEE  
(EE  !
$"EE! #
$strEE# a
{EEa b
tripDestinationIdEEb s
}EEs t
"EEt u
)EEu v
.FF 
AsNoTrackingFF 
(FF 
)FF 
.GG 
FirstOrDefaultAsyncGG  
(GG  !
)GG! "
;GG" #
ifII 

(II 
tripDestinationII 
==II 
nullII #
)II# $
returnII% +
nullII, 0
;II0 1
varMM 
acceptedBuddiesMM 
=MM 
awaitMM #
_contextMM$ ,
.MM, -
	BuddyInfoMM- 6
.NN 
FromSqlInterpolatedNN  
(NN  !
$"NN! #
$strNN# ]
{NN] ^
tripDestinationIdNN^ o
}NNo p
"NNp q
)NNq r
.OO 
AsNoTrackingOO 
(OO 
)OO 
.PP 
ToListAsyncPP 
(PP 
)PP 
;PP 
varTT 
pendingRequestsTT 
=TT 
awaitTT #
_contextTT$ ,
.TT, -
BuddyRequestInfoTT- =
.UU 
FromSqlInterpolatedUU  
(UU  !
$"UU! #
$strUU# ]
{UU] ^
tripDestinationIdUU^ o
}UUo p
"UUp q
)UUq r
.VV 
AsNoTrackingVV 
(VV 
)VV 
.WW 
ToListAsyncWW 
(WW 
)WW 
;WW 
tripDestinationZZ 
.ZZ 
AcceptedBuddiesZZ '
.ZZ' (
AddRangeZZ( 0
(ZZ0 1
acceptedBuddiesZZ1 @
)ZZ@ A
;ZZA B
tripDestination[[ 
.[[ 
PendingRequests[[ '
.[[' (
AddRange[[( 0
([[0 1
pendingRequests[[1 @
)[[@ A
;[[A B
return]] 
tripDestination]] 
;]] 
}^^ 
private__ 
async__ 
Task__ 
<__ 
List__ 
<__ %
SimplifiedTripDestination__ 5
>__5 6
>__6 7.
"GetTripDestinationsWithCountsAsync__8 Z
(__Z [
int__[ ^
tripId___ e
)__e f
{`` 
varaa 
destinationsaa 
=aa 
awaitaa  
_contextaa! )
.aa) *%
SimplifiedTripDestinationaa* C
.bb 
FromSqlInterpolatedbb  
(bb  !
$"bb! #
$strbb# U
{bbU V
tripIdbbV \
}bb\ ]
"bb] ^
)bb^ _
.cc 
AsNoTrackingcc 
(cc 
)cc 
.dd 
ToListAsyncdd 
(dd 
)dd 
;dd 
ifff 

(ff 
!ff 
destinationsff 
.ff 
Anyff 
(ff 
)ff 
)ff  
{gg 	
returnhh 
newhh 
Listhh 
<hh %
SimplifiedTripDestinationhh 5
>hh5 6
(hh6 7
)hh7 8
;hh8 9
}ii 	
varkk 
destinationIdskk 
=kk 
destinationskk )
.kk) *
Selectkk* 0
(kk0 1
dkk1 2
=>kk3 5
dkk6 7
.kk7 8
TripDestinationIdkk8 I
)kkI J
.kkJ K
ToListkkK Q
(kkQ R
)kkR S
;kkS T
varmm 
buddyCountsmm 
=mm 
awaitmm 
_contextmm  (
.mm( )
Buddiesmm) 0
.nn 
Wherenn 
(nn 
bnn 
=>nn 
destinationIdsnn &
.nn& '
Containsnn' /
(nn/ 0
bnn0 1
.nn1 2
TripDestinationIdnn2 C
)nnC D
&&nnE G
boo 
.oo 
RequestStatusoo '
==oo( *
$stroo+ 5
&&oo6 8
bpp 
.pp 
IsActivepp "
==pp# %
truepp& *
)pp* +
.qq 
GroupByqq 
(qq 
bqq 
=>qq 
bqq 
.qq 
TripDestinationIdqq -
)qq- .
.rr 
Selectrr 
(rr 
grr 
=>rr 
newrr 
{ss 
TripDestinationIdtt !
=tt" #
gtt$ %
.tt% &
Keytt& )
,tt) *
AcceptedCountuu 
=uu 
guu  !
.uu! "
Sumuu" %
(uu% &
buu& '
=>uu( *
buu+ ,
.uu, -
PersonCountuu- 8
)uu8 9
}vv 
)vv 
.ww 
ToListAsyncww 
(ww 
)ww 
;ww 
varyy 
countsDictionaryyy 
=yy 
buddyCountsyy *
.yy* +
ToDictionaryyy+ 7
(yy7 8
xyy8 9
=>yy: <
xyy= >
.yy> ?
TripDestinationIdyy? P
,yyP Q
xyyR S
=>yyT V
xyyW X
.yyX Y
AcceptedCountyyY f
)yyf g
;yyg h
foreach{{ 
({{ 
var{{ 
dest{{ 
in{{ 
destinations{{ )
){{) *
{|| 	
if}} 
(}} 
countsDictionary}}  
.}}  !
TryGetValue}}! ,
(}}, -
dest}}- 1
.}}1 2
TripDestinationId}}2 C
,}}C D
out}}E H
var}}I L
count}}M R
)}}R S
)}}S T
{~~ 
dest 
.  
AcceptedBuddiesCount )
=* +
count, 1
??2 4
$num5 6
;6 7
}
ÄÄ 
else
ÅÅ 
{
ÇÇ 
dest
ÉÉ 
.
ÉÉ "
AcceptedBuddiesCount
ÉÉ )
=
ÉÉ* +
$num
ÉÉ, -
;
ÉÉ- .
}
ÑÑ 
}
ÖÖ 	
return
áá 
destinations
áá 
;
áá 
}
àà 
public
ââ 

async
ââ 
Task
ââ 
<
ââ 
TripOverview
ââ "
?
ââ" #
>
ââ# $&
GetFullTripOverviewAsync
ââ% =
(
ââ= >
int
ââ> A
tripId
ââB H
)
ââH I
{
ää 
var
ãã 

tripHeader
ãã 
=
ãã 
await
ãã 
_context
ãã '
.
ãã' (
TripHeaderInfo
ãã( 6
.
åå !
FromSqlInterpolated
åå  
(
åå  !
$"
åå! #
$str
åå# Q
{
ååQ R
tripId
ååR X
}
ååX Y
"
ååY Z
)
ååZ [
.
çç 
AsNoTracking
çç 
(
çç 
)
çç 
.
éé !
FirstOrDefaultAsync
éé  
(
éé  !
)
éé! "
;
éé" #
if
êê 

(
êê 

tripHeader
êê 
==
êê 
null
êê 
)
êê 
return
êê  &
null
êê' +
;
êê+ ,
var
íí $
destinationsWithCounts
íí "
=
íí# $
await
íí% *0
"GetTripDestinationsWithCountsAsync
íí+ M
(
ííM N
tripId
ííN T
)
ííT U
;
ííU V
var
îî 
tripOverview
îî 
=
îî 
new
îî 
TripOverview
îî +
{
ïï 	
TripId
óó 
=
óó 

tripHeader
óó 
.
óó  
TripId
óó  &
,
óó& '
TripName
òò 
=
òò 

tripHeader
òò !
.
òò! "
TripName
òò" *
,
òò* +
TripStartDate
ôô 
=
ôô 

tripHeader
ôô &
.
ôô& '
TripStartDate
ôô' 4
,
ôô4 5
TripEndDate
öö 
=
öö 

tripHeader
öö $
.
öö$ %
TripEndDate
öö% 0
,
öö0 1

MaxBuddies
õõ 
=
õõ 

tripHeader
õõ #
.
õõ# $

MaxBuddies
õõ$ .
,
õõ. /
TripDescription
úú 
=
úú 

tripHeader
úú (
.
úú( )
TripDescription
úú) 8
,
úú8 9
OwnerUserId
ùù 
=
ùù 

tripHeader
ùù $
.
ùù$ %
OwnerUserId
ùù% 0
,
ùù0 1
	OwnerName
ûû 
=
ûû 

tripHeader
ûû "
.
ûû" #
	OwnerName
ûû# ,
,
ûû, -
Destinations
°° 
=
°° $
destinationsWithCounts
°° 1
}
¢¢ 	
;
¢¢	 

return
§§ 
tripOverview
§§ 
;
§§ 
}
•• 
public
¶¶ 

async
¶¶ 
Task
¶¶ 
<
¶¶ 
List
¶¶ 
<
¶¶ 
TripOverview
¶¶ '
>
¶¶' (
>
¶¶( )(
GetOwnedTripOverviewsAsync
¶¶* D
(
¶¶D E
int
¶¶E H
userId
¶¶I O
)
¶¶O P
{
ßß 
var
®® 
tripHeaders
®® 
=
®® 
await
®® 
_context
®®  (
.
®®( )
TripHeaderInfo
®®) 7
.
©© !
FromSqlInterpolated
©©  
(
©©  !
$"
©©! #
$str
©©# V
{
©©V W
userId
©©W ]
}
©©] ^
"
©©^ _
)
©©_ `
.
™™ 
AsNoTracking
™™ 
(
™™ 
)
™™ 
.
´´ 
ToListAsync
´´ 
(
´´ 
)
´´ 
;
´´ 
if
≠≠ 

(
≠≠ 
!
≠≠ 
tripHeaders
≠≠ 
.
≠≠ 
Any
≠≠ 
(
≠≠ 
)
≠≠ 
)
≠≠ 
return
≠≠  &
new
≠≠' *
List
≠≠+ /
<
≠≠/ 0
TripOverview
≠≠0 <
>
≠≠< =
(
≠≠= >
)
≠≠> ?
;
≠≠? @
var
∞∞  
destinationsLookup
∞∞ 
=
∞∞  
await
∞∞! &1
#GetTripsDestinationsWithCountsAsync
∞∞' J
(
∞∞J K
tripHeaders
∞∞K V
.
∞∞V W
Select
∞∞W ]
(
∞∞] ^
t
∞∞^ _
=>
∞∞` b
t
∞∞c d
.
∞∞d e
TripId
∞∞e k
)
∞∞k l
.
∞∞l m
ToList
∞∞m s
(
∞∞s t
)
∞∞t u
)
∞∞u v
;
∞∞v w
var
≤≤ 
tripOverviews
≤≤ 
=
≤≤ 
tripHeaders
≤≤ '
.
≤≤' (
Select
≤≤( .
(
≤≤. /

tripHeader
≤≤/ 9
=>
≤≤: <
new
≤≤= @
TripOverview
≤≤A M
{
≥≥ 	
TripId
¥¥ 
=
¥¥ 

tripHeader
¥¥ 
.
¥¥  
TripId
¥¥  &
,
¥¥& '
TripName
µµ 
=
µµ 

tripHeader
µµ !
.
µµ! "
TripName
µµ" *
,
µµ* +
TripStartDate
∂∂ 
=
∂∂ 

tripHeader
∂∂ &
.
∂∂& '
TripStartDate
∂∂' 4
,
∂∂4 5
TripEndDate
∑∑ 
=
∑∑ 

tripHeader
∑∑ $
.
∑∑$ %
TripEndDate
∑∑% 0
,
∑∑0 1

MaxBuddies
∏∏ 
=
∏∏ 

tripHeader
∏∏ #
.
∏∏# $

MaxBuddies
∏∏$ .
,
∏∏. /
TripDescription
ππ 
=
ππ 

tripHeader
ππ (
.
ππ( )
TripDescription
ππ) 8
,
ππ8 9
OwnerUserId
∫∫ 
=
∫∫ 

tripHeader
∫∫ $
.
∫∫$ %
OwnerUserId
∫∫% 0
,
∫∫0 1
	OwnerName
ªª 
=
ªª 

tripHeader
ªª "
.
ªª" #
	OwnerName
ªª# ,
,
ªª, -
Destinations
ºº 
=
ºº  
destinationsLookup
ºº -
.
ºº- .
TryGetValue
ºº. 9
(
ºº9 :

tripHeader
ºº: D
.
ººD E
TripId
ººE K
,
ººK L
out
ººM P
var
ººQ T
destinations
ººU a
)
ººa b
?
ΩΩ 
destinations
ΩΩ 
:
ææ 
new
ææ 
List
ææ 
<
ææ '
SimplifiedTripDestination
ææ 4
>
ææ4 5
(
ææ5 6
)
ææ6 7
}
øø 	
)
øø	 

.
øø
 
ToList
øø 
(
øø 
)
øø 
;
øø 
return
¡¡ 
tripOverviews
¡¡ 
;
¡¡ 
}
¬¬ 
private
√√ 
async
√√ 
Task
√√ 
<
√√ 

Dictionary
√√ !
<
√√! "
int
√√" %
,
√√% &
List
√√' +
<
√√+ ,'
SimplifiedTripDestination
√√, E
>
√√E F
>
√√F G
>
√√G H1
#GetTripsDestinationsWithCountsAsync
√√I l
(
√√l m
List
√√m q
<
√√q r
int
√√r u
>
√√u v
tripIds
√√w ~
)
√√~ 
{
ƒƒ 
var
∆∆ 
destinations
∆∆ 
=
∆∆ 
await
∆∆  
_context
∆∆! )
.
∆∆) *'
SimplifiedTripDestination
∆∆* C
.
«« 
Where
«« 
(
«« 
d
«« 
=>
«« 
tripIds
«« 
.
««  
Contains
««  (
(
««( )
d
««) *
.
««* +
TripId
««+ 1
)
««1 2
)
««2 3
.
»» 
AsNoTracking
»» 
(
»» 
)
»» 
.
…… 
ToListAsync
…… 
(
…… 
)
…… 
;
…… 
if
ÀÀ 

(
ÀÀ 
!
ÀÀ 
destinations
ÀÀ 
.
ÀÀ 
Any
ÀÀ 
(
ÀÀ 
)
ÀÀ 
)
ÀÀ  
return
ÃÃ 
new
ÃÃ 

Dictionary
ÃÃ !
<
ÃÃ! "
int
ÃÃ" %
,
ÃÃ% &
List
ÃÃ' +
<
ÃÃ+ ,'
SimplifiedTripDestination
ÃÃ, E
>
ÃÃE F
>
ÃÃF G
(
ÃÃG H
)
ÃÃH I
;
ÃÃI J
var
œœ 
destinationIds
œœ 
=
œœ 
destinations
œœ )
.
œœ) *
Select
œœ* 0
(
œœ0 1
d
œœ1 2
=>
œœ3 5
d
œœ6 7
.
œœ7 8
TripDestinationId
œœ8 I
)
œœI J
.
œœJ K
ToList
œœK Q
(
œœQ R
)
œœR S
;
œœS T
var
““ 
buddyCounts
““ 
=
““ 
await
““ 
_context
““  (
.
““( )
Buddies
““) 0
.
”” 
Where
”” 
(
”” 
b
”” 
=>
”” 
destinationIds
”” &
.
””& '
Contains
””' /
(
””/ 0
b
””0 1
.
””1 2
TripDestinationId
””2 C
)
””C D
&&
””E G
b
‘‘ 
.
‘‘ 
RequestStatus
‘‘ '
==
‘‘( *
$str
‘‘+ 5
&&
‘‘6 8
b
’’ 
.
’’ 
IsActive
’’ "
==
’’# %
true
’’& *
)
’’* +
.
÷÷ 
GroupBy
÷÷ 
(
÷÷ 
b
÷÷ 
=>
÷÷ 
b
÷÷ 
.
÷÷ 
TripDestinationId
÷÷ -
)
÷÷- .
.
◊◊ 
Select
◊◊ 
(
◊◊ 
g
◊◊ 
=>
◊◊ 
new
◊◊ 
{
ÿÿ 
TripDestinationId
ŸŸ !
=
ŸŸ" #
g
ŸŸ$ %
.
ŸŸ% &
Key
ŸŸ& )
,
ŸŸ) *
AcceptedCount
⁄⁄ 
=
⁄⁄ 
g
⁄⁄  !
.
⁄⁄! "
Sum
⁄⁄" %
(
⁄⁄% &
b
⁄⁄& '
=>
⁄⁄( *
b
⁄⁄+ ,
.
⁄⁄, -
PersonCount
⁄⁄- 8
)
⁄⁄8 9
}
€€ 
)
€€ 
.
‹‹ 
ToListAsync
‹‹ 
(
‹‹ 
)
‹‹ 
;
‹‹ 
var
ﬁﬁ 
countsDictionary
ﬁﬁ 
=
ﬁﬁ 
buddyCounts
ﬁﬁ *
.
ﬁﬁ* +
ToDictionary
ﬁﬁ+ 7
(
ﬁﬁ7 8
x
ﬁﬁ8 9
=>
ﬁﬁ: <
x
ﬁﬁ= >
.
ﬁﬁ> ?
TripDestinationId
ﬁﬁ? P
,
ﬁﬁP Q
x
ﬁﬁR S
=>
ﬁﬁT V
x
ﬁﬁW X
.
ﬁﬁX Y
AcceptedCount
ﬁﬁY f
)
ﬁﬁf g
;
ﬁﬁg h
foreach
·· 
(
·· 
var
·· 
dest
·· 
in
·· 
destinations
·· )
)
··) *
{
‚‚ 	
dest
„„ 
.
„„ "
AcceptedBuddiesCount
„„ %
=
„„& '
countsDictionary
„„( 8
.
„„8 9
TryGetValue
„„9 D
(
„„D E
dest
„„E I
.
„„I J
TripDestinationId
„„J [
,
„„[ \
out
„„] `
var
„„a d
count
„„e j
)
„„j k
?
‰‰ 
(
‰‰ 
count
‰‰ 
??
‰‰ 
$num
‰‰ 
)
‰‰ 
:
ÂÂ 
$num
ÂÂ 
;
ÂÂ 
}
ÊÊ 	
return
ÈÈ 
destinations
ÈÈ 
.
ÍÍ 
GroupBy
ÍÍ 
(
ÍÍ 
d
ÍÍ 
=>
ÍÍ 
d
ÍÍ 
.
ÍÍ 
TripId
ÍÍ "
)
ÍÍ" #
.
ÎÎ 
ToDictionary
ÎÎ 
(
ÎÎ 
g
ÎÎ 
=>
ÎÎ 
g
ÎÎ  
.
ÎÎ  !
Key
ÎÎ! $
,
ÎÎ$ %
g
ÎÎ& '
=>
ÎÎ( *
g
ÎÎ+ ,
.
ÎÎ, -
ToList
ÎÎ- 3
(
ÎÎ3 4
)
ÎÎ4 5
)
ÎÎ5 6
;
ÎÎ6 7
}
ÏÏ 
public
ÌÌ 

async
ÌÌ 
Task
ÌÌ 
<
ÌÌ 
int
ÌÌ 
?
ÌÌ 
>
ÌÌ 
GetTripOwnerAsync
ÌÌ -
(
ÌÌ- .
int
ÌÌ. 1
tripDestinationId
ÌÌ2 C
)
ÌÌC D
{
ÓÓ 
return
 
await
 
_context
 
.
 
Database
 &
.
ÒÒ 
SqlQuery
ÒÒ 
<
ÒÒ 
int
ÒÒ 
>
ÒÒ 
(
ÒÒ 
$@"
ÒÒ 
$str
Òı /
{
ıı/ 0
tripDestinationId
ıı0 A
}
ııA B
$str
ıˆB 
"
ˆˆ 
)
ˆˆ 
.
˜˜ "
SingleOrDefaultAsync
˜˜ !
(
˜˜! "
)
˜˜" #
;
˜˜# $
}
¯¯ 
public
˙˙ 

async
˙˙ 
Task
˙˙ 
<
˙˙ 
(
˙˙ 
bool
˙˙ 
Success
˙˙ #
,
˙˙# $
string
˙˙% +
?
˙˙+ ,
ErrorMessage
˙˙- 9
)
˙˙9 :
>
˙˙: ;-
CreateTripWithDestinationsAsync
˙˙< [
(
˙˙[ \+
CreateTripWithDestinationsDto
˙˙\ y,
createTripWithDestinationsDto˙˙z ó
)˙˙ó ò
{
˚˚ 
Console
˝˝ 
.
˝˝ 
	WriteLine
˝˝ 
(
˝˝ 
$"
˝˝ 
$str
˝˝ +
{
˝˝+ ,
string
˝˝, 2
.
˝˝2 3
Join
˝˝3 7
(
˝˝7 8
$str
˝˝8 <
,
˝˝< =+
createTripWithDestinationsDto
˝˝> [
.
˝˝[ \
TripDestinations
˝˝\ l
.
˝˝l m
Select
˝˝m s
(
˝˝s t
td
˝˝t v
=>
˝˝w y
$"
˝˝z |
$str
˝˝| }
{
˝˝} ~
td˝˝~ Ä
.˝˝Ä Å
	Longitude˝˝Å ä
}˝˝ä ã
$str˝˝ã ç
{˝˝ç é
td˝˝é ê
.˝˝ê ë
Latitude˝˝ë ô
}˝˝ô ö
$str˝˝ö õ
"˝˝õ ú
)˝˝ú ù
)˝˝ù û
}˝˝û ü
"˝˝ü †
)˝˝† °
;˝˝° ¢
using
˛˛ 
var
˛˛ 
transaction
˛˛ 
=
˛˛ 
await
˛˛  %
_context
˛˛& .
.
˛˛. /
Database
˛˛/ 7
.
˛˛7 8#
BeginTransactionAsync
˛˛8 M
(
˛˛M N
)
˛˛N O
;
˛˛O P
try
ˇˇ 
{
ÄÄ 	
var
ÇÇ 
(
ÇÇ 
tripSuccess
ÇÇ 
,
ÇÇ 
	tripError
ÇÇ '
,
ÇÇ' (
	newTripId
ÇÇ) 2
)
ÇÇ2 3
=
ÇÇ4 5
await
ÇÇ6 ;
CreateTripAsync
ÇÇ< K
(
ÇÇK L+
createTripWithDestinationsDto
ÇÇL i
.
ÇÇi j

CreateTrip
ÇÇj t
)
ÇÇt u
;
ÇÇu v
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 
tripSuccess
ÉÉ 
||
ÉÉ 
	newTripId
ÉÉ  )
==
ÉÉ* ,
null
ÉÉ- 1
)
ÉÉ1 2
{
ÑÑ 
await
ÖÖ 
transaction
ÖÖ !
.
ÖÖ! "
RollbackAsync
ÖÖ" /
(
ÖÖ/ 0
)
ÖÖ0 1
;
ÖÖ1 2
return
ÜÜ 
(
ÜÜ 
false
ÜÜ 
,
ÜÜ 
	tripError
ÜÜ (
)
ÜÜ( )
;
ÜÜ) *
}
áá 
var
ââ $
tripDestinationsWithId
ââ &
=
ââ' (+
createTripWithDestinationsDto
ââ) F
.
ââF G
TripDestinations
ââG W
.
ââW X
Select
ââX ^
(
ââ^ _
td
ââ_ a
=>
ââb d
{
ââe f
td
ää 
.
ää 
TripId
ää 
=
ää 
	newTripId
ää %
.
ää% &
Value
ää& +
;
ää+ ,
return
ãã 
td
ãã 
;
ãã 
}
åå 
)
åå 
.
åå 
ToList
åå 
(
åå 
)
åå 
;
åå 
if
éé 
(
éé 
!
éé $
tripDestinationsWithId
éé '
.
éé' (
Any
éé( +
(
éé+ ,
)
éé, -
)
éé- .
{
èè 
await
êê 
transaction
êê !
.
êê! "
RollbackAsync
êê" /
(
êê/ 0
)
êê0 1
;
êê1 2
return
ëë 
(
ëë 
false
ëë 
,
ëë 
$str
ëë K
)
ëëK L
;
ëëL M
}
íí 
var
îî 
(
îî 
destSuccess
îî 
,
îî 
	destError
îî '
)
îî' (
=
îî) *
await
îî+ 0)
CreateTripDestinationsAsync
îî1 L
(
îîL M$
tripDestinationsWithId
îîM c
)
îîc d
;
îîd e
if
ïï 
(
ïï 
!
ïï 
destSuccess
ïï 
)
ïï 
{
ññ 
await
óó 
transaction
óó !
.
óó! "
RollbackAsync
óó" /
(
óó/ 0
)
óó0 1
;
óó1 2
return
òò 
(
òò 
false
òò 
,
òò 
	destError
òò (
)
òò( )
;
òò) *
}
ôô 
await
õõ 
transaction
õõ 
.
õõ 
CommitAsync
õõ )
(
õõ) *
)
õõ* +
;
õõ+ ,
return
úú 
(
úú 
true
úú 
,
úú 
null
úú 
)
úú 
;
úú  
}
ùù 	
catch
ûû 
(
ûû 
	Exception
ûû 
ex
ûû 
)
ûû 
{
üü 	
await
†† 
transaction
†† 
.
†† 
RollbackAsync
†† +
(
††+ ,
)
††, -
;
††- .
return
°° 
(
°° 
false
°° 
,
°° 
$str
°° $
+
°°% &
ex
°°' )
.
°°) *
Message
°°* 1
)
°°1 2
;
°°2 3
}
¢¢ 	
}
££ 
private
§§ 
async
§§ 
Task
§§ 
<
§§ 
(
§§ 
bool
§§ 
Success
§§ $
,
§§$ %
string
§§& ,
?
§§, -
ErrorMessage
§§. :
,
§§: ;
int
§§< ?
?
§§? @
	NewTripId
§§A J
)
§§J K
>
§§K L
CreateTripAsync
§§M \
(
§§\ ]
CreateTripDto
§§] j
trip
§§k o
)
§§o p
{
•• 
try
¶¶ 
{
ßß 	
var
®® 
result
®® 
=
®® 
await
®® 
_context
®® '
.
®®' (

NewTripIds
®®( 2
.
®®2 3!
FromSqlInterpolated
®®3 F
(
®®F G
$@"
®®G J
$str
®™J 
{
™™ 
trip
™™ 
.
™™ 
OwnerId
™™ !
}
™™! "
$str
™´" 
{
´´ 
trip
´´ 
.
´´ 
TripName
´´ "
}
´´" #
$str
´¨# 
{
¨¨ 
trip
¨¨ 
.
¨¨ 

MaxBuddies
¨¨ $
}
¨¨$ %
$str
¨≠% 
{
≠≠ 
trip
≠≠ 
.
≠≠ 
	StartDate
≠≠ #
}
≠≠# $
$str
≠Æ$ 
{
ÆÆ 
trip
ÆÆ 
.
ÆÆ 
EndDate
ÆÆ !
}
ÆÆ! "
$str
ÆØ" 
{
ØØ 
trip
ØØ 
.
ØØ 
Description
ØØ %
}
ØØ% &
$str
Ø∞& 
{
∞∞ 
trip
∞∞ 
.
∞∞ 
	ChangedBy
∞∞ #
}
∞∞# $
$str
∞±$ 
"
±± 
)
±± 
.
≤≤ 
ToListAsync
≤≤ 
(
≤≤ 
)
≤≤ 
;
≤≤ 
int
¥¥ 
	newTripId
¥¥ 
=
¥¥ 
result
¥¥ "
.
¥¥" #
FirstOrDefault
¥¥# 1
(
¥¥1 2
)
¥¥2 3
?
¥¥3 4
.
¥¥4 5
TripId
¥¥5 ;
??
¥¥< >
$num
¥¥? @
;
¥¥@ A
if
∂∂ 
(
∂∂ 
	newTripId
∂∂ 
>
∂∂ 
$num
∂∂ 
)
∂∂ 
{
∑∑ 
return
∏∏ 
(
∏∏ 
true
∏∏ 
,
∏∏ 
null
∏∏ "
,
∏∏" #
	newTripId
∏∏$ -
)
∏∏- .
;
∏∏. /
}
ππ 
return
ªª 
(
ªª 
false
ªª 
,
ªª 
$str
ªª M
,
ªªM N
null
ªªO S
)
ªªS T
;
ªªT U
}
ºº 	
catch
ΩΩ 
(
ΩΩ 
	Exception
ΩΩ 
ex
ΩΩ 
)
ΩΩ 
{
ææ 	
return
øø 
(
øø 
false
øø 
,
øø 
$str
øø $
+
øø% &
ex
øø' )
.
øø) *
Message
øø* 1
,
øø1 2
null
øø3 7
)
øø7 8
;
øø8 9
}
¿¿ 	
}
¡¡ 
private
√√ 
async
√√ 
Task
√√ 
<
√√ 
(
√√ 
bool
√√ 
Success
√√ $
,
√√$ %
string
√√& ,
?
√√, -
ErrorMessage
√√. :
)
√√: ;
>
√√; <)
CreateTripDestinationsAsync
√√= X
(
√√X Y
IEnumerable
√√Y d
<
√√d e&
CreateTripDestinationDto
√√e }
>
√√} ~
tripDestinations√√ è
)√√è ê
{
ƒƒ 
try
≈≈ 
{
∆∆ 	
foreach
«« 
(
«« 
var
«« 
dest
«« 
in
««  
tripDestinations
««! 1
)
««1 2
{
»» 
await
…… 
_context
…… 
.
…… 
Database
…… '
.
……' ()
ExecuteSqlInterpolatedAsync
……( C
(
……C D
$@"
……D G
$str
…ÀG 
{
ÀÀ 
dest
ÀÀ 
.
ÀÀ 
TripId
ÀÀ $
}
ÀÀ$ %
$str
ÀÃ% 
{
ÃÃ 
dest
ÃÃ 
.
ÃÃ 
DestinationId
ÃÃ +
}
ÃÃ+ ,
$str
ÃÕ, 
{
ÕÕ 
dest
ÕÕ 
.
ÕÕ 
Name
ÕÕ "
}
ÕÕ" #
$str
ÕŒ# 
{
ŒŒ 
dest
ŒŒ 
.
ŒŒ 
State
ŒŒ #
}
ŒŒ# $
$str
Œœ$ 
{
œœ 
dest
œœ 
.
œœ 
Country
œœ %
}
œœ% &
$str
œ–& 
{
–– 
dest
–– 
.
–– 
	Longitude
–– '
}
––' (
$str
–—( 
{
—— 
dest
—— 
.
—— 
Latitude
—— &
}
——& '
$str
—“' 
{
““ 
dest
““ 
.
““ "
DestinationStartDate
““ 2
}
““2 3
$str
“”3 
{
”” 
dest
”” 
.
””  
DestinationEndDate
”” 0
}
””0 1
$str
”‘1 
{
‘‘ 
dest
‘‘ 
.
‘‘ 
SequenceNumber
‘‘ ,
}
‘‘, -
$str
‘’- 
{
’’ 
dest
’’ 
.
’’ 
Description
’’ )
}
’’) *
$str
’÷* 
"
÷÷ 
)
÷÷ 
;
÷÷ 
}
◊◊ 
return
ŸŸ 
(
ŸŸ 
true
ŸŸ 
,
ŸŸ 
null
ŸŸ 
)
ŸŸ 
;
ŸŸ  
}
⁄⁄ 	
catch
€€ 
(
€€ 
	Exception
€€ 
ex
€€ 
)
€€ 
{
‹‹ 	
return
›› 
(
›› 
false
›› 
,
›› 
$str
›› $
+
››% &
ex
››' )
.
››) *
Message
››* 1
)
››1 2
;
››2 3
}
ﬁﬁ 	
}
ﬂﬂ 
public
‰‰ 

async
‰‰ 
Task
‰‰ 
<
‰‰ 
(
‰‰ 
bool
‰‰ 
Success
‰‰ #
,
‰‰# $
string
‰‰% +
?
‰‰+ ,
ErrorMessage
‰‰- 9
)
‰‰9 :
>
‰‰: ;'
LeaveTripDestinationAsync
‰‰< U
(
‰‰U V
int
ÂÂ 
userId
ÂÂ 
,
ÂÂ 
int
ÊÊ 
tripDestinationId
ÊÊ 
,
ÊÊ 
int
ÁÁ 
	changedBy
ÁÁ 
,
ÁÁ 
string
ËË 
departureReason
ËË 
)
ÈÈ 
{
ÍÍ 
try
ÎÎ 
{
ÏÏ 	
await
ÌÌ 
_context
ÌÌ 
.
ÌÌ 
Database
ÌÌ #
.
ÌÌ# $)
ExecuteSqlInterpolatedAsync
ÌÌ$ ?
(
ÌÌ? @
$@"
ÌÌ@ C
$str
ÌÔC 
{
ÔÔ 
userId
ÔÔ 
}
ÔÔ 
$str
Ô 
{
 
tripDestinationId
 &
}
& '
$str
Ò' 
{
ÒÒ 
	changedBy
ÒÒ 
}
ÒÒ 
$str
ÒÚ 
{
ÚÚ 
departureReason
ÚÚ $
}
ÚÚ$ %
$str
ÚÛ% 
"
ÛÛ 
)
ÛÛ 
;
ÛÛ 
return
ıı 
(
ıı 
true
ıı 
,
ıı 
null
ıı 
)
ıı 
;
ıı  
}
ˆˆ 	
catch
˜˜ 
(
˜˜ 
	Exception
˜˜ 
ex
˜˜ 
)
˜˜ 
{
¯¯ 	
return
ÄÄ 
(
ÄÄ 
false
ÄÄ 
,
ÄÄ 
$str
ÄÄ $
+
ÄÄ% &
ex
ÄÄ' )
.
ÄÄ) *
Message
ÄÄ* 1
)
ÄÄ1 2
;
ÄÄ2 3
}
ÅÅ 	
}
ÇÇ 
public
ÑÑ 

async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IEnumerable
ÑÑ !
<
ÑÑ! "!
PendingBuddyRequest
ÑÑ" 5
>
ÑÑ5 6
>
ÑÑ6 7*
GetPendingBuddyRequestsAsync
ÑÑ8 T
(
ÑÑT U
int
ÑÑU X
userId
ÑÑY _
)
ÑÑ_ `
{
ÖÖ 
return
ÜÜ 
await
ÜÜ 
_context
ÜÜ 
.
ÜÜ "
PendingBuddyRequests
ÜÜ 2
.
áá !
FromSqlInterpolated
áá  
(
áá  !
$@"
áá! $
$str
áà$ 0
{
àà0 1
userId
àà1 7
}
àà7 8
$str
àà8 9
"
àà9 :
)
àà: ;
.
ââ 
AsNoTracking
ââ 
(
ââ 
)
ââ 
.
ää 
ToListAsync
ää 
(
ää 
)
ää 
;
ää 
}
ãã 
public
çç 

async
çç 
Task
çç 
<
çç 
(
çç 
bool
çç 
Success
çç #
,
çç# $
string
çç% +
?
çç+ ,
ErrorMessage
çç- 9
)
çç9 :
>
çç: ;%
InsertBuddyRequestAsync
çç< S
(
ççS T
BuddyDto
ççT \
buddyDto
çç] e
)
ççe f
{
éé 
try
èè 
{
êê 	
var
ëë 
	noteParam
ëë 
=
ëë 
new
ëë 
MySqlParameter
ëë  .
{
ëë/ 0
MySqlDbType
íí 
=
íí 
MySqlDbType
íí )
.
íí) *
VarChar
íí* 1
,
íí1 2
Size
ìì 
=
ìì 
$num
ìì 
,
ìì 
Value
îî 
=
îî 
(
îî 
object
îî 
?
îî  
)
îî  !
buddyDto
îî! )
.
îî) *
Note
îî* .
??
îî/ 1
DBNull
îî2 8
.
îî8 9
Value
îî9 >
}
ïï 
;
ïï 
await
óó 
_context
óó 
.
óó 
Database
óó #
.
óó# $ 
ExecuteSqlRawAsync
óó$ 6
(
óó6 7
$str
òò K
,
òòK L
buddyDto
ôô 
.
ôô 
UserId
ôô 
,
ôô  
buddyDto
öö 
.
öö 
TripDestinationId
öö *
,
öö* +
buddyDto
õõ 
.
õõ 
PersonCount
õõ $
,
õõ$ %
	noteParam
úú 
)
ùù 
;
ùù 
return
üü 
(
üü 
true
üü 
,
üü 
null
üü 
)
üü 
;
üü  
}
†† 	
catch
°° 
(
°° 
	Exception
°° 
ex
°° 
)
°° 
{
¢¢ 	
if
§§ 
(
§§ 
ex
§§ 
is
§§ 
MySqlException
§§ $
mysqlEx
§§% ,
)
§§, -
{
•• 
return
¶¶ 
(
¶¶ 
false
¶¶ 
,
¶¶ 
$str
¶¶ (
+
¶¶) *
mysqlEx
¶¶+ 2
.
¶¶2 3
Message
¶¶3 :
)
¶¶: ;
;
¶¶; <
}
ßß 
return
™™ 
(
™™ 
false
™™ 
,
™™ 
$str
™™ $
+
™™% &
ex
™™' )
.
™™) *
Message
™™* 1
)
™™1 2
;
™™2 3
}
´´ 	
}
¨¨ 
public
≠≠ 

async
≠≠ 
Task
≠≠ 
<
≠≠ 
(
≠≠ 
bool
≠≠ 
Success
≠≠ #
,
≠≠# $
string
≠≠% +
?
≠≠+ ,
ErrorMessage
≠≠- 9
)
≠≠9 :
>
≠≠: ;%
UpdateBuddyRequestAsync
≠≠< S
(
≠≠S T#
UpdateBuddyRequestDto
≠≠T i#
updateBuddyRequestDto
≠≠j 
)≠≠ Ä
{
ÆÆ 
try
ØØ 
{
∞∞ 	
await
±± 
_context
±± 
.
±± 
Database
±± #
.
±±# $)
ExecuteSqlInterpolatedAsync
±±$ ?
(
±±? @
$@"
±±@ C
$str
±≥C 
{
≥≥ #
updateBuddyRequestDto
≥≥ *
.
≥≥* +
BuddyId
≥≥+ 2
}
≥≥2 3
$str
≥¥3 
{
¥¥ #
updateBuddyRequestDto
¥¥ *
.
¥¥* +
UserId
¥¥+ 1
}
¥¥1 2
$str
¥µ2 
{
µµ #
updateBuddyRequestDto
µµ *
.
µµ* +
	NewStatus
µµ+ 4
.
µµ4 5
ToString
µµ5 =
(
µµ= >
)
µµ> ?
.
µµ? @
ToLower
µµ@ G
(
µµG H
)
µµH I
}
µµI J
$str
µ∂J 
"
∂∂ 
)
∂∂ 
;
∂∂ 
return
∏∏ 
(
∏∏ 
true
∏∏ 
,
∏∏ 
null
∏∏ 
)
∏∏ 
;
∏∏  
}
ππ 	
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
ex
∫∫ 
)
∫∫ 
{
ªª 	
return
ºº 
(
ºº 
false
ºº 
,
ºº 
$str
ºº %
+
ºº& '
ex
ºº( *
.
ºº* +
Message
ºº+ 2
)
ºº2 3
;
ºº3 4
}
ΩΩ 	
}
ææ 
public
¡¡ 

async
¡¡ 
Task
¡¡ 
<
¡¡ 
IEnumerable
¡¡ !
<
¡¡! "
	TripAudit
¡¡" +
>
¡¡+ ,
>
¡¡, - 
GetTripAuditsAsync
¡¡. @
(
¡¡@ A
)
¡¡A B
{
¬¬ 
return
√√ 
await
√√ 
_context
√√ 
.
√√ 

TripAudits
√√ (
.
ƒƒ 
AsNoTracking
ƒƒ 
(
ƒƒ 
)
ƒƒ 
.
≈≈ 
ToListAsync
≈≈ 
(
≈≈ 
)
≈≈ 
;
≈≈ 
}
∆∆ 
public
«« 

async
«« 
Task
«« 
<
«« 
IEnumerable
«« !
<
««! "

BuddyAudit
««" ,
>
««, -
>
««- .!
GetBuddyAuditsAsync
««/ B
(
««B C
)
««C D
{
»» 
return
…… 
await
…… 
_context
…… 
.
…… 
BuddyAudits
…… )
.
   
AsNoTracking
   
(
   
)
   
.
ÀÀ 
ToListAsync
ÀÀ 
(
ÀÀ 
)
ÀÀ 
;
ÀÀ 
}
ÃÃ 
}ÕÕ ¢¨
öC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\Infrastructure\MongoDb\MongoDbTripRepository.cs
	namespace 	
TravelBuddy
 
. 
Trips 
{ 
[ #
BsonIgnoreExtraElements 
] 
internal 
class 
UserDocument 
{ 
[ 	
BsonElement	 
( 
$str 
) 
] 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
null, 0
!0 1
;1 2
} 
[ #
BsonIgnoreExtraElements 
] 
internal 
class 
BuddyEmbedded  
{ 
public 
int 
BuddyId 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
? 
PersonCount 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
? 
Note 
{ 
get !
;! "
set# &
;& '
}( )
public 
bool 
? 
IsActive 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
? 
DepartureReason &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public   
string   
RequestStatus   #
{  $ %
get  & )
;  ) *
set  + .
;  . /
}  0 1
=  2 3
string  4 :
.  : ;
Empty  ; @
;  @ A
}!! 
[## #
BsonIgnoreExtraElements## 
]## 
internal$$ 
class$$ #
TripDestinationEmbedded$$ *
{%% 
public&& 
int&& 
TripDestinationId&& $
{&&% &
get&&' *
;&&* +
set&&, /
;&&/ 0
}&&1 2
public'' 
int'' 
DestinationId''  
{''! "
get''# &
;''& '
set''( +
;''+ ,
}''- .
public** 
DateTime** 
	StartDate** !
{**" #
get**$ '
;**' (
set**) ,
;**, -
}**. /
public++ 
DateTime++ 
EndDate++ 
{++  !
get++" %
;++% &
set++' *
;++* +
}++, -
public-- 
int-- 
SequenceNumber-- !
{--" #
get--$ '
;--' (
set--) ,
;--, -
}--. /
public.. 
string.. 
?.. 
Description.. "
{..# $
get..% (
;..( )
set..* -
;..- .
}../ 0
public// 
bool// 
?// 

IsArchived// 
{//  !
get//" %
;//% &
set//' *
;//* +
}//, -
public00 
List00 
<00 
BuddyEmbedded00 !
>00! "
Buddies00# *
{00+ ,
get00- 0
;000 1
set002 5
;005 6
}007 8
=009 :
new00; >
(00> ?
)00? @
;00@ A
}11 
[33 #
BsonIgnoreExtraElements33 
]33 
internal44 
class44 
TripDocument44 
{55 
[77 	
BsonId77	 
]77 
public88 
int88 
TripId88 
{88 
get88 
;88  
set88! $
;88$ %
}88& '
public:: 
int:: 
?:: 
OwnerId:: 
{:: 
get:: !
;::! "
set::# &
;::& '
}::( )
public;; 
int;; 
?;; 

MaxBuddies;; 
{;;  
get;;! $
;;;$ %
set;;& )
;;;) *
};;+ ,
public== 
DateOnly== 
	StartDate== !
{==" #
get==$ '
;==' (
set==) ,
;==, -
}==. /
public>> 
DateOnly>> 
EndDate>> 
{>>  !
get>>" %
;>>% &
set>>' *
;>>* +
}>>, -
public@@ 
string@@ 
?@@ 
Description@@ "
{@@# $
get@@% (
;@@( )
set@@* -
;@@- .
}@@/ 0
publicAA 
boolAA 
?AA 

IsArchivedAA 
{AA  !
getAA" %
;AA% &
setAA' *
;AA* +
}AA, -
publicCC 
ListCC 
<CC #
TripDestinationEmbeddedCC +
>CC+ ,
DestinationsCC- 9
{CC: ;
getCC< ?
;CC? @
setCCA D
;CCD E
}CCF G
=CCH I
newCCJ M
(CCM N
)CCN O
;CCO P
}DD 
[FF #
BsonIgnoreExtraElementsFF 
]FF 
internalGG 
classGG 
DestinationDocumentGG &
{HH 
[II 	
BsonIdII	 
]II 
publicJJ 
intJJ 
DestinationIdJJ  
{JJ! "
getJJ# &
;JJ& '
setJJ( +
;JJ+ ,
}JJ- .
publicLL 
stringLL 
NameLL 
{LL 
getLL  
;LL  !
setLL" %
;LL% &
}LL' (
=LL) *
nullLL+ /
!LL/ 0
;LL0 1
publicMM 
stringMM 
?MM 
StateMM 
{MM 
getMM "
;MM" #
setMM$ '
;MM' (
}MM) *
publicNN 
stringNN 
CountryNN 
{NN 
getNN  #
;NN# $
setNN% (
;NN( )
}NN* +
=NN, -
nullNN. 2
!NN2 3
;NN3 4
publicOO 
decimalOO 
?OO 
	LongitudeOO !
{OO" #
getOO$ '
;OO' (
setOO) ,
;OO, -
}OO. /
publicPP 
decimalPP 
?PP 
LatitudePP  
{PP! "
getPP# &
;PP& '
setPP( +
;PP+ ,
}PP- .
}QQ 
publicUU 

classUU !
MongoDbTripRepositoryUU &
:UU' (
ITripRepositoryUU) 8
{VV 
privateWW 
readonlyWW 
IMongoCollectionWW )
<WW) *
TripDocumentWW* 6
>WW6 7
_tripsCollectionWW8 H
;WWH I
privateXX 
readonlyXX 
IMongoCollectionXX )
<XX) *
DestinationDocumentXX* =
>XX= >#
_destinationsCollectionXX? V
;XXV W
privateYY 
readonlyYY 
IMongoCollectionYY )
<YY) *
UserDocumentYY* 6
>YY6 7
_usersCollectionYY8 H
;YYH I
public[[ !
MongoDbTripRepository[[ $
([[$ %
IMongoClient[[% 1
client[[2 8
)[[8 9
{\\ 	
var]] 
database]] 
=]] 
client]] !
.]]! "
GetDatabase]]" -
(]]- .
$str]]. B
)]]B C
;]]C D
_tripsCollection^^ 
=^^ 
database^^ '
.^^' (
GetCollection^^( 5
<^^5 6
TripDocument^^6 B
>^^B C
(^^C D
$str^^D K
)^^K L
;^^L M#
_destinationsCollection__ #
=__$ %
database__& .
.__. /
GetCollection__/ <
<__< =
DestinationDocument__= P
>__P Q
(__Q R
$str__R `
)__` a
;__a b
_usersCollection`` 
=`` 
database`` '
.``' (
GetCollection``( 5
<``5 6
UserDocument``6 B
>``B C
(``C D
$str``D K
)``K L
;``L M
}aa 	
privatedd 
asyncdd 
Taskdd 
<dd 
(dd 
Listdd  
<dd  !
TripDocumentdd! -
>dd- .
Tripsdd/ 4
,dd4 5

Dictionarydd6 @
<dd@ A
intddA D
,ddD E
DestinationDocumentddF Y
>ddY Z
Destinationsdd[ g
)ddg h
>ddh i)
LoadTripsAndDestinationsAsyncee )
(ee) *
)ee* +
{ff 	
vargg 
	tripsTaskgg 
=gg 
_tripsCollectiongg ,
.hh 
Findhh 
(hh 
FilterDefinitionhh &
<hh& '
TripDocumenthh' 3
>hh3 4
.hh4 5
Emptyhh5 :
)hh: ;
.ii 
ToListAsyncii 
(ii 
)ii 
;ii 
varkk 
	destsTaskkk 
=kk #
_destinationsCollectionkk 3
.ll 
Findll 
(ll 
FilterDefinitionll &
<ll& '
DestinationDocumentll' :
>ll: ;
.ll; <
Emptyll< A
)llA B
.mm 
ToListAsyncmm 
(mm 
)mm 
;mm 
awaitoo 
Taskoo 
.oo 
WhenAlloo 
(oo 
	tripsTaskoo (
,oo( )
	destsTaskoo* 3
)oo3 4
;oo4 5
varqq 
tripsqq 
=qq 
	tripsTaskqq !
.qq! "
Resultqq" (
;qq( )
varuu 
destMapuu 
=uu 
	destsTaskuu #
.uu# $
Resultuu$ *
.vv 
GroupByvv 
(vv 
dvv 
=>vv 
dvv 
.vv  
DestinationIdvv  -
)vv- .
.ww 
ToDictionaryww 
(ww 
gww 
=>ww  "
gww# $
.ww$ %
Keyww% (
,ww( )
gww* +
=>ww, .
gww/ 0
.ww0 1
Firstww1 6
(ww6 7
)ww7 8
)ww8 9
;ww9 :
returnyy 
(yy 
tripsyy 
,yy 
destMapyy "
)yy" #
;yy# $
}zz 	
private}} 
async}} 
Task}} 
<}} 
List}} 
<}}  
TripDocument}}  ,
>}}, -
>}}- .
LoadTripsAsync}}/ =
(}}= >
)}}> ?
{~~ 	
return 
await 
_tripsCollection )
.
ÄÄ 
Find
ÄÄ 
(
ÄÄ 
FilterDefinition
ÄÄ &
<
ÄÄ& '
TripDocument
ÄÄ' 3
>
ÄÄ3 4
.
ÄÄ4 5
Empty
ÄÄ5 :
)
ÄÄ: ;
.
ÅÅ 
ToListAsync
ÅÅ 
(
ÅÅ 
)
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
private
ÖÖ 
async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
int
ÖÖ 
>
ÖÖ !
GetNextBuddyIdAsync
ÖÖ  3
(
ÖÖ3 4
)
ÖÖ4 5
{
ÜÜ 	
var
áá 
trips
áá 
=
áá 
await
áá 
LoadTripsAsync
áá ,
(
áá, -
)
áá- .
;
áá. /
var
àà 
max
àà 
=
àà 
trips
àà 
.
ââ 

SelectMany
ââ 
(
ââ 
t
ââ 
=>
ââ  
t
ââ! "
.
ââ" #
Destinations
ââ# /
)
ââ/ 0
.
ää 

SelectMany
ää 
(
ää 
td
ää 
=>
ää !
td
ää" $
.
ää$ %
Buddies
ää% ,
)
ää, -
.
ãã 
DefaultIfEmpty
ãã 
(
ãã  
)
ãã  !
.
åå 
Max
åå 
(
åå 
b
åå 
=>
åå 
b
åå 
?
åå 
.
åå 
BuddyId
åå $
??
åå% '
$num
åå( )
)
åå) *
;
åå* +
return
éé 
max
éé 
+
éé 
$num
éé 
;
éé 
}
èè 	
public
îî 
async
îî 
Task
îî 
<
îî 
IEnumerable
îî %
<
îî% &)
TripDestinationSearchResult
îî& A
>
îîA B
>
îîB C
SearchTripsAsync
îîD T
(
îîT U
DateOnly
ïï 
?
ïï 
reqStart
ïï 
,
ïï 
DateOnly
ññ 
?
ññ 
reqEnd
ññ 
,
ññ 
string
óó 
?
óó 
country
óó 
,
óó 
string
òò 
?
òò 
state
òò 
,
òò 
string
ôô 
?
ôô 
name
ôô 
,
ôô 
int
öö 
?
öö 
	partySize
öö 
,
öö 
string
õõ 
?
õõ 
q
õõ 
)
õõ 
{
úú 	
var
ùù 
(
ùù 
trips
ùù 
,
ùù 
destMap
ùù 
)
ùù  
=
ùù! "
await
ùù# (+
LoadTripsAndDestinationsAsync
ùù) F
(
ùùF G
)
ùùG H
;
ùùH I
var
üü 
results
üü 
=
üü 
new
üü 
List
üü "
<
üü" #)
TripDestinationSearchResult
üü# >
>
üü> ?
(
üü? @
)
üü@ A
;
üüA B
foreach
°° 
(
°° 
var
°° 
trip
°° 
in
°°  
trips
°°! &
)
°°& '
{
¢¢ 
foreach
££ 
(
££ 
var
££ 
td
££ 
in
££  "
trip
££# '
.
££' (
Destinations
££( 4
)
££4 5
{
§§ 
if
•• 
(
•• 
!
•• 
destMap
••  
.
••  !
TryGetValue
••! ,
(
••, -
td
••- /
.
••/ 0
DestinationId
••0 =
,
••= >
out
••? B
var
••C F
destDoc
••G N
)
••N O
)
••O P
continue
¶¶  
;
¶¶  !
var
®® 
	destStart
®® !
=
®®" #
DateOnly
®®$ ,
.
®®, -
FromDateTime
®®- 9
(
®®9 :
td
®®: <
.
®®< =
	StartDate
®®= F
)
®®F G
;
®®G H
var
©© 
destEnd
©© 
=
©©  !
DateOnly
©©" *
.
©©* +
FromDateTime
©©+ 7
(
©©7 8
td
©©8 :
.
©©: ;
EndDate
©©; B
)
©©B C
;
©©C D
if
¨¨ 
(
¨¨ 
reqStart
¨¨  
.
¨¨  !
HasValue
¨¨! )
&&
¨¨* ,
destEnd
¨¨- 4
<
¨¨5 6
reqStart
¨¨7 ?
.
¨¨? @
Value
¨¨@ E
)
¨¨E F
continue
≠≠  
;
≠≠  !
if
ÆÆ 
(
ÆÆ 
reqEnd
ÆÆ 
.
ÆÆ 
HasValue
ÆÆ '
&&
ÆÆ( *
	destStart
ÆÆ+ 4
>
ÆÆ5 6
reqEnd
ÆÆ7 =
.
ÆÆ= >
Value
ÆÆ> C
)
ÆÆC D
continue
ØØ  
;
ØØ  !
if
≤≤ 
(
≤≤ 
!
≤≤ 
string
≤≤ 
.
≤≤   
IsNullOrWhiteSpace
≤≤  2
(
≤≤2 3
country
≤≤3 :
)
≤≤: ;
&&
≤≤< >
!
≥≥ 
string
≥≥ 
.
≥≥  
Equals
≥≥  &
(
≥≥& '
destDoc
≥≥' .
.
≥≥. /
Country
≥≥/ 6
,
≥≥6 7
country
≥≥8 ?
,
≥≥? @
StringComparison
≥≥A Q
.
≥≥Q R
OrdinalIgnoreCase
≥≥R c
)
≥≥c d
)
≥≥d e
continue
¥¥  
;
¥¥  !
if
∂∂ 
(
∂∂ 
!
∂∂ 
string
∂∂ 
.
∂∂   
IsNullOrWhiteSpace
∂∂  2
(
∂∂2 3
state
∂∂3 8
)
∂∂8 9
&&
∂∂: <
!
∑∑ 
string
∑∑ 
.
∑∑  
Equals
∑∑  &
(
∑∑& '
destDoc
∑∑' .
.
∑∑. /
State
∑∑/ 4
??
∑∑5 7
string
∑∑8 >
.
∑∑> ?
Empty
∑∑? D
,
∑∑D E
state
∑∑F K
,
∑∑K L
StringComparison
∑∑M ]
.
∑∑] ^
OrdinalIgnoreCase
∑∑^ o
)
∑∑o p
)
∑∑p q
continue
∏∏  
;
∏∏  !
var
ªª 
	nameLower
ªª !
=
ªª" #
name
ªª$ (
?
ªª( )
.
ªª) *
ToLowerInvariant
ªª* :
(
ªª: ;
)
ªª; <
;
ªª< =
var
ºº 
qLower
ºº 
=
ºº  
q
ºº! "
?
ºº" #
.
ºº# $
ToLowerInvariant
ºº$ 4
(
ºº4 5
)
ºº5 6
;
ºº6 7
if
ææ 
(
ææ 
!
ææ 
string
ææ 
.
ææ   
IsNullOrWhiteSpace
ææ  2
(
ææ2 3
	nameLower
ææ3 <
)
ææ< =
)
ææ= >
{
øø 
if
¿¿ 
(
¿¿ 
!
¿¿ 
destDoc
¿¿ $
.
¿¿$ %
Name
¿¿% )
.
¿¿) *
ToLowerInvariant
¿¿* :
(
¿¿: ;
)
¿¿; <
.
¿¿< =
Contains
¿¿= E
(
¿¿E F
	nameLower
¿¿F O
)
¿¿O P
)
¿¿P Q
continue
¡¡ $
;
¡¡$ %
}
¬¬ 
if
ƒƒ 
(
ƒƒ 
!
ƒƒ 
string
ƒƒ 
.
ƒƒ   
IsNullOrWhiteSpace
ƒƒ  2
(
ƒƒ2 3
qLower
ƒƒ3 9
)
ƒƒ9 :
)
ƒƒ: ;
{
≈≈ 
var
∆∆ 
combined
∆∆ $
=
∆∆% &
$"
∆∆' )
{
∆∆) *
destDoc
∆∆* 1
.
∆∆1 2
Name
∆∆2 6
}
∆∆6 7
$str
∆∆7 8
{
∆∆8 9
destDoc
∆∆9 @
.
∆∆@ A
Country
∆∆A H
}
∆∆H I
$str
∆∆I J
{
∆∆J K
destDoc
∆∆K R
.
∆∆R S
State
∆∆S X
}
∆∆X Y
$str
∆∆Y Z
{
∆∆Z [
trip
∆∆[ _
.
∆∆_ `
Description
∆∆` k
}
∆∆k l
"
∆∆l m
.
∆∆m n
ToLowerInvariant
∆∆n ~
(
∆∆~ 
)∆∆ Ä
;∆∆Ä Å
if
«« 
(
«« 
!
«« 
combined
«« %
.
««% &
Contains
««& .
(
««. /
qLower
««/ 5
)
««5 6
)
««6 7
continue
»» $
;
»»$ %
}
…… 
var
ÃÃ 

maxBuddies
ÃÃ "
=
ÃÃ# $
trip
ÃÃ% )
.
ÃÃ) *

MaxBuddies
ÃÃ* 4
??
ÃÃ5 7
$num
ÃÃ8 9
;
ÃÃ9 :
var
ÕÕ 
acceptedPersons
ÕÕ '
=
ÕÕ( )
td
ÕÕ* ,
.
ÕÕ, -
Buddies
ÕÕ- 4
.
ŒŒ 
Where
ŒŒ 
(
ŒŒ 
b
ŒŒ  
=>
ŒŒ! #
string
ŒŒ$ *
.
ŒŒ* +
Equals
ŒŒ+ 1
(
ŒŒ1 2
b
ŒŒ2 3
.
ŒŒ3 4
RequestStatus
ŒŒ4 A
,
ŒŒA B
$str
ŒŒC M
,
ŒŒM N
StringComparison
ŒŒO _
.
ŒŒ_ `
OrdinalIgnoreCase
ŒŒ` q
)
ŒŒq r
)
ŒŒr s
.
œœ 
Sum
œœ 
(
œœ 
b
œœ 
=>
œœ !
b
œœ" #
.
œœ# $
PersonCount
œœ$ /
??
œœ0 2
$num
œœ3 4
)
œœ4 5
;
œœ5 6
var
—— 
	remaining
—— !
=
——" #

maxBuddies
——$ .
>
——/ 0
$num
——1 2
?
““ 
Math
““ 
.
““ 
Max
““ "
(
““" #
$num
““# $
,
““$ %

maxBuddies
““& 0
-
““1 2
acceptedPersons
““3 B
)
““B C
:
”” 
$num
”” 
;
”” 
if
’’ 
(
’’ 
	partySize
’’ !
.
’’! "
HasValue
’’" *
&&
’’+ -
	remaining
’’. 7
<
’’8 9
	partySize
’’: C
.
’’C D
Value
’’D I
)
’’I J
continue
÷÷  
;
÷÷  !
results
ÿÿ 
.
ÿÿ 
Add
ÿÿ 
(
ÿÿ  
new
ÿÿ  #)
TripDestinationSearchResult
ÿÿ$ ?
{
ŸŸ 
TripDestinationId
⁄⁄ )
=
⁄⁄* +
td
⁄⁄, .
.
⁄⁄. /
TripDestinationId
⁄⁄/ @
,
⁄⁄@ A
TripId
€€ 
=
€€  
trip
€€! %
.
€€% &
TripId
€€& ,
,
€€, -
DestinationId
‹‹ %
=
‹‹& '
td
‹‹( *
.
‹‹* +
DestinationId
‹‹+ 8
,
‹‹8 9
DestinationName
›› '
=
››( )
destDoc
››* 1
.
››1 2
Name
››2 6
,
››6 7
Country
ﬁﬁ 
=
ﬁﬁ  !
destDoc
ﬁﬁ" )
.
ﬁﬁ) *
Country
ﬁﬁ* 1
,
ﬁﬁ1 2
State
ﬂﬂ 
=
ﬂﬂ 
destDoc
ﬂﬂ  '
.
ﬂﬂ' (
State
ﬂﬂ( -
??
ﬂﬂ. 0
string
ﬂﬂ1 7
.
ﬂﬂ7 8
Empty
ﬂﬂ8 =
,
ﬂﬂ= >
DestinationStart
‡‡ (
=
‡‡) *
	destStart
‡‡+ 4
,
‡‡4 5
DestinationEnd
·· &
=
··' (
destEnd
··) 0
,
··0 1

MaxBuddies
‚‚ "
=
‚‚# $

maxBuddies
‚‚% /
,
‚‚/ 0
AcceptedPersons
„„ '
=
„„( )
acceptedPersons
„„* 9
,
„„9 :
RemainingCapacity
‰‰ )
=
‰‰* +
	remaining
‰‰, 5
}
ÂÂ 
)
ÂÂ 
;
ÂÂ 
}
ÊÊ 
}
ÁÁ 
return
ÈÈ 
results
ÈÈ 
;
ÈÈ 
}
ÍÍ 	
public
ÏÏ 
async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
IEnumerable
ÏÏ %
<
ÏÏ% &
Destination
ÏÏ& 1
>
ÏÏ1 2
>
ÏÏ2 3"
GetDestinationsAsync
ÏÏ4 H
(
ÏÏH I
)
ÏÏI J
{
ÌÌ 	
var
ÓÓ 
docs
ÓÓ 
=
ÓÓ 
await
ÓÓ %
_destinationsCollection
ÓÓ 4
.
ÔÔ 
Find
ÔÔ 
(
ÔÔ 
FilterDefinition
ÔÔ &
<
ÔÔ& '!
DestinationDocument
ÔÔ' :
>
ÔÔ: ;
.
ÔÔ; <
Empty
ÔÔ< A
)
ÔÔA B
.
 
ToListAsync
 
(
 
)
 
;
 
var
ÛÛ 
distinctDocs
ÛÛ 
=
ÛÛ 
docs
ÛÛ #
.
ÙÙ 
GroupBy
ÙÙ 
(
ÙÙ 
d
ÙÙ 
=>
ÙÙ 
d
ÙÙ 
.
ÙÙ  
DestinationId
ÙÙ  -
)
ÙÙ- .
.
ıı 
Select
ıı 
(
ıı 
g
ıı 
=>
ıı 
g
ıı 
.
ıı 
First
ıı $
(
ıı$ %
)
ıı% &
)
ıı& '
.
ˆˆ 
ToList
ˆˆ 
(
ˆˆ 
)
ˆˆ 
;
ˆˆ 
var
¯¯ 
destinations
¯¯ 
=
¯¯ 
distinctDocs
¯¯ +
.
¯¯+ ,
Select
¯¯, 2
(
¯¯2 3
d
¯¯3 4
=>
¯¯5 7
new
¯¯8 ;
Destination
¯¯< G
{
˘˘ 
DestinationId
˙˙ 
=
˙˙ 
d
˙˙  !
.
˙˙! "
DestinationId
˙˙" /
,
˙˙/ 0
Name
˚˚ 
=
˚˚ 
d
˚˚  !
.
˚˚! "
Name
˚˚" &
,
˚˚& '
State
¸¸ 
=
¸¸ 
d
¸¸  !
.
¸¸! "
State
¸¸" '
,
¸¸' (
Country
˝˝ 
=
˝˝ 
d
˝˝  !
.
˝˝! "
Country
˝˝" )
,
˝˝) *
	Longitude
˛˛ 
=
˛˛ 
d
˛˛  !
.
˛˛! "
	Longitude
˛˛" +
,
˛˛+ ,
Latitude
ˇˇ 
=
ˇˇ 
d
ˇˇ  !
.
ˇˇ! "
Latitude
ˇˇ" *
}
ÄÄ 
)
ÄÄ 
;
ÄÄ 
return
ÇÇ 
destinations
ÇÇ 
;
ÇÇ  
}
ÉÉ 	
public
ââ 
async
ââ 
Task
ââ 
<
ââ 
IEnumerable
ââ %
<
ââ% &
BuddyTripSummary
ââ& 6
>
ââ6 7
>
ââ7 8 
GetBuddyTripsAsync
ââ9 K
(
ââK L
int
ââL O
userId
ââP V
)
ââV W
{
ää 	
var
ãã 
(
ãã 
trips
ãã 
,
ãã 
destMap
ãã 
)
ãã  
=
ãã! "
await
ãã# (+
LoadTripsAndDestinationsAsync
ãã) F
(
ããF G
)
ããG H
;
ããH I
var
åå 
	summaries
åå 
=
åå 
new
åå 
List
åå  $
<
åå$ %
BuddyTripSummary
åå% 5
>
åå5 6
(
åå6 7
)
åå7 8
;
åå8 9
foreach
éé 
(
éé 
var
éé 
trip
éé 
in
éé  
trips
éé! &
)
éé& '
{
èè 
foreach
êê 
(
êê 
var
êê 
td
êê 
in
êê  "
trip
êê# '
.
êê' (
Destinations
êê( 4
)
êê4 5
{
ëë 
if
íí 
(
íí 
!
íí 
destMap
íí  
.
íí  !
TryGetValue
íí! ,
(
íí, -
td
íí- /
.
íí/ 0
DestinationId
íí0 =
,
íí= >
out
íí? B
var
ííC F
destDoc
ííG N
)
ííN O
)
ííO P
continue
ìì  
;
ìì  !
if
ïï 
(
ïï 
!
ïï 
td
ïï 
.
ïï 
Buddies
ïï #
.
ïï# $
Any
ïï$ '
(
ïï' (
b
ïï( )
=>
ïï* ,
b
ññ 
.
ññ 
UserId
ññ $
==
ññ% '
userId
ññ( .
&&
ññ/ 1
string
óó "
.
óó" #
Equals
óó# )
(
óó) *
b
óó* +
.
óó+ ,
RequestStatus
óó, 9
,
óó9 :
$str
óó; E
,
óóE F
StringComparison
óóG W
.
óóW X
OrdinalIgnoreCase
óóX i
)
óói j
)
òò 
)
òò 
continue
ôô  
;
ôô  !
	summaries
õõ 
.
õõ 
Add
õõ !
(
õõ! "
new
õõ" %
BuddyTripSummary
õõ& 6
{
úú 
TripId
ùù 
=
ùù  
trip
ùù! %
.
ùù% &
TripId
ùù& ,
,
ùù, -
TripDestinationId
ûû )
=
ûû* +
td
ûû, .
.
ûû. /
TripDestinationId
ûû/ @
,
ûû@ A
DestinationName
üü '
=
üü( )
destDoc
üü* 1
.
üü1 2
Name
üü2 6
,
üü6 7
TripDescription
†† '
=
††( )
trip
††* .
.
††. /
Description
††/ :
??
††; =
string
††> D
.
††D E
Empty
††E J
}
°° 
)
°° 
;
°° 
}
¢¢ 
}
££ 
return
•• 
	summaries
•• 
;
•• 
}
¶¶ 	
public
´´ 
async
´´ 
Task
´´ 
<
´´ !
TripDestinationInfo
´´ -
?
´´- .
>
´´. /)
GetTripDestinationInfoAsync
´´0 K
(
´´K L
int
´´L O
tripDestinationId
´´P a
)
´´a b
{
¨¨ 	
var
ÆÆ 
filter
ÆÆ 
=
ÆÆ 
Builders
ÆÆ !
<
ÆÆ! "
TripDocument
ÆÆ" .
>
ÆÆ. /
.
ÆÆ/ 0
Filter
ÆÆ0 6
.
ØØ 
	ElemMatch
ØØ 
(
ØØ 
t
ØØ 
=>
ØØ 
t
ØØ  !
.
ØØ! "
Destinations
ØØ" .
,
ØØ. /
td
ØØ0 2
=>
ØØ3 5
td
ØØ6 8
.
ØØ8 9
TripDestinationId
ØØ9 J
==
ØØK M
tripDestinationId
ØØN _
)
ØØ_ `
;
ØØ` a
var
±± 
trip
±± 
=
±± 
await
±± 
_tripsCollection
±± -
.
±±- .
Find
±±. 2
(
±±2 3
filter
±±3 9
)
±±9 :
.
±±: ;!
FirstOrDefaultAsync
±±; N
(
±±N O
)
±±O P
;
±±P Q
if
≤≤ 
(
≤≤ 
trip
≤≤ 
==
≤≤ 
null
≤≤ 
)
≤≤ 
return
≥≥ 
null
≥≥ 
;
≥≥ 
var
µµ 
td
µµ 
=
µµ 
trip
µµ 
.
µµ 
Destinations
µµ &
.
µµ& '
FirstOrDefault
µµ' 5
(
µµ5 6
d
µµ6 7
=>
µµ8 :
d
µµ; <
.
µµ< =
TripDestinationId
µµ= N
==
µµO Q
tripDestinationId
µµR c
)
µµc d
;
µµd e
if
∂∂ 
(
∂∂ 
td
∂∂ 
==
∂∂ 
null
∂∂ 
)
∂∂ 
return
∑∑ 
null
∑∑ 
;
∑∑ 
var
∫∫ 
destDoc
∫∫ 
=
∫∫ 
await
∫∫ %
_destinationsCollection
∫∫  7
.
ªª 
Find
ªª 
(
ªª 
d
ªª 
=>
ªª 
d
ªª 
.
ªª 
DestinationId
ªª *
==
ªª+ -
td
ªª. 0
.
ªª0 1
DestinationId
ªª1 >
)
ªª> ?
.
ºº !
FirstOrDefaultAsync
ºº $
(
ºº$ %
)
ºº% &
;
ºº& '
if
ææ 
(
ææ 
destDoc
ææ 
==
ææ 
null
ææ 
)
ææ  
return
øø 
null
øø 
;
øø 
var
¬¬ 
buddyUserIds
¬¬ 
=
¬¬ 
td
¬¬ !
.
¬¬! "
Buddies
¬¬" )
.
√√ 
Select
√√ 
(
√√ 
b
√√ 
=>
√√ 
b
√√ 
.
√√ 
UserId
√√ %
)
√√% &
.
ƒƒ 
Distinct
ƒƒ 
(
ƒƒ 
)
ƒƒ 
.
≈≈ 
ToList
≈≈ 
(
≈≈ 
)
≈≈ 
;
≈≈ 
var
«« 
buddyUserDocs
«« 
=
«« 
await
««  %
_usersCollection
««& 6
.
»» 
Find
»» 
(
»» 
u
»» 
=>
»» 
buddyUserIds
»» '
.
»»' (
Contains
»»( 0
(
»»0 1
u
»»1 2
.
»»2 3
UserId
»»3 9
)
»»9 :
)
»»: ;
.
…… 
ToListAsync
…… 
(
…… 
)
…… 
;
…… 
var
ÀÀ 
userMap
ÀÀ 
=
ÀÀ 
buddyUserDocs
ÀÀ '
.
ÀÀ' (
ToDictionary
ÀÀ( 4
(
ÀÀ4 5
u
ÀÀ5 6
=>
ÀÀ7 9
u
ÀÀ: ;
.
ÀÀ; <
UserId
ÀÀ< B
,
ÀÀB C
u
ÀÀD E
=>
ÀÀF H
u
ÀÀI J
)
ÀÀJ K
;
ÀÀK L
UserDocument
ŒŒ 
?
ŒŒ 
ownerDoc
ŒŒ "
=
ŒŒ# $
null
ŒŒ% )
;
ŒŒ) *
if
œœ 
(
œœ 
trip
œœ 
.
œœ 
OwnerId
œœ 
.
œœ 
HasValue
œœ %
)
œœ% &
{
–– 
ownerDoc
—— 
=
—— 
await
——  
_usersCollection
——! 1
.
““ 
Find
““ 
(
““ 
u
““ 
=>
““ 
u
““  
.
““  !
UserId
““! '
==
““( *
trip
““+ /
.
““/ 0
OwnerId
““0 7
.
““7 8
Value
““8 =
)
““= >
.
”” !
FirstOrDefaultAsync
”” (
(
””( )
)
””) *
;
””* +
}
‘‘ 
var
÷÷ 
info
÷÷ 
=
÷÷ 
new
÷÷ !
TripDestinationInfo
÷÷ .
{
◊◊ 
TripDestinationId
ÿÿ !
=
ÿÿ% &
td
ÿÿ' )
.
ÿÿ) *
TripDestinationId
ÿÿ* ;
,
ÿÿ; <"
DestinationStartDate
ŸŸ $
=
ŸŸ% &
DateOnly
ŸŸ' /
.
ŸŸ/ 0
FromDateTime
ŸŸ0 <
(
ŸŸ< =
td
ŸŸ= ?
.
ŸŸ? @
	StartDate
ŸŸ@ I
)
ŸŸI J
,
ŸŸJ K 
DestinationEndDate
⁄⁄ "
=
⁄⁄% &
DateOnly
⁄⁄' /
.
⁄⁄/ 0
FromDateTime
⁄⁄0 <
(
⁄⁄< =
td
⁄⁄= ?
.
⁄⁄? @
EndDate
⁄⁄@ G
)
⁄⁄G H
,
⁄⁄H I$
DestinationDescription
€€ &
=
€€' (
td
€€) +
.
€€+ ,
Description
€€, 7
,
€€7 8#
DestinationIsArchived
‹‹ %
=
‹‹' (
td
‹‹) +
.
‹‹+ ,

IsArchived
‹‹, 6
,
‹‹6 7
TripId
ﬁﬁ 
=
ﬁﬁ 
trip
ﬁﬁ "
.
ﬁﬁ" #
TripId
ﬁﬁ# )
,
ﬁﬁ) *

MaxBuddies
ﬂﬂ 
=
ﬂﬂ 
trip
ﬂﬂ "
.
ﬂﬂ" #

MaxBuddies
ﬂﬂ# -
,
ﬂﬂ- .
DestinationId
·· 
=
··# $
destDoc
··% ,
.
··, -
DestinationId
··- :
,
··: ;
DestinationName
‚‚ 
=
‚‚# $
destDoc
‚‚% ,
.
‚‚, -
Name
‚‚- 1
,
‚‚1 2
DestinationState
„„  
=
„„# $
destDoc
„„% ,
.
„„, -
State
„„- 2
,
„„2 3 
DestinationCountry
‰‰ "
=
‰‰# $
destDoc
‰‰% ,
.
‰‰, -
Country
‰‰- 4
,
‰‰4 5
	Longitude
ÂÂ 
=
ÂÂ# $
destDoc
ÂÂ% ,
.
ÂÂ, -
	Longitude
ÂÂ- 6
,
ÂÂ6 7
Latitude
ÊÊ 
=
ÊÊ# $
destDoc
ÊÊ% ,
.
ÊÊ, -
Latitude
ÊÊ- 5
,
ÊÊ5 6
OwnerUserId
ËË 
=
ËË 
trip
ËË "
.
ËË" #
OwnerId
ËË# *
??
ËË+ -
$num
ËË. /
,
ËË/ 0
	OwnerName
ÈÈ 
=
ÈÈ 
ownerDoc
ÈÈ &
?
ÈÈ& '
.
ÈÈ' (
Name
ÈÈ( ,
??
ÈÈ- /
string
ÈÈ0 6
.
ÈÈ6 7
Empty
ÈÈ7 <
,
ÈÈ< =!
GroupConversationId
ÏÏ #
=
ÏÏ$ %
null
ÏÏ& *
}
ÌÌ 
;
ÌÌ 
foreach
ÔÔ 
(
ÔÔ 
var
ÔÔ 
b
ÔÔ 
in
ÔÔ 
td
ÔÔ  
.
ÔÔ  !
Buddies
ÔÔ! (
)
ÔÔ( )
{
 
userMap
ÒÒ 
.
ÒÒ 
TryGetValue
ÒÒ #
(
ÒÒ# $
b
ÒÒ$ %
.
ÒÒ% &
UserId
ÒÒ& ,
,
ÒÒ, -
out
ÒÒ. 1
var
ÒÒ2 5
uDoc
ÒÒ6 :
)
ÒÒ: ;
;
ÒÒ; <
if
ÛÛ 
(
ÛÛ 
string
ÛÛ 
.
ÛÛ 
Equals
ÛÛ !
(
ÛÛ! "
b
ÛÛ" #
.
ÛÛ# $
RequestStatus
ÛÛ$ 1
,
ÛÛ1 2
$str
ÛÛ3 =
,
ÛÛ= >
StringComparison
ÛÛ? O
.
ÛÛO P
OrdinalIgnoreCase
ÛÛP a
)
ÛÛa b
)
ÛÛb c
{
ÙÙ 
info
ıı 
.
ıı 
AcceptedBuddies
ıı (
.
ıı( )
Add
ıı) ,
(
ıı, -
new
ıı- 0
	BuddyInfo
ıı1 :
{
ˆˆ 
BuddyId
˜˜ 
=
˜˜% &
b
˜˜' (
.
˜˜( )
BuddyId
˜˜) 0
,
˜˜0 1
PersonCount
¯¯ #
=
¯¯% &
b
¯¯' (
.
¯¯( )
PersonCount
¯¯) 4
??
¯¯5 7
$num
¯¯8 9
,
¯¯9 :
	BuddyNote
˘˘ !
=
˘˘% &
b
˘˘' (
.
˘˘( )
Note
˘˘) -
,
˘˘- .
BuddyUserId
˙˙ #
=
˙˙% &
b
˙˙' (
.
˙˙( )
UserId
˙˙) /
,
˙˙/ 0
	BuddyName
˚˚ !
=
˚˚% &
uDoc
˚˚' +
?
˚˚+ ,
.
˚˚, -
Name
˚˚- 1
??
˚˚2 4
string
˚˚5 ;
.
˚˚; <
Empty
˚˚< A
}
¸¸ 
)
¸¸ 
;
¸¸ 
}
˝˝ 
else
˛˛ 
if
˛˛ 
(
˛˛ 
string
˛˛ 
.
˛˛  
Equals
˛˛  &
(
˛˛& '
b
˛˛' (
.
˛˛( )
RequestStatus
˛˛) 6
,
˛˛6 7
$str
˛˛8 A
,
˛˛A B
StringComparison
˛˛C S
.
˛˛S T
OrdinalIgnoreCase
˛˛T e
)
˛˛e f
)
˛˛f g
{
ˇˇ 
info
ÄÄ 
.
ÄÄ 
PendingRequests
ÄÄ (
.
ÄÄ( )
Add
ÄÄ) ,
(
ÄÄ, -
new
ÄÄ- 0
BuddyRequestInfo
ÄÄ1 A
{
ÅÅ 
BuddyId
ÇÇ 
=
ÇÇ( )
b
ÇÇ* +
.
ÇÇ+ ,
BuddyId
ÇÇ, 3
,
ÇÇ3 4
PersonCount
ÉÉ #
=
ÉÉ( )
b
ÉÉ* +
.
ÉÉ+ ,
PersonCount
ÉÉ, 7
??
ÉÉ8 :
$num
ÉÉ; <
,
ÉÉ< =
	BuddyNote
ÑÑ !
=
ÑÑ( )
b
ÑÑ* +
.
ÑÑ+ ,
Note
ÑÑ, 0
,
ÑÑ0 1
RequesterUserId
ÖÖ '
=
ÖÖ( )
b
ÖÖ* +
.
ÖÖ+ ,
UserId
ÖÖ, 2
,
ÖÖ2 3
RequesterName
ÜÜ %
=
ÜÜ( )
uDoc
ÜÜ* .
?
ÜÜ. /
.
ÜÜ/ 0
Name
ÜÜ0 4
??
ÜÜ5 7
string
ÜÜ8 >
.
ÜÜ> ?
Empty
ÜÜ? D
}
áá 
)
áá 
;
áá 
}
àà 
}
ää 
return
åå 
info
åå 
;
åå 
}
çç 	
public
îî 
async
îî 
Task
îî 
<
îî 
TripOverview
îî &
?
îî& '
>
îî' (&
GetFullTripOverviewAsync
îî) A
(
îîA B
int
îîB E
tripId
îîF L
)
îîL M
{
ïï 	
var
ññ 
trip
ññ 
=
ññ 
await
ññ 
_tripsCollection
ññ -
.
óó 
Find
óó 
(
óó 
t
óó 
=>
óó 
t
óó 
.
óó 
TripId
óó #
==
óó$ &
tripId
óó' -
)
óó- .
.
òò !
FirstOrDefaultAsync
òò $
(
òò$ %
)
òò% &
;
òò& '
if
öö 
(
öö 
trip
öö 
==
öö 
null
öö 
)
öö 
return
õõ 
null
õõ 
;
õõ 
UserDocument
ûû 
?
ûû 
ownerDoc
ûû "
=
ûû# $
null
ûû% )
;
ûû) *
if
üü 
(
üü 
trip
üü 
.
üü 
OwnerId
üü 
.
üü 
HasValue
üü %
)
üü% &
{
†† 
ownerDoc
°° 
=
°° 
await
°°  
_usersCollection
°°! 1
.
¢¢ 
Find
¢¢ 
(
¢¢ 
u
¢¢ 
=>
¢¢ 
u
¢¢  
.
¢¢  !
UserId
¢¢! '
==
¢¢( *
trip
¢¢+ /
.
¢¢/ 0
OwnerId
¢¢0 7
.
¢¢7 8
Value
¢¢8 =
)
¢¢= >
.
££ !
FirstOrDefaultAsync
££ (
(
££( )
)
££) *
;
££* +
}
§§ 
var
ßß 
destIds
ßß 
=
ßß 
trip
ßß 
.
ßß 
Destinations
ßß +
.
®® 
Select
®® 
(
®® 
td
®® 
=>
®® 
td
®®  
.
®®  !
DestinationId
®®! .
)
®®. /
.
©© 
Distinct
©© 
(
©© 
)
©© 
.
™™ 
ToList
™™ 
(
™™ 
)
™™ 
;
™™ 
var
¨¨ 
destDocs
¨¨ 
=
¨¨ 
await
¨¨  %
_destinationsCollection
¨¨! 8
.
≠≠ 
Find
≠≠ 
(
≠≠ 
d
≠≠ 
=>
≠≠ 
destIds
≠≠ "
.
≠≠" #
Contains
≠≠# +
(
≠≠+ ,
d
≠≠, -
.
≠≠- .
DestinationId
≠≠. ;
)
≠≠; <
)
≠≠< =
.
ÆÆ 
ToListAsync
ÆÆ 
(
ÆÆ 
)
ÆÆ 
;
ÆÆ 
var
∞∞ 
destMap
∞∞ 
=
∞∞ 
destDocs
∞∞ "
.
∞∞" #
ToDictionary
∞∞# /
(
∞∞/ 0
d
∞∞0 1
=>
∞∞2 4
d
∞∞5 6
.
∞∞6 7
DestinationId
∞∞7 D
,
∞∞D E
d
∞∞F G
=>
∞∞H J
d
∞∞K L
)
∞∞L M
;
∞∞M N
var
≤≤ 
overview
≤≤ 
=
≤≤ 
new
≤≤ 
TripOverview
≤≤ +
{
≥≥ 
TripId
¥¥ 
=
¥¥  !
trip
¥¥" &
.
¥¥& '
TripId
¥¥' -
,
¥¥- .
TripName
µµ 
=
µµ  !
trip
µµ" &
.
µµ& '
Description
µµ' 2
??
µµ3 5
$"
µµ6 8
$str
µµ8 =
{
µµ= >
trip
µµ> B
.
µµB C
TripId
µµC I
}
µµI J
"
µµJ K
,
µµK L
TripStartDate
∂∂ 
=
∂∂  !
trip
∂∂" &
.
∂∂& '
	StartDate
∂∂' 0
,
∂∂0 1
TripEndDate
∑∑ 
=
∑∑  !
trip
∑∑" &
.
∑∑& '
EndDate
∑∑' .
,
∑∑. /

MaxBuddies
∏∏ 
=
∏∏  !
trip
∏∏" &
.
∏∏& '

MaxBuddies
∏∏' 1
??
∏∏2 4
$num
∏∏5 6
,
∏∏6 7
TripDescription
ππ 
=
ππ  !
trip
ππ" &
.
ππ& '
Description
ππ' 2
??
ππ3 5
string
ππ6 <
.
ππ< =
Empty
ππ= B
,
ππB C
OwnerUserId
∫∫ 
=
∫∫  !
trip
∫∫" &
.
∫∫& '
OwnerId
∫∫' .
??
∫∫/ 1
$num
∫∫2 3
,
∫∫3 4
	OwnerName
ªª 
=
ªª  !
ownerDoc
ªª" *
?
ªª* +
.
ªª+ ,
Name
ªª, 0
??
ªª1 3
string
ªª4 :
.
ªª: ;
Empty
ªª; @
,
ªª@ A
Destinations
ºº 
=
ºº  !
new
ºº" %
List
ºº& *
<
ºº* +'
SimplifiedTripDestination
ºº+ D
>
ººD E
(
ººE F
)
ººF G
}
ΩΩ 
;
ΩΩ 
foreach
øø 
(
øø 
var
øø 
td
øø 
in
øø 
trip
øø #
.
øø# $
Destinations
øø$ 0
.
øø0 1
OrderBy
øø1 8
(
øø8 9
td
øø9 ;
=>
øø< >
td
øø? A
.
øøA B
SequenceNumber
øøB P
)
øøP Q
)
øøQ R
{
¿¿ 
if
¡¡ 
(
¡¡ 
!
¡¡ 
destMap
¡¡ 
.
¡¡ 
TryGetValue
¡¡ (
(
¡¡( )
td
¡¡) +
.
¡¡+ ,
DestinationId
¡¡, 9
,
¡¡9 :
out
¡¡; >
var
¡¡? B
destDoc
¡¡C J
)
¡¡J K
)
¡¡K L
continue
¬¬ 
;
¬¬ 
var
ƒƒ 
acceptedCount
ƒƒ !
=
ƒƒ" #
td
ƒƒ$ &
.
ƒƒ& '
Buddies
ƒƒ' .
.
≈≈ 
Where
≈≈ 
(
≈≈ 
b
≈≈ 
=>
≈≈ 
string
≈≈  &
.
≈≈& '
Equals
≈≈' -
(
≈≈- .
b
≈≈. /
.
≈≈/ 0
RequestStatus
≈≈0 =
,
≈≈= >
$str
≈≈? I
,
≈≈I J
StringComparison
≈≈K [
.
≈≈[ \
OrdinalIgnoreCase
≈≈\ m
)
≈≈m n
)
≈≈n o
.
∆∆ 
Sum
∆∆ 
(
∆∆ 
b
∆∆ 
=>
∆∆ 
b
∆∆ 
.
∆∆  
PersonCount
∆∆  +
??
∆∆, .
$num
∆∆/ 0
)
∆∆0 1
;
∆∆1 2
overview
»» 
.
»» 
Destinations
»» %
.
»»% &
Add
»»& )
(
»») *
new
»»* -'
SimplifiedTripDestination
»». G
{
…… 
TripDestinationId
   %
=
  ) *
td
  + -
.
  - .
TripDestinationId
  . ?
,
  ? @
TripId
ÀÀ 
=
ÀÀ) *
trip
ÀÀ+ /
.
ÀÀ/ 0
TripId
ÀÀ0 6
,
ÀÀ6 7"
DestinationStartDate
ÃÃ (
=
ÃÃ) *
DateOnly
ÃÃ+ 3
.
ÃÃ3 4
FromDateTime
ÃÃ4 @
(
ÃÃ@ A
td
ÃÃA C
.
ÃÃC D
	StartDate
ÃÃD M
)
ÃÃM N
,
ÃÃN O 
DestinationEndDate
ÕÕ &
=
ÕÕ) *
DateOnly
ÕÕ+ 3
.
ÕÕ3 4
FromDateTime
ÕÕ4 @
(
ÕÕ@ A
td
ÕÕA C
.
ÕÕC D
EndDate
ÕÕD K
)
ÕÕK L
,
ÕÕL M
DestinationName
ŒŒ #
=
ŒŒ) *
destDoc
ŒŒ+ 2
.
ŒŒ2 3
Name
ŒŒ3 7
,
ŒŒ7 8
DestinationState
œœ $
=
œœ) *
destDoc
œœ+ 2
.
œœ2 3
State
œœ3 8
,
œœ8 9 
DestinationCountry
–– &
=
––) *
destDoc
––+ 2
.
––2 3
Country
––3 :
,
––: ;

MaxBuddies
—— 
=
——) *
trip
——+ /
.
——/ 0

MaxBuddies
——0 :
??
——; =
$num
——> ?
,
——? @"
AcceptedBuddiesCount
““ (
=
““) *
acceptedCount
““+ 8
}
”” 
)
”” 
;
”” 
}
‘‘ 
return
÷÷ 
overview
÷÷ 
;
÷÷ 
}
◊◊ 	
public
ﬁﬁ 
async
ﬁﬁ 
Task
ﬁﬁ 
<
ﬁﬁ 
List
ﬁﬁ 
<
ﬁﬁ 
TripOverview
ﬁﬁ +
>
ﬁﬁ+ ,
>
ﬁﬁ, -(
GetOwnedTripOverviewsAsync
ﬁﬁ. H
(
ﬁﬁH I
int
ﬁﬁI L
userId
ﬁﬁM S
)
ﬁﬁS T
{
ﬂﬂ 	
var
·· 
trips
·· 
=
·· 
await
·· 
_tripsCollection
·· .
.
‚‚ 
Find
‚‚ 
(
‚‚ 
t
‚‚ 
=>
‚‚ 
t
‚‚ 
.
‚‚ 
OwnerId
‚‚ $
==
‚‚% '
userId
‚‚( .
)
‚‚. /
.
„„ 
ToListAsync
„„ 
(
„„ 
)
„„ 
;
„„ 
if
ÂÂ 
(
ÂÂ 
!
ÂÂ 
trips
ÂÂ 
.
ÂÂ 
Any
ÂÂ 
(
ÂÂ 
)
ÂÂ 
)
ÂÂ 
return
ÊÊ 
new
ÊÊ 
List
ÊÊ 
<
ÊÊ  
TripOverview
ÊÊ  ,
>
ÊÊ, -
(
ÊÊ- .
)
ÊÊ. /
;
ÊÊ/ 0
var
ÈÈ 
ownerDoc
ÈÈ 
=
ÈÈ 
await
ÈÈ  
_usersCollection
ÈÈ! 1
.
ÍÍ 
Find
ÍÍ 
(
ÍÍ 
u
ÍÍ 
=>
ÍÍ 
u
ÍÍ 
.
ÍÍ 
UserId
ÍÍ #
==
ÍÍ$ &
userId
ÍÍ' -
)
ÍÍ- .
.
ÎÎ !
FirstOrDefaultAsync
ÎÎ $
(
ÎÎ$ %
)
ÎÎ% &
;
ÎÎ& '
var
ÓÓ 
destIds
ÓÓ 
=
ÓÓ 
trips
ÓÓ 
.
ÔÔ 

SelectMany
ÔÔ 
(
ÔÔ 
t
ÔÔ 
=>
ÔÔ  
t
ÔÔ! "
.
ÔÔ" #
Destinations
ÔÔ# /
)
ÔÔ/ 0
.
 
Select
 
(
 
td
 
=>
 
td
  
.
  !
DestinationId
! .
)
. /
.
ÒÒ 
Distinct
ÒÒ 
(
ÒÒ 
)
ÒÒ 
.
ÚÚ 
ToList
ÚÚ 
(
ÚÚ 
)
ÚÚ 
;
ÚÚ 
var
ÙÙ 
destDocs
ÙÙ 
=
ÙÙ 
await
ÙÙ  %
_destinationsCollection
ÙÙ! 8
.
ıı 
Find
ıı 
(
ıı 
d
ıı 
=>
ıı 
destIds
ıı "
.
ıı" #
Contains
ıı# +
(
ıı+ ,
d
ıı, -
.
ıı- .
DestinationId
ıı. ;
)
ıı; <
)
ıı< =
.
ˆˆ 
ToListAsync
ˆˆ 
(
ˆˆ 
)
ˆˆ 
;
ˆˆ 
var
¯¯ 
destMap
¯¯ 
=
¯¯ 
destDocs
¯¯ "
.
¯¯" #
ToDictionary
¯¯# /
(
¯¯/ 0
d
¯¯0 1
=>
¯¯2 4
d
¯¯5 6
.
¯¯6 7
DestinationId
¯¯7 D
,
¯¯D E
d
¯¯F G
=>
¯¯H J
d
¯¯K L
)
¯¯L M
;
¯¯M N
var
˙˙ 
result
˙˙ 
=
˙˙ 
new
˙˙ 
List
˙˙ !
<
˙˙! "
TripOverview
˙˙" .
>
˙˙. /
(
˙˙/ 0
)
˙˙0 1
;
˙˙1 2
foreach
¸¸ 
(
¸¸ 
var
¸¸ 
trip
¸¸ 
in
¸¸  
trips
¸¸! &
)
¸¸& '
{
˝˝ 
var
˛˛ 
overview
˛˛ 
=
˛˛ 
new
˛˛ "
TripOverview
˛˛# /
{
ˇˇ 
TripId
ÄÄ 
=
ÄÄ$ %
trip
ÄÄ& *
.
ÄÄ* +
TripId
ÄÄ+ 1
,
ÄÄ1 2
TripName
ÅÅ 
=
ÅÅ$ %
trip
ÅÅ& *
.
ÅÅ* +
Description
ÅÅ+ 6
??
ÅÅ7 9
$"
ÅÅ: <
$str
ÅÅ< A
{
ÅÅA B
trip
ÅÅB F
.
ÅÅF G
TripId
ÅÅG M
}
ÅÅM N
"
ÅÅN O
,
ÅÅO P
TripStartDate
ÇÇ !
=
ÇÇ$ %
trip
ÇÇ& *
.
ÇÇ* +
	StartDate
ÇÇ+ 4
,
ÇÇ4 5
TripEndDate
ÉÉ 
=
ÉÉ$ %
trip
ÉÉ& *
.
ÉÉ* +
EndDate
ÉÉ+ 2
,
ÉÉ2 3

MaxBuddies
ÑÑ 
=
ÑÑ$ %
trip
ÑÑ& *
.
ÑÑ* +

MaxBuddies
ÑÑ+ 5
??
ÑÑ6 8
$num
ÑÑ9 :
,
ÑÑ: ;
TripDescription
ÖÖ #
=
ÖÖ$ %
trip
ÖÖ& *
.
ÖÖ* +
Description
ÖÖ+ 6
??
ÖÖ7 9
string
ÖÖ: @
.
ÖÖ@ A
Empty
ÖÖA F
,
ÖÖF G
OwnerUserId
ÜÜ 
=
ÜÜ$ %
userId
ÜÜ& ,
,
ÜÜ, -
	OwnerName
áá 
=
áá$ %
ownerDoc
áá& .
?
áá. /
.
áá/ 0
Name
áá0 4
??
áá5 7
string
áá8 >
.
áá> ?
Empty
áá? D
,
ááD E
Destinations
àà  
=
àà$ %
new
àà& )
List
àà* .
<
àà. /'
SimplifiedTripDestination
àà/ H
>
ààH I
(
ààI J
)
ààJ K
}
ââ 
;
ââ 
foreach
ãã 
(
ãã 
var
ãã 
td
ãã 
in
ãã  "
trip
ãã# '
.
ãã' (
Destinations
ãã( 4
.
ãã4 5
OrderBy
ãã5 <
(
ãã< =
td
ãã= ?
=>
ãã@ B
td
ããC E
.
ããE F
SequenceNumber
ããF T
)
ããT U
)
ããU V
{
åå 
if
çç 
(
çç 
!
çç 
destMap
çç  
.
çç  !
TryGetValue
çç! ,
(
çç, -
td
çç- /
.
çç/ 0
DestinationId
çç0 =
,
çç= >
out
çç? B
var
ççC F
destDoc
ççG N
)
ççN O
)
ççO P
continue
éé  
;
éé  !
var
êê 
acceptedCount
êê %
=
êê& '
td
êê( *
.
êê* +
Buddies
êê+ 2
.
ëë 
Where
ëë 
(
ëë 
b
ëë  
=>
ëë! #
string
ëë$ *
.
ëë* +
Equals
ëë+ 1
(
ëë1 2
b
ëë2 3
.
ëë3 4
RequestStatus
ëë4 A
,
ëëA B
$str
ëëC M
,
ëëM N
StringComparison
ëëO _
.
ëë_ `
OrdinalIgnoreCase
ëë` q
)
ëëq r
)
ëër s
.
íí 
Sum
íí 
(
íí 
b
íí 
=>
íí !
b
íí" #
.
íí# $
PersonCount
íí$ /
??
íí0 2
$num
íí3 4
)
íí4 5
;
íí5 6
overview
îî 
.
îî 
Destinations
îî )
.
îî) *
Add
îî* -
(
îî- .
new
îî. 1'
SimplifiedTripDestination
îî2 K
{
ïï 
TripDestinationId
ññ )
=
ññ- .
td
ññ/ 1
.
ññ1 2
TripDestinationId
ññ2 C
,
ññC D
TripId
óó 
=
óó- .
trip
óó/ 3
.
óó3 4
TripId
óó4 :
,
óó: ;"
DestinationStartDate
òò ,
=
òò- .
DateOnly
òò/ 7
.
òò7 8
FromDateTime
òò8 D
(
òòD E
td
òòE G
.
òòG H
	StartDate
òòH Q
)
òòQ R
,
òòR S 
DestinationEndDate
ôô *
=
ôô- .
DateOnly
ôô/ 7
.
ôô7 8
FromDateTime
ôô8 D
(
ôôD E
td
ôôE G
.
ôôG H
EndDate
ôôH O
)
ôôO P
,
ôôP Q
DestinationName
öö '
=
öö- .
destDoc
öö/ 6
.
öö6 7
Name
öö7 ;
,
öö; <
DestinationState
õõ (
=
õõ- .
destDoc
õõ/ 6
.
õõ6 7
State
õõ7 <
,
õõ< = 
DestinationCountry
úú *
=
úú- .
destDoc
úú/ 6
.
úú6 7
Country
úú7 >
,
úú> ?

MaxBuddies
ùù "
=
ùù- .
trip
ùù/ 3
.
ùù3 4

MaxBuddies
ùù4 >
??
ùù? A
$num
ùùB C
,
ùùC D"
AcceptedBuddiesCount
ûû ,
=
ûû- .
acceptedCount
ûû/ <
}
üü 
)
üü 
;
üü 
}
†† 
result
¢¢ 
.
¢¢ 
Add
¢¢ 
(
¢¢ 
overview
¢¢ #
)
¢¢# $
;
¢¢$ %
}
££ 
return
•• 
result
•• 
;
•• 
}
¶¶ 	
public
≠≠ 
async
≠≠ 
Task
≠≠ 
<
≠≠ 
int
≠≠ 
?
≠≠ 
>
≠≠ 
GetTripOwnerAsync
≠≠  1
(
≠≠1 2
int
≠≠2 5
tripDestinationId
≠≠6 G
)
≠≠G H
{
ÆÆ 	
var
ØØ 
filter
ØØ 
=
ØØ 
Builders
ØØ !
<
ØØ! "
TripDocument
ØØ" .
>
ØØ. /
.
ØØ/ 0
Filter
ØØ0 6
.
∞∞ 
	ElemMatch
∞∞ 
(
∞∞ 
t
∞∞ 
=>
∞∞ 
t
∞∞  !
.
∞∞! "
Destinations
∞∞" .
,
∞∞. /
td
∞∞0 2
=>
∞∞3 5
td
∞∞6 8
.
∞∞8 9
TripDestinationId
∞∞9 J
==
∞∞K M
tripDestinationId
∞∞N _
)
∞∞_ `
;
∞∞` a
var
≤≤ 
trip
≤≤ 
=
≤≤ 
await
≤≤ 
_tripsCollection
≤≤ -
.
≤≤- .
Find
≤≤. 2
(
≤≤2 3
filter
≤≤3 9
)
≤≤9 :
.
≤≤: ;!
FirstOrDefaultAsync
≤≤; N
(
≤≤N O
)
≤≤O P
;
≤≤P Q
return
≥≥ 
trip
≥≥ 
?
≥≥ 
.
≥≥ 
OwnerId
≥≥  
;
≥≥  !
}
¥¥ 	
public
ππ 
async
ππ 
Task
ππ 
<
ππ 
(
ππ 
bool
ππ 
Success
ππ  '
,
ππ' (
string
ππ) /
?
ππ/ 0
ErrorMessage
ππ1 =
)
ππ= >
>
ππ> ?-
CreateTripWithDestinationsAsync
ππ@ _
(
ππ_ `+
CreateTripWithDestinationsDto
∫∫ %
dto
∫∫& )
)
∫∫) *
{
ªª 	
try
ºº 
{
ΩΩ 
var
øø 
trips
øø 
=
øø 
await
øø !
LoadTripsAsync
øø" 0
(
øø0 1
)
øø1 2
;
øø2 3
var
¡¡ 

nextTripId
¡¡ 
=
¡¡  
trips
¡¡! &
.
¬¬ 
DefaultIfEmpty
¬¬ #
(
¬¬# $
)
¬¬$ %
.
√√ 
Max
√√ 
(
√√ 
t
√√ 
=>
√√ 
t
√√ 
?
√√  
.
√√  !
TripId
√√! '
??
√√( *
$num
√√+ ,
)
√√, -
+
√√. /
$num
√√0 1
;
√√1 2
var
≈≈ #
nextTripDestinationId
≈≈ )
=
≈≈* +
trips
≈≈, 1
.
∆∆ 

SelectMany
∆∆ 
(
∆∆  
t
∆∆  !
=>
∆∆" $
t
∆∆% &
.
∆∆& '
Destinations
∆∆' 3
)
∆∆3 4
.
«« 
DefaultIfEmpty
«« #
(
««# $
)
««$ %
.
»» 
Max
»» 
(
»» 
td
»» 
=>
»» 
td
»» !
?
»»! "
.
»»" #
TripDestinationId
»»# 4
??
»»5 7
$num
»»8 9
)
»»9 :
+
»»; <
$num
»»= >
;
»»> ?
var
ÀÀ 
t
ÀÀ 
=
ÀÀ 
dto
ÀÀ 
.
ÀÀ 

CreateTrip
ÀÀ &
;
ÀÀ& '
var
ÕÕ 
tripDoc
ÕÕ 
=
ÕÕ 
new
ÕÕ !
TripDocument
ÕÕ" .
{
ŒŒ 
TripId
œœ 
=
œœ  !

nextTripId
œœ" ,
,
œœ, -
OwnerId
–– 
=
––  !
t
––" #
.
––# $
OwnerId
––$ +
,
––+ ,

MaxBuddies
—— 
=
——  !
t
——" #
.
——# $

MaxBuddies
——$ .
,
——. /
	StartDate
““ 
=
““  !
t
““" #
.
““# $
	StartDate
““$ -
,
““- .
EndDate
”” 
=
””  !
t
””" #
.
””# $
EndDate
””$ +
,
””+ ,
Description
‘‘ 
=
‘‘  !
t
‘‘" #
.
‘‘# $
Description
‘‘$ /
,
‘‘/ 0

IsArchived
’’ 
=
’’  !
false
’’" '
,
’’' (
Destinations
÷÷  
=
÷÷! "
new
÷÷# &
List
÷÷' +
<
÷÷+ ,%
TripDestinationEmbedded
÷÷, C
>
÷÷C D
(
÷÷D E
)
÷÷E F
}
◊◊ 
;
◊◊ 
var
⁄⁄ "
existingDestinations
⁄⁄ (
=
⁄⁄) *
await
⁄⁄+ 0%
_destinationsCollection
⁄⁄1 H
.
€€ 
Find
€€ 
(
€€ 
FilterDefinition
€€ *
<
€€* +!
DestinationDocument
€€+ >
>
€€> ?
.
€€? @
Empty
€€@ E
)
€€E F
.
‹‹ 
ToListAsync
‹‹  
(
‹‹  !
)
‹‹! "
;
‹‹" #
var
ﬁﬁ 
nextDestinationId
ﬁﬁ %
=
ﬁﬁ& '"
existingDestinations
ﬁﬁ( <
.
ﬂﬂ 
DefaultIfEmpty
ﬂﬂ #
(
ﬂﬂ# $
)
ﬂﬂ$ %
.
‡‡ 
Max
‡‡ 
(
‡‡ 
d
‡‡ 
=>
‡‡ 
d
‡‡ 
?
‡‡  
.
‡‡  !
DestinationId
‡‡! .
??
‡‡/ 1
$num
‡‡2 3
)
‡‡3 4
+
‡‡5 6
$num
‡‡7 8
;
‡‡8 9
int
„„ 
seq
„„ 
=
„„ 
$num
„„ 
;
„„ 
foreach
‰‰ 
(
‰‰ 
var
‰‰ 
d
‰‰ 
in
‰‰ !
dto
‰‰" %
.
‰‰% &
TripDestinations
‰‰& 6
)
‰‰6 7
{
ÂÂ 
int
ÊÊ 
destinationId
ÊÊ %
;
ÊÊ% &
if
ËË 
(
ËË 
d
ËË 
.
ËË 
DestinationId
ËË '
.
ËË' (
HasValue
ËË( 0
)
ËË0 1
{
ÈÈ 
destinationId
ÍÍ %
=
ÍÍ& '
d
ÍÍ( )
.
ÍÍ) *
DestinationId
ÍÍ* 7
.
ÍÍ7 8
Value
ÍÍ8 =
;
ÍÍ= >
}
ÎÎ 
else
ÏÏ 
{
ÌÌ 
var
ÔÔ 
newDest
ÔÔ #
=
ÔÔ$ %
new
ÔÔ& )!
DestinationDocument
ÔÔ* =
{
 
DestinationId
ÒÒ )
=
ÒÒ* +
nextDestinationId
ÒÒ, =
++
ÒÒ= ?
,
ÒÒ? @
Name
ÚÚ  
=
ÚÚ* +
d
ÚÚ, -
.
ÚÚ- .
Name
ÚÚ. 2
??
ÚÚ3 5
$str
ÚÚ6 ?
,
ÚÚ? @
State
ÛÛ !
=
ÛÛ* +
d
ÛÛ, -
.
ÛÛ- .
State
ÛÛ. 3
,
ÛÛ3 4
Country
ÙÙ #
=
ÙÙ* +
d
ÙÙ, -
.
ÙÙ- .
Country
ÙÙ. 5
??
ÙÙ6 8
string
ÙÙ9 ?
.
ÙÙ? @
Empty
ÙÙ@ E
,
ÙÙE F
	Longitude
ıı %
=
ıı* +
d
ıı, -
.
ıı- .
	Longitude
ıı. 7
,
ıı7 8
Latitude
ˆˆ $
=
ˆˆ* +
d
ˆˆ, -
.
ˆˆ- .
Latitude
ˆˆ. 6
}
˜˜ 
;
˜˜ 
await
˘˘ %
_destinationsCollection
˘˘ 5
.
˘˘5 6
InsertOneAsync
˘˘6 D
(
˘˘D E
newDest
˘˘E L
)
˘˘L M
;
˘˘M N
destinationId
˙˙ %
=
˙˙& '
newDest
˙˙( /
.
˙˙/ 0
DestinationId
˙˙0 =
;
˙˙= >
}
˚˚ 
var
˝˝ 
td
˝˝ 
=
˝˝ 
new
˝˝  %
TripDestinationEmbedded
˝˝! 8
{
˛˛ 
TripDestinationId
ˇˇ )
=
ˇˇ* +#
nextTripDestinationId
ˇˇ, A
++
ˇˇA C
,
ˇˇC D
DestinationId
ÄÄ %
=
ÄÄ* +
destinationId
ÄÄ, 9
,
ÄÄ9 :
	StartDate
ÅÅ !
=
ÅÅ* +
d
ÅÅ, -
.
ÅÅ- ."
DestinationStartDate
ÅÅ. B
.
ÅÅB C

ToDateTime
ÅÅC M
(
ÅÅM N
TimeOnly
ÅÅN V
.
ÅÅV W
MinValue
ÅÅW _
)
ÅÅ_ `
,
ÅÅ` a
EndDate
ÇÇ 
=
ÇÇ* +
d
ÇÇ, -
.
ÇÇ- . 
DestinationEndDate
ÇÇ. @
.
ÇÇ@ A

ToDateTime
ÇÇA K
(
ÇÇK L
TimeOnly
ÇÇL T
.
ÇÇT U
MinValue
ÇÇU ]
)
ÇÇ] ^
,
ÇÇ^ _
SequenceNumber
ÉÉ &
=
ÉÉ* +
d
ÉÉ, -
.
ÉÉ- .
SequenceNumber
ÉÉ. <
!=
ÉÉ= ?
$num
ÉÉ@ A
?
ÉÉB C
d
ÉÉD E
.
ÉÉE F
SequenceNumber
ÉÉF T
:
ÉÉU V
seq
ÉÉW Z
++
ÉÉZ \
,
ÉÉ\ ]
Description
ÑÑ #
=
ÑÑ* +
d
ÑÑ, -
.
ÑÑ- .
Description
ÑÑ. 9
,
ÑÑ9 :

IsArchived
ÖÖ "
=
ÖÖ* +
false
ÖÖ, 1
,
ÖÖ1 2
Buddies
ÜÜ 
=
ÜÜ* +
new
ÜÜ, /
List
ÜÜ0 4
<
ÜÜ4 5
BuddyEmbedded
ÜÜ5 B
>
ÜÜB C
(
ÜÜC D
)
ÜÜD E
}
áá 
;
áá 
tripDoc
ââ 
.
ââ 
Destinations
ââ (
.
ââ( )
Add
ââ) ,
(
ââ, -
td
ââ- /
)
ââ/ 0
;
ââ0 1
}
ää 
await
çç 
_tripsCollection
çç &
.
çç& '
InsertOneAsync
çç' 5
(
çç5 6
tripDoc
çç6 =
)
çç= >
;
çç> ?
return
èè 
(
èè 
true
èè 
,
èè 
null
èè "
)
èè" #
;
èè# $
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
ex
ëë 
)
ëë  
{
íí 
return
ìì 
(
ìì 
false
ìì 
,
ìì 
$"
ìì !
$str
ìì! 6
{
ìì6 7
ex
ìì7 9
.
ìì9 :
Message
ìì: A
}
ììA B
"
ììB C
)
ììC D
;
ììD E
}
îî 
}
ïï 	
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
(
õõ 
bool
õõ 
Success
õõ  '
,
õõ' (
string
õõ) /
?
õõ/ 0
ErrorMessage
õõ1 =
)
õõ= >
>
õõ> ?'
LeaveTripDestinationAsync
õõ@ Y
(
õõY Z
int
úú 
userId
úú 
,
úú 
int
úú 
tripDestinationId
úú )
,
úú) *
int
úú+ .
personCount
úú/ :
,
úú: ;
string
úú< B
reason
úúC I
)
úúI J
{
ùù 	
var
üü 
filter
üü 
=
üü 
Builders
üü !
<
üü! "
TripDocument
üü" .
>
üü. /
.
üü/ 0
Filter
üü0 6
.
†† 
	ElemMatch
†† 
(
†† 
t
†† 
=>
†† 
t
††  !
.
††! "
Destinations
††" .
,
††. /
td
††0 2
=>
††3 5
td
††6 8
.
††8 9
TripDestinationId
††9 J
==
††K M
tripDestinationId
††N _
)
††_ `
;
††` a
var
¢¢ 
trip
¢¢ 
=
¢¢ 
await
¢¢ 
_tripsCollection
¢¢ -
.
¢¢- .
Find
¢¢. 2
(
¢¢2 3
filter
¢¢3 9
)
¢¢9 :
.
¢¢: ;!
FirstOrDefaultAsync
¢¢; N
(
¢¢N O
)
¢¢O P
;
¢¢P Q
if
££ 
(
££ 
trip
££ 
==
££ 
null
££ 
)
££ 
return
§§ 
(
§§ 
false
§§ 
,
§§ 
$str
§§ I
)
§§I J
;
§§J K
var
ßß 
destination
ßß 
=
ßß 
trip
ßß "
.
ßß" #
Destinations
ßß# /
.
ßß/ 0
FirstOrDefault
ßß0 >
(
ßß> ?
td
ßß? A
=>
ßßB D
td
ßßE G
.
ßßG H
TripDestinationId
ßßH Y
==
ßßZ \
tripDestinationId
ßß] n
)
ßßn o
;
ßßo p
if
®® 
(
®® 
destination
®® 
==
®® 
null
®® #
)
®®# $
return
©© 
(
©© 
false
©© 
,
©© 
$str
©© <
)
©©< =
;
©©= >
var
¨¨ 
buddy
¨¨ 
=
¨¨ 
destination
¨¨ #
.
¨¨# $
Buddies
¨¨$ +
.
¨¨+ ,
FirstOrDefault
¨¨, :
(
¨¨: ;
b
¨¨; <
=>
¨¨= ?
b
¨¨@ A
.
¨¨A B
UserId
¨¨B H
==
¨¨I K
userId
¨¨L R
)
¨¨R S
;
¨¨S T
if
≠≠ 
(
≠≠ 
buddy
≠≠ 
==
≠≠ 
null
≠≠ 
)
≠≠ 
return
ÆÆ 
(
ÆÆ 
false
ÆÆ 
,
ÆÆ 
$str
ÆÆ W
)
ÆÆW X
;
ÆÆX Y
if
±± 
(
±± 
buddy
±± 
.
±± 
PersonCount
±± !
.
±±! "
HasValue
±±" *
&&
±±+ -
buddy
±±. 3
.
±±3 4
PersonCount
±±4 ?
.
±±? @
Value
±±@ E
>
±±F G
personCount
±±H S
)
±±S T
{
≤≤ 
buddy
≥≥ 
.
≥≥ 
PersonCount
≥≥ !
-=
≥≥" $
personCount
≥≥% 0
;
≥≥0 1
}
¥¥ 
else
µµ 
{
∂∂ 
destination
∏∏ 
.
∏∏ 
Buddies
∏∏ #
.
∏∏# $
Remove
∏∏$ *
(
∏∏* +
buddy
∏∏+ 0
)
∏∏0 1
;
∏∏1 2
}
ππ 
var
øø 
destinationIndex
øø  
=
øø! "
trip
øø# '
.
øø' (
Destinations
øø( 4
.
øø4 5
	FindIndex
øø5 >
(
øø> ?
td
øø? A
=>
øøB D
td
øøE G
.
øøG H
TripDestinationId
øøH Y
==
øøZ \
tripDestinationId
øø] n
)
øøn o
;
øøo p
if
¿¿ 
(
¿¿ 
destinationIndex
¿¿  
>=
¿¿! #
$num
¿¿$ %
)
¿¿% &
trip
¡¡ 
.
¡¡ 
Destinations
¡¡ !
[
¡¡! "
destinationIndex
¡¡" 2
]
¡¡2 3
=
¡¡4 5
destination
¡¡6 A
;
¡¡A B
var
ƒƒ 
updateFilter
ƒƒ 
=
ƒƒ 
Builders
ƒƒ '
<
ƒƒ' (
TripDocument
ƒƒ( 4
>
ƒƒ4 5
.
ƒƒ5 6
Filter
ƒƒ6 <
.
ƒƒ< =
Eq
ƒƒ= ?
(
ƒƒ? @
t
ƒƒ@ A
=>
ƒƒB D
t
ƒƒE F
.
ƒƒF G
TripId
ƒƒG M
,
ƒƒM N
trip
ƒƒO S
.
ƒƒS T
TripId
ƒƒT Z
)
ƒƒZ [
;
ƒƒ[ \
var
≈≈ 
result
≈≈ 
=
≈≈ 
await
≈≈ 
_tripsCollection
≈≈ /
.
≈≈/ 0
ReplaceOneAsync
≈≈0 ?
(
≈≈? @
updateFilter
≈≈@ L
,
≈≈L M
trip
≈≈N R
)
≈≈R S
;
≈≈S T
if
«« 
(
«« 
result
«« 
.
«« 
ModifiedCount
«« $
==
««% '
$num
««( )
)
««) *
return
»» 
(
»» 
false
»» 
,
»» 
$str
»» >
)
»»> ?
;
»»? @
return
   
(
   
true
   
,
   
null
   
)
   
;
    
}
ÀÀ 	
public
–– 
async
–– 
Task
–– 
<
–– 
IEnumerable
–– %
<
––% &!
PendingBuddyRequest
––& 9
>
––9 :
>
––: ;*
GetPendingBuddyRequestsAsync
––< X
(
––X Y
int
––Y \
userId
––] c
)
––c d
{
—— 	
var
““ 
trips
““ 
=
““ 
await
““ 
LoadTripsAsync
““ ,
(
““, -
)
““- .
;
““. /
var
’’ 

ownedTrips
’’ 
=
’’ 
trips
’’ "
.
’’" #
Where
’’# (
(
’’( )
t
’’) *
=>
’’+ -
t
’’. /
.
’’/ 0
OwnerId
’’0 7
==
’’8 :
userId
’’; A
)
’’A B
.
’’B C
ToList
’’C I
(
’’I J
)
’’J K
;
’’K L
if
◊◊ 
(
◊◊ 
!
◊◊ 

ownedTrips
◊◊ 
.
◊◊ 
Any
◊◊ 
(
◊◊  
)
◊◊  !
)
◊◊! "
return
ÿÿ 

Enumerable
ÿÿ !
.
ÿÿ! "
Empty
ÿÿ" '
<
ÿÿ' (!
PendingBuddyRequest
ÿÿ( ;
>
ÿÿ; <
(
ÿÿ< =
)
ÿÿ= >
;
ÿÿ> ?
var
€€ 
destIds
€€ 
=
€€ 

ownedTrips
€€ $
.
‹‹ 

SelectMany
‹‹ 
(
‹‹ 
t
‹‹ 
=>
‹‹  
t
‹‹! "
.
‹‹" #
Destinations
‹‹# /
)
‹‹/ 0
.
›› 
Select
›› 
(
›› 
td
›› 
=>
›› 
td
››  
.
››  !
DestinationId
››! .
)
››. /
.
ﬁﬁ 
Distinct
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ 
.
ﬂﬂ 
ToList
ﬂﬂ 
(
ﬂﬂ 
)
ﬂﬂ 
;
ﬂﬂ 
var
·· 
destinationDocs
·· 
=
··  !
await
··" '%
_destinationsCollection
··( ?
.
‚‚ 
Find
‚‚ 
(
‚‚ 
d
‚‚ 
=>
‚‚ 
destIds
‚‚ "
.
‚‚" #
Contains
‚‚# +
(
‚‚+ ,
d
‚‚, -
.
‚‚- .
DestinationId
‚‚. ;
)
‚‚; <
)
‚‚< =
.
„„ 
ToListAsync
„„ 
(
„„ 
)
„„ 
;
„„ 
var
ÂÂ 
destMap
ÂÂ 
=
ÂÂ 
destinationDocs
ÂÂ )
.
ÂÂ) *
ToDictionary
ÂÂ* 6
(
ÂÂ6 7
d
ÂÂ7 8
=>
ÂÂ9 ;
d
ÂÂ< =
.
ÂÂ= >
DestinationId
ÂÂ> K
,
ÂÂK L
d
ÂÂM N
=>
ÂÂO Q
d
ÂÂR S
)
ÂÂS T
;
ÂÂT U
var
ÁÁ 
userIds
ÁÁ 
=
ÁÁ 

ownedTrips
ÁÁ $
.
ËË 

SelectMany
ËË 
(
ËË 
t
ËË 
=>
ËË  
t
ËË! "
.
ËË" #
Destinations
ËË# /
)
ËË/ 0
.
ÈÈ 

SelectMany
ÈÈ 
(
ÈÈ 
td
ÈÈ 
=>
ÈÈ !
td
ÈÈ" $
.
ÈÈ$ %
Buddies
ÈÈ% ,
)
ÈÈ, -
.
ÍÍ 
Where
ÍÍ 
(
ÍÍ 
b
ÍÍ 
=>
ÍÍ 
string
ÍÍ "
.
ÍÍ" #
Equals
ÍÍ# )
(
ÍÍ) *
b
ÍÍ* +
.
ÍÍ+ ,
RequestStatus
ÍÍ, 9
,
ÍÍ9 :
$str
ÍÍ; D
,
ÍÍD E
StringComparison
ÍÍF V
.
ÍÍV W
OrdinalIgnoreCase
ÍÍW h
)
ÍÍh i
)
ÍÍi j
.
ÎÎ 
Select
ÎÎ 
(
ÎÎ 
b
ÎÎ 
=>
ÎÎ 
b
ÎÎ 
.
ÎÎ 
UserId
ÎÎ %
)
ÎÎ% &
.
ÏÏ 
Distinct
ÏÏ 
(
ÏÏ 
)
ÏÏ 
.
ÌÌ 
ToList
ÌÌ 
(
ÌÌ 
)
ÌÌ 
;
ÌÌ 
var
ÔÔ 
userDocs
ÔÔ 
=
ÔÔ 
await
ÔÔ  
_usersCollection
ÔÔ! 1
.
 
Find
 
(
 
u
 
=>
 
userIds
 "
.
" #
Contains
# +
(
+ ,
u
, -
.
- .
UserId
. 4
)
4 5
)
5 6
.
ÒÒ 
ToListAsync
ÒÒ 
(
ÒÒ 
)
ÒÒ 
;
ÒÒ 
var
ÛÛ 
userMap
ÛÛ 
=
ÛÛ 
userDocs
ÛÛ "
.
ÛÛ" #
ToDictionary
ÛÛ# /
(
ÛÛ/ 0
u
ÛÛ0 1
=>
ÛÛ2 4
u
ÛÛ5 6
.
ÛÛ6 7
UserId
ÛÛ7 =
,
ÛÛ= >
u
ÛÛ? @
=>
ÛÛA C
u
ÛÛD E
)
ÛÛE F
;
ÛÛF G
var
ıı 
result
ıı 
=
ıı 
new
ıı 
List
ıı !
<
ıı! "!
PendingBuddyRequest
ıı" 5
>
ıı5 6
(
ıı6 7
)
ıı7 8
;
ıı8 9
foreach
˜˜ 
(
˜˜ 
var
˜˜ 
trip
˜˜ 
in
˜˜  

ownedTrips
˜˜! +
)
˜˜+ ,
{
¯¯ 
foreach
˘˘ 
(
˘˘ 
var
˘˘ 
td
˘˘ 
in
˘˘  "
trip
˘˘# '
.
˘˘' (
Destinations
˘˘( 4
)
˘˘4 5
{
˙˙ 
if
˚˚ 
(
˚˚ 
!
˚˚ 
destMap
˚˚  
.
˚˚  !
TryGetValue
˚˚! ,
(
˚˚, -
td
˚˚- /
.
˚˚/ 0
DestinationId
˚˚0 =
,
˚˚= >
out
˚˚? B
var
˚˚C F
destDoc
˚˚G N
)
˚˚N O
)
˚˚O P
continue
¸¸  
;
¸¸  !
foreach
˛˛ 
(
˛˛ 
var
˛˛  
b
˛˛! "
in
˛˛# %
td
˛˛& (
.
˛˛( )
Buddies
˛˛) 0
.
˛˛0 1
Where
˛˛1 6
(
˛˛6 7
b
˛˛7 8
=>
˛˛9 ;
string
ˇˇ 
.
ˇˇ 
Equals
ˇˇ %
(
ˇˇ% &
b
ˇˇ& '
.
ˇˇ' (
RequestStatus
ˇˇ( 5
,
ˇˇ5 6
$str
ˇˇ7 @
,
ˇˇ@ A
StringComparison
ˇˇB R
.
ˇˇR S
OrdinalIgnoreCase
ˇˇS d
)
ˇˇd e
)
ˇˇe f
)
ˇˇf g
{
ÄÄ 
userMap
ÅÅ 
.
ÅÅ  
TryGetValue
ÅÅ  +
(
ÅÅ+ ,
b
ÅÅ, -
.
ÅÅ- .
UserId
ÅÅ. 4
,
ÅÅ4 5
out
ÅÅ6 9
var
ÅÅ: =
uDoc
ÅÅ> B
)
ÅÅB C
;
ÅÅC D
result
ÉÉ 
.
ÉÉ 
Add
ÉÉ "
(
ÉÉ" #
new
ÉÉ# &!
PendingBuddyRequest
ÉÉ' :
{
ÑÑ 
TripId
ÖÖ "
=
ÖÖ# $
trip
ÖÖ% )
.
ÖÖ) *
TripId
ÖÖ* 0
,
ÖÖ0 1
DestinationName
ÜÜ +
=
ÜÜ, -
destDoc
ÜÜ. 5
.
ÜÜ5 6
Name
ÜÜ6 :
,
ÜÜ: ;
BuddyId
áá #
=
áá$ %
b
áá& '
.
áá' (
BuddyId
áá( /
,
áá/ 0
RequesterUserId
àà +
=
àà, -
b
àà. /
.
àà/ 0
UserId
àà0 6
,
àà6 7
RequesterName
ââ )
=
ââ* +
uDoc
ââ, 0
?
ââ0 1
.
ââ1 2
Name
ââ2 6
??
ââ7 9
string
ââ: @
.
ââ@ A
Empty
ââA F
,
ââF G
	BuddyNote
ää %
=
ää& '
b
ää( )
.
ää) *
Note
ää* .
,
ää. /
PersonCount
ãã '
=
ãã( )
b
ãã* +
.
ãã+ ,
PersonCount
ãã, 7
??
ãã8 :
$num
ãã; <
}
åå 
)
åå 
;
åå 
}
çç 
}
éé 
}
èè 
return
ëë 
result
ëë 
;
ëë 
}
íí 	
public
óó 
async
óó 
Task
óó 
<
óó 
(
óó 
bool
óó 
Success
óó  '
,
óó' (
string
óó) /
?
óó/ 0
ErrorMessage
óó1 =
)
óó= >
>
óó> ?%
InsertBuddyRequestAsync
óó@ W
(
óóW X
BuddyDto
óóX `
buddyDto
óóa i
)
óói j
{
òò 	
var
öö 
filter
öö 
=
öö 
Builders
öö !
<
öö! "
TripDocument
öö" .
>
öö. /
.
öö/ 0
Filter
öö0 6
.
õõ 
	ElemMatch
õõ 
(
õõ 
t
õõ 
=>
õõ 
t
õõ  !
.
õõ! "
Destinations
õõ" .
,
õõ. /
td
õõ0 2
=>
õõ3 5
td
õõ6 8
.
õõ8 9
TripDestinationId
õõ9 J
==
õõK M
buddyDto
õõN V
.
õõV W
TripDestinationId
õõW h
)
õõh i
;
õõi j
var
ùù 
trip
ùù 
=
ùù 
await
ùù 
_tripsCollection
ùù -
.
ùù- .
Find
ùù. 2
(
ùù2 3
filter
ùù3 9
)
ùù9 :
.
ùù: ;!
FirstOrDefaultAsync
ùù; N
(
ùùN O
)
ùùO P
;
ùùP Q
if
ûû 
(
ûû 
trip
ûû 
==
ûû 
null
ûû 
)
ûû 
return
üü 
(
üü 
false
üü 
,
üü 
$str
üü ;
)
üü; <
;
üü< =
var
°° 
td
°° 
=
°° 
trip
°° 
.
°° 
Destinations
°° &
.
°°& '
FirstOrDefault
°°' 5
(
°°5 6
d
°°6 7
=>
°°8 :
d
°°; <
.
°°< =
TripDestinationId
°°= N
==
°°O Q
buddyDto
°°R Z
.
°°Z [
TripDestinationId
°°[ l
)
°°l m
;
°°m n
if
¢¢ 
(
¢¢ 
td
¢¢ 
==
¢¢ 
null
¢¢ 
)
¢¢ 
return
££ 
(
££ 
false
££ 
,
££ 
$str
££ ;
)
££; <
;
££< =
var
¶¶ 
existing
¶¶ 
=
¶¶ 
td
¶¶ 
.
¶¶ 
Buddies
¶¶ %
.
¶¶% &
FirstOrDefault
¶¶& 4
(
¶¶4 5
b
¶¶5 6
=>
¶¶7 9
b
¶¶: ;
.
¶¶; <
UserId
¶¶< B
==
¶¶C E
buddyDto
¶¶F N
.
¶¶N O
UserId
¶¶O U
)
¶¶U V
;
¶¶V W
if
ßß 
(
ßß 
existing
ßß 
!=
ßß 
null
ßß  
)
ßß  !
return
®® 
(
®® 
false
®® 
,
®® 
$str
®® Y
)
®®Y Z
;
®®Z [
var
™™ 

newBuddyId
™™ 
=
™™ 
await
™™ "!
GetNextBuddyIdAsync
™™# 6
(
™™6 7
)
™™7 8
;
™™8 9
var
¨¨ 
buddy
¨¨ 
=
¨¨ 
new
¨¨ 
BuddyEmbedded
¨¨ )
{
≠≠ 
BuddyId
ÆÆ 
=
ÆÆ 

newBuddyId
ÆÆ $
,
ÆÆ$ %
UserId
ØØ 
=
ØØ 
buddyDto
ØØ !
.
ØØ! "
UserId
ØØ" (
,
ØØ( )
PersonCount
∞∞ 
=
∞∞ 
buddyDto
∞∞ &
.
∞∞& '
PersonCount
∞∞' 2
,
∞∞2 3
Note
±± 
=
±± 
buddyDto
±± 
.
±±  
Note
±±  $
,
±±$ %
IsActive
≤≤ 
=
≤≤ 
false
≤≤  
,
≤≤  !
DepartureReason
≥≥ 
=
≥≥  !
null
≥≥" &
,
≥≥& '
RequestStatus
¥¥ 
=
¥¥ 
$str
¥¥  )
}
µµ 
;
µµ 
td
∑∑ 
.
∑∑ 
Buddies
∑∑ 
.
∑∑ 
Add
∑∑ 
(
∑∑ 
buddy
∑∑  
)
∑∑  !
;
∑∑! "
var
ππ 
replaceResult
ππ 
=
ππ 
await
ππ  %
_tripsCollection
ππ& 6
.
ππ6 7
ReplaceOneAsync
ππ7 F
(
ππF G
t
∫∫ 
=>
∫∫ 
t
∫∫ 
.
∫∫ 
TripId
∫∫ 
==
∫∫  
trip
∫∫! %
.
∫∫% &
TripId
∫∫& ,
,
∫∫, -
trip
ªª 
)
ªª 
;
ªª 
return
ΩΩ 
(
ΩΩ 
replaceResult
ΩΩ !
.
ΩΩ! "
IsAcknowledged
ΩΩ" 0
&&
ΩΩ1 3
replaceResult
ΩΩ4 A
.
ΩΩA B
ModifiedCount
ΩΩB O
>
ΩΩP Q
$num
ΩΩR S
,
ΩΩS T
null
ΩΩU Y
)
ΩΩY Z
;
ΩΩZ [
}
ææ 	
public
√√ 
async
√√ 
Task
√√ 
<
√√ 
(
√√ 
bool
√√ 
Success
√√  '
,
√√' (
string
√√) /
?
√√/ 0
ErrorMessage
√√1 =
)
√√= >
>
√√> ?%
UpdateBuddyRequestAsync
√√@ W
(
√√W X#
UpdateBuddyRequestDto
√√X m$
updateBuddyRequestDto√√n É
)√√É Ñ
{
ƒƒ 	
var
≈≈ 
trips
≈≈ 
=
≈≈ 
await
≈≈ 
LoadTripsAsync
≈≈ ,
(
≈≈, -
)
≈≈- .
;
≈≈. /
TripDocument
«« 
?
«« 
tripWithBuddy
«« '
=
««( )
null
««* .
;
««. /%
TripDestinationEmbedded
»» #
?
»»# $
tdWithBuddy
»»% 0
=
»»1 2
null
»»3 7
;
»»7 8
BuddyEmbedded
…… 
?
…… 
buddy
……  
=
……! "
null
……# '
;
……' (
foreach
ÀÀ 
(
ÀÀ 
var
ÀÀ 
trip
ÀÀ 
in
ÀÀ  
trips
ÀÀ! &
)
ÀÀ& '
{
ÃÃ 
foreach
ÕÕ 
(
ÕÕ 
var
ÕÕ 
td
ÕÕ 
in
ÕÕ  "
trip
ÕÕ# '
.
ÕÕ' (
Destinations
ÕÕ( 4
)
ÕÕ4 5
{
ŒŒ 
var
œœ 
b
œœ 
=
œœ 
td
œœ 
.
œœ 
Buddies
œœ &
.
œœ& '
FirstOrDefault
œœ' 5
(
œœ5 6
x
œœ6 7
=>
œœ8 :
x
œœ; <
.
œœ< =
BuddyId
œœ= D
==
œœE G#
updateBuddyRequestDto
œœH ]
.
œœ] ^
BuddyId
œœ^ e
)
œœe f
;
œœf g
if
–– 
(
–– 
b
–– 
!=
–– 
null
–– !
)
––! "
{
—— 
tripWithBuddy
““ %
=
““& '
trip
““( ,
;
““, -
tdWithBuddy
”” #
=
””$ %
td
””& (
;
””( )
buddy
‘‘ 
=
‘‘ 
b
‘‘  !
;
‘‘! "
break
’’ 
;
’’ 
}
÷÷ 
}
◊◊ 
if
ÿÿ 
(
ÿÿ 
buddy
ÿÿ 
!=
ÿÿ 
null
ÿÿ !
)
ÿÿ! "
break
ÿÿ# (
;
ÿÿ( )
}
ŸŸ 
if
€€ 
(
€€ 
tripWithBuddy
€€ 
==
€€  
null
€€! %
||
€€& (
tdWithBuddy
€€) 4
==
€€5 7
null
€€8 <
||
€€= ?
buddy
€€@ E
==
€€F H
null
€€I M
)
€€M N
return
‹‹ 
(
‹‹ 
false
‹‹ 
,
‹‹ 
$str
‹‹ 8
)
‹‹8 9
;
‹‹9 :
var
ﬁﬁ 
	newStatus
ﬁﬁ 
=
ﬁﬁ #
updateBuddyRequestDto
ﬁﬁ 1
.
ﬁﬁ1 2
	NewStatus
ﬁﬁ2 ;
switch
ﬁﬁ< B
{
ﬂﬂ &
BuddyRequestUpdateStatus
‡‡ (
.
‡‡( )
Accepted
‡‡) 1
=>
‡‡2 4
$str
‡‡5 ?
,
‡‡? @&
BuddyRequestUpdateStatus
·· (
.
··( )
Rejected
··) 1
=>
··2 4
$str
··5 ?
,
··? @
_
‚‚ 
=>
‚‚ 
$str
‚‚ 
}
„„ 
;
„„ 
buddy
ÂÂ 
.
ÂÂ 
RequestStatus
ÂÂ 
=
ÂÂ  !
	newStatus
ÂÂ" +
;
ÂÂ+ ,
if
ÁÁ 
(
ÁÁ 
	newStatus
ÁÁ 
==
ÁÁ 
$str
ÁÁ '
)
ÁÁ' (
{
ËË 
buddy
ÈÈ 
.
ÈÈ 
IsActive
ÈÈ 
=
ÈÈ  
true
ÈÈ! %
;
ÈÈ% &
buddy
ÍÍ 
.
ÍÍ 
DepartureReason
ÍÍ %
=
ÍÍ& '
null
ÍÍ( ,
;
ÍÍ, -
}
ÎÎ 
else
ÏÏ 
if
ÏÏ 
(
ÏÏ 
	newStatus
ÏÏ 
==
ÏÏ !
$str
ÏÏ" ,
)
ÏÏ, -
{
ÌÌ 
buddy
ÓÓ 
.
ÓÓ 
IsActive
ÓÓ 
=
ÓÓ  
false
ÓÓ! &
;
ÓÓ& '
}
ÔÔ 
var
ÒÒ 
replaceResult
ÒÒ 
=
ÒÒ 
await
ÒÒ  %
_tripsCollection
ÒÒ& 6
.
ÒÒ6 7
ReplaceOneAsync
ÒÒ7 F
(
ÒÒF G
t
ÚÚ 
=>
ÚÚ 
t
ÚÚ 
.
ÚÚ 
TripId
ÚÚ 
==
ÚÚ  
tripWithBuddy
ÚÚ! .
.
ÚÚ. /
TripId
ÚÚ/ 5
,
ÚÚ5 6
tripWithBuddy
ÛÛ 
)
ÛÛ 
;
ÛÛ 
return
ıı 
(
ıı 
replaceResult
ıı !
.
ıı! "
IsAcknowledged
ıı" 0
&&
ıı1 3
replaceResult
ıı4 A
.
ııA B
ModifiedCount
ııB O
>
ııP Q
$num
ııR S
,
ııS T
null
ııU Y
)
ııY Z
;
ııZ [
}
ˆˆ 	
public
˘˘ 
async
˘˘ 
Task
˘˘ 
<
˘˘ 
IEnumerable
˘˘ %
<
˘˘% &
	TripAudit
˘˘& /
>
˘˘/ 0
>
˘˘0 1 
GetTripAuditsAsync
˘˘2 D
(
˘˘D E
)
˘˘E F
{
˙˙ 	
return
¸¸ 
await
¸¸ 
Task
¸¸ 
.
¸¸ 

FromResult
¸¸ (
<
¸¸( )
IEnumerable
¸¸) 4
<
¸¸4 5
	TripAudit
¸¸5 >
>
¸¸> ?
>
¸¸? @
(
¸¸@ A
new
¸¸A D
List
¸¸E I
<
¸¸I J
	TripAudit
¸¸J S
>
¸¸S T
(
¸¸T U
)
¸¸U V
)
¸¸V W
;
¸¸W X
}
˝˝ 	
public
˛˛ 
async
˛˛ 
Task
˛˛ 
<
˛˛ 
IEnumerable
˛˛ %
<
˛˛% &

BuddyAudit
˛˛& 0
>
˛˛0 1
>
˛˛1 2!
GetBuddyAuditsAsync
˛˛3 F
(
˛˛F G
)
˛˛G H
{
ˇˇ 	
return
ÅÅ 
await
ÅÅ 
Task
ÅÅ 
.
ÅÅ 

FromResult
ÅÅ (
<
ÅÅ( )
IEnumerable
ÅÅ) 4
<
ÅÅ4 5

BuddyAudit
ÅÅ5 ?
>
ÅÅ? @
>
ÅÅ@ A
(
ÅÅA B
new
ÅÅB E
List
ÅÅF J
<
ÅÅJ K

BuddyAudit
ÅÅK U
>
ÅÅU V
(
ÅÅV W
)
ÅÅW X
)
ÅÅX Y
;
ÅÅY Z
}
ÇÇ 	
}
ÉÉ 
}ÑÑ ƒ
àC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\UpdateBuddyRequestDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 

class !
UpdateBuddyRequestDto &
{ 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Required	 
] 
public		 
int		 
BuddyId		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
[

 	
Required

	 
]

 
public $
BuddyRequestUpdateStatus '
	NewStatus( 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
} 
} à
ÇC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\TripOverviewDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 

record 
TripOverviewDto !
(! "
int 
TripId 
, 
string 
TripName 
, 
DateOnly 
TripStartDate 
, 
DateOnly 
TripEndDate 
, 
int 

MaxBuddies 
, 
string		 
TripDescription		 
,		 
int

 
OwnerUserId

 
,

 
string 
	OwnerName 
, 
List 
< (
SimplifiedTripDestinationDto )
>) *
Destinations+ 7
) 
; 
public 

record (
SimplifiedTripDestinationDto .
(. /
int 
TripDestinationId 
, 
int 
TripId 
, 
DateOnly  
DestinationStartDate %
,% &
DateOnly 
DestinationEndDate #
,# $
string 
DestinationName 
, 
string 
? 
DestinationState  
,  !
string 
DestinationCountry !
,! "
int 

MaxBuddies 
, 
int  
AcceptedBuddiesCount  
) 
; 
} ®
ãC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\TripDestinationSearchDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 
record $
TripDestinationSearchDto +
(+ ,
int 
TripDestinationId 
, 
int 
TripId 
, 
int 
DestinationId 
, 
string 
DestinationName 
, 
string 
Country 
, 
string		 
?		 
State		 
,		 
DateOnly

 
DestinationStart

 !
,

! "
DateOnly 
DestinationEnd 
,  
int 

MaxBuddies 
, 
int 
AcceptedPersons 
, 
int 
RemainingCapacity 
) 
; 
} ¯
âC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\TripDestinationInfoDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 

record "
TripDestinationInfoDto (
(( )
int 
TripDestinationId 
, 
DateOnly  
DestinationStartDate %
,% &
DateOnly 
DestinationEndDate #
,# $
string 
? "
DestinationDescription &
,& '
bool 
? !
DestinationIsArchived #
,# $
int		 
TripId		 
,		 
int

 
?

 

MaxBuddies

 
,

 
int 
DestinationId 
, 
string 
DestinationName 
, 
string 
? 
DestinationState  
,  !
string 
DestinationCountry !
,! "
decimal 
? 
	Longitude 
, 
decimal 
? 
Latitude 
, 
int 
OwnerUserId 
, 
string 
	OwnerName 
, 
int 
? 
GroupConversationId  
,  !
IEnumerable 
< 
BuddyInfoDto  
>  !
AcceptedBuddies" 1
,1 2
IEnumerable 
< 
BuddyRequestInfoDto '
>' (
PendingRequests) 8
) 
; 
public 

record 
BuddyInfoDto 
( 
int 
BuddyId 
, 
int 
PersonCount 
, 
string 
? 
	BuddyNote 
, 
int 
BuddyUserId 
, 
string 
	BuddyName 
) 
; 
public 

record 
BuddyRequestInfoDto %
(% &
int 
BuddyId 
, 
int   
PersonCount   
,   
string!! 
?!! 
	BuddyNote!! 
,!! 
int"" 
RequesterUserId"" 
,"" 
string## 
RequesterName## 
)$$ 
;$$ 
}%% Ï
ÖC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\TripDestinationDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 

record 
TripDestinationDto $
($ %
int 
TripDestinationId 
, 
int 
DestinationId 
, 
int 
TripId 
, 
DateOnly 
	StartDate 
, 
DateOnly		 
EndDate		 
,		 
int

 
SequenceNumber

 
,

 
string 
? 
Description 
, 
bool 
? 

IsArchived 
) 
; 
} Í
C:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\TripAuditDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
;  !
public 
record 
TripAuditDto 
( 
int 
AuditId 
, 
int 
TripId 
, 
string 

Action 
, 
string 

?
 
FieldChanged 
, 
string 

?
 
OldValue 
, 
string		 

?		
 
NewValue		 
,		 
int

 
?

 
	ChangedBy

	 
,

 
DateTime 
? 
	Timestamp 
) 
; Ú
âC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\PendingBuddyRequestDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 

record "
PendingBuddyRequestDto (
(( )
int 
TripDestinationId 
, 
string 
DestinationName 
, 
DateOnly  
DestinationStartDate %
,% &
DateOnly 
DestinationEndDate #
,# $
int 
TripId 
, 
int		 
BuddyId		 
,		 
int

 
RequesterUserId

 
,

 
string 
RequesterName 
, 
string 
? 
	BuddyNote 
, 
int 
PersonCount 
) 
; 
} ‚
ÅC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\DestinationDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
;  !
public 
record 
DestinationDto 
( 
int 
DestinationId 
, 
string 

Name 
, 
string 

?
 
State 
, 
string 

Country 
, 
decimal 
? 
	Longitude 
, 
decimal		 
?		 
Latitude		 
)

 
;

 ˚
êC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\CreateTripWithDestinationsDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
;  !
public 
class )
CreateTripWithDestinationsDto *
{ 
[ 
Required 
] 
public 

CreateTripDto 

CreateTrip #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
new4 7
CreateTripDto8 E
(E F
)F G
;G H
[ 
Required 
] 
public		 

List		 
<		 $
CreateTripDestinationDto		 (
>		( )
TripDestinations		* :
{		; <
get		= @
;		@ A
set		B E
;		E F
}		G H
=		I J
new		K N
List		O S
<		S T$
CreateTripDestinationDto		T l
>		l m
(		m n
)		n o
;		o p
}

 Ñ
ÄC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\CreateTripDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
;  !
public 
class 
CreateTripDto 
{ 
public 

int 
OwnerId 
{ 
get 
; 
set !
;! "
}# $
public 

string 
TripName 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
public 

int 

MaxBuddies 
{ 
get 
;  
set! $
;$ %
}& '
public 

DateOnly 
	StartDate 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateOnly 
EndDate 
{ 
get !
;! "
set# &
;& '
}( )
public		 

string		 
?		 
Description		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 

int

 
	ChangedBy

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
} ∑
ãC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\CreateTripDestinationDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
;  !
public 
class $
CreateTripDestinationDto %
{ 
public 

int 
? 
TripId 
{ 
get 
; 
set !
;! "
}# $
public 

DateOnly  
DestinationStartDate (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

DateOnly 
DestinationEndDate &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

int 
SequenceNumber 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
? 
Description 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

int 
? 
DestinationId 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
? 
Name 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
? 
State 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
? 
Country 
{ 
get  
;  !
set" %
;% &
}' (
public 

decimal 
? 
	Longitude 
{ 
get  #
;# $
set% (
;( )
}* +
public 

decimal 
? 
Latitude 
{ 
get "
;" #
set$ '
;' (
}) *
} ù
ÜC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\BuddyTripSummaryDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 

record 
BuddyTripSummaryDto %
(% &
int 
TripId 
, 
int 
TripDestinationId 
, 
string 
DestinationName 
, 
string 
TripDescription 
, 
DateOnly 
	StartDate 
, 
DateOnly		 
EndDate		 
,		 
bool

 

IsArchived

 
) 
; 
} Ã
ãC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\BuddyRequestUpdateStatus.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
;  !
public 
enum $
BuddyRequestUpdateStatus $
{ 
[ 

EnumMember 
( 
Value 
= 
$str "
)" #
]# $
Accepted 
, 
[		 

EnumMember		 
(		 
Value		 
=		 
$str		 "
)		" #
]		# $
Rejected

 
,

 
} ú
{C:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\BuddyDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
{ 
public 

class 
BuddyDto 
{ 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Required	 
] 
public		 
int		 
TripDestinationId		 $
{		% &
get		' *
;		* +
set		, /
;		/ 0
}		1 2
[

 	
Required

	 
]

 
[ 	
Range	 
( 
$num 
, 
int 
. 
MaxValue 
, 
ErrorMessage  ,
=- .
$str/ O
)O P
]P Q
public 
int 
PersonCount 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
	MaxLength	 
( 
$num 
) 
] 
public 
string 
? 
Note 
{ 
get !
;! "
set# &
;& '
}( )
} 
} ÷
ÄC:\Users\natha\OneDrive\Skrivebord\Kea-it-arkitektur\5. semester\TravelBuddy\src\Modules\TravelBuddy.Trips\DTOs\BuddyAuditDto.cs
	namespace 	
TravelBuddy
 
. 
Trips 
. 
DTOs  
;  !
public 
record 
BuddyAuditDto 
( 
int 
AuditId 
, 
int 
BuddyId 
, 
string 

Action 
, 
string 

?
 
Reason 
, 
int		 
?		 
	ChangedBy			 
,		 
DateTime

 
?

 
	Timestamp

 
) 
; 